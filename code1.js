gdjs.InicioCode = {};
gdjs.InicioCode.localVariables = [];
gdjs.InicioCode.idToCallbackMap = new Map();
gdjs.InicioCode.GDPauseButtonObjects1_1final = [];

gdjs.InicioCode.forEachIndex2 = 0;

gdjs.InicioCode.forEachIndex3 = 0;

gdjs.InicioCode.forEachObjects2 = [];

gdjs.InicioCode.forEachObjects3 = [];

gdjs.InicioCode.forEachTemporary2 = null;

gdjs.InicioCode.forEachTemporary3 = null;

gdjs.InicioCode.forEachTotalCount2 = 0;

gdjs.InicioCode.forEachTotalCount3 = 0;

gdjs.InicioCode.GDBackObjects1= [];
gdjs.InicioCode.GDBackObjects2= [];
gdjs.InicioCode.GDBackObjects3= [];
gdjs.InicioCode.GDBackObjects4= [];
gdjs.InicioCode.GDBackObjects5= [];
gdjs.InicioCode.GDNewTextObjects1= [];
gdjs.InicioCode.GDNewTextObjects2= [];
gdjs.InicioCode.GDNewTextObjects3= [];
gdjs.InicioCode.GDNewTextObjects4= [];
gdjs.InicioCode.GDNewTextObjects5= [];
gdjs.InicioCode.GDLeftKeybindObjects1= [];
gdjs.InicioCode.GDLeftKeybindObjects2= [];
gdjs.InicioCode.GDLeftKeybindObjects3= [];
gdjs.InicioCode.GDLeftKeybindObjects4= [];
gdjs.InicioCode.GDLeftKeybindObjects5= [];
gdjs.InicioCode.GDDownKeybindObjects1= [];
gdjs.InicioCode.GDDownKeybindObjects2= [];
gdjs.InicioCode.GDDownKeybindObjects3= [];
gdjs.InicioCode.GDDownKeybindObjects4= [];
gdjs.InicioCode.GDDownKeybindObjects5= [];
gdjs.InicioCode.GDUpKeybindObjects1= [];
gdjs.InicioCode.GDUpKeybindObjects2= [];
gdjs.InicioCode.GDUpKeybindObjects3= [];
gdjs.InicioCode.GDUpKeybindObjects4= [];
gdjs.InicioCode.GDUpKeybindObjects5= [];
gdjs.InicioCode.GDRightKeybindObjects1= [];
gdjs.InicioCode.GDRightKeybindObjects2= [];
gdjs.InicioCode.GDRightKeybindObjects3= [];
gdjs.InicioCode.GDRightKeybindObjects4= [];
gdjs.InicioCode.GDRightKeybindObjects5= [];
gdjs.InicioCode.GDChartDelayInputObjects1= [];
gdjs.InicioCode.GDChartDelayInputObjects2= [];
gdjs.InicioCode.GDChartDelayInputObjects3= [];
gdjs.InicioCode.GDChartDelayInputObjects4= [];
gdjs.InicioCode.GDChartDelayInputObjects5= [];
gdjs.InicioCode.GDChartDelayTextObjects1= [];
gdjs.InicioCode.GDChartDelayTextObjects2= [];
gdjs.InicioCode.GDChartDelayTextObjects3= [];
gdjs.InicioCode.GDChartDelayTextObjects4= [];
gdjs.InicioCode.GDChartDelayTextObjects5= [];
gdjs.InicioCode.GDUpscrollIndicatorObjects1= [];
gdjs.InicioCode.GDUpscrollIndicatorObjects2= [];
gdjs.InicioCode.GDUpscrollIndicatorObjects3= [];
gdjs.InicioCode.GDUpscrollIndicatorObjects4= [];
gdjs.InicioCode.GDUpscrollIndicatorObjects5= [];
gdjs.InicioCode.GDUpscrollTextObjects1= [];
gdjs.InicioCode.GDUpscrollTextObjects2= [];
gdjs.InicioCode.GDUpscrollTextObjects3= [];
gdjs.InicioCode.GDUpscrollTextObjects4= [];
gdjs.InicioCode.GDUpscrollTextObjects5= [];
gdjs.InicioCode.GDHardObjects1= [];
gdjs.InicioCode.GDHardObjects2= [];
gdjs.InicioCode.GDHardObjects3= [];
gdjs.InicioCode.GDHardObjects4= [];
gdjs.InicioCode.GDHardObjects5= [];
gdjs.InicioCode.GDSwipeTextObjects1= [];
gdjs.InicioCode.GDSwipeTextObjects2= [];
gdjs.InicioCode.GDSwipeTextObjects3= [];
gdjs.InicioCode.GDSwipeTextObjects4= [];
gdjs.InicioCode.GDSwipeTextObjects5= [];
gdjs.InicioCode.GDNew_9595Objects1= [];
gdjs.InicioCode.GDNew_9595Objects2= [];
gdjs.InicioCode.GDNew_9595Objects3= [];
gdjs.InicioCode.GDNew_9595Objects4= [];
gdjs.InicioCode.GDNew_9595Objects5= [];
gdjs.InicioCode.GDCustomScrollObjects1= [];
gdjs.InicioCode.GDCustomScrollObjects2= [];
gdjs.InicioCode.GDCustomScrollObjects3= [];
gdjs.InicioCode.GDCustomScrollObjects4= [];
gdjs.InicioCode.GDCustomScrollObjects5= [];
gdjs.InicioCode.GDScrollSliderObjects1= [];
gdjs.InicioCode.GDScrollSliderObjects2= [];
gdjs.InicioCode.GDScrollSliderObjects3= [];
gdjs.InicioCode.GDScrollSliderObjects4= [];
gdjs.InicioCode.GDScrollSliderObjects5= [];
gdjs.InicioCode.GDSongsNumbersObjects1= [];
gdjs.InicioCode.GDSongsNumbersObjects2= [];
gdjs.InicioCode.GDSongsNumbersObjects3= [];
gdjs.InicioCode.GDSongsNumbersObjects4= [];
gdjs.InicioCode.GDSongsNumbersObjects5= [];
gdjs.InicioCode.GDOptionsTextObjects1= [];
gdjs.InicioCode.GDOptionsTextObjects2= [];
gdjs.InicioCode.GDOptionsTextObjects3= [];
gdjs.InicioCode.GDOptionsTextObjects4= [];
gdjs.InicioCode.GDOptionsTextObjects5= [];
gdjs.InicioCode.GDbegfontObjects1= [];
gdjs.InicioCode.GDbegfontObjects2= [];
gdjs.InicioCode.GDbegfontObjects3= [];
gdjs.InicioCode.GDbegfontObjects4= [];
gdjs.InicioCode.GDbegfontObjects5= [];
gdjs.InicioCode.GDnextbuttonObjects1= [];
gdjs.InicioCode.GDnextbuttonObjects2= [];
gdjs.InicioCode.GDnextbuttonObjects3= [];
gdjs.InicioCode.GDnextbuttonObjects4= [];
gdjs.InicioCode.GDnextbuttonObjects5= [];
gdjs.InicioCode.GDlevelnumbertextObjects1= [];
gdjs.InicioCode.GDlevelnumbertextObjects2= [];
gdjs.InicioCode.GDlevelnumbertextObjects3= [];
gdjs.InicioCode.GDlevelnumbertextObjects4= [];
gdjs.InicioCode.GDlevelnumbertextObjects5= [];
gdjs.InicioCode.GDPointsTextObjects1= [];
gdjs.InicioCode.GDPointsTextObjects2= [];
gdjs.InicioCode.GDPointsTextObjects3= [];
gdjs.InicioCode.GDPointsTextObjects4= [];
gdjs.InicioCode.GDPointsTextObjects5= [];
gdjs.InicioCode.GDNewText2Objects1= [];
gdjs.InicioCode.GDNewText2Objects2= [];
gdjs.InicioCode.GDNewText2Objects3= [];
gdjs.InicioCode.GDNewText2Objects4= [];
gdjs.InicioCode.GDNewText2Objects5= [];
gdjs.InicioCode.GDExportObjects1= [];
gdjs.InicioCode.GDExportObjects2= [];
gdjs.InicioCode.GDExportObjects3= [];
gdjs.InicioCode.GDExportObjects4= [];
gdjs.InicioCode.GDExportObjects5= [];
gdjs.InicioCode.GDImportObjects1= [];
gdjs.InicioCode.GDImportObjects2= [];
gdjs.InicioCode.GDImportObjects3= [];
gdjs.InicioCode.GDImportObjects4= [];
gdjs.InicioCode.GDImportObjects5= [];
gdjs.InicioCode.GDStatisticsObjects1= [];
gdjs.InicioCode.GDStatisticsObjects2= [];
gdjs.InicioCode.GDStatisticsObjects3= [];
gdjs.InicioCode.GDStatisticsObjects4= [];
gdjs.InicioCode.GDStatisticsObjects5= [];
gdjs.InicioCode.GDComboNumbersObjects1= [];
gdjs.InicioCode.GDComboNumbersObjects2= [];
gdjs.InicioCode.GDComboNumbersObjects3= [];
gdjs.InicioCode.GDComboNumbersObjects4= [];
gdjs.InicioCode.GDComboNumbersObjects5= [];
gdjs.InicioCode.GDNotesSplashObjects1= [];
gdjs.InicioCode.GDNotesSplashObjects2= [];
gdjs.InicioCode.GDNotesSplashObjects3= [];
gdjs.InicioCode.GDNotesSplashObjects4= [];
gdjs.InicioCode.GDNotesSplashObjects5= [];
gdjs.InicioCode.GDfpsObjects1= [];
gdjs.InicioCode.GDfpsObjects2= [];
gdjs.InicioCode.GDfpsObjects3= [];
gdjs.InicioCode.GDfpsObjects4= [];
gdjs.InicioCode.GDfpsObjects5= [];
gdjs.InicioCode.GDEngineTextObjects1= [];
gdjs.InicioCode.GDEngineTextObjects2= [];
gdjs.InicioCode.GDEngineTextObjects3= [];
gdjs.InicioCode.GDEngineTextObjects4= [];
gdjs.InicioCode.GDEngineTextObjects5= [];
gdjs.InicioCode.GDLongUpscrollBFObjects1= [];
gdjs.InicioCode.GDLongUpscrollBFObjects2= [];
gdjs.InicioCode.GDLongUpscrollBFObjects3= [];
gdjs.InicioCode.GDLongUpscrollBFObjects4= [];
gdjs.InicioCode.GDLongUpscrollBFObjects5= [];
gdjs.InicioCode.GDLongUpscrollOPPObjects1= [];
gdjs.InicioCode.GDLongUpscrollOPPObjects2= [];
gdjs.InicioCode.GDLongUpscrollOPPObjects3= [];
gdjs.InicioCode.GDLongUpscrollOPPObjects4= [];
gdjs.InicioCode.GDLongUpscrollOPPObjects5= [];
gdjs.InicioCode.GDHitboxLeftObjects1= [];
gdjs.InicioCode.GDHitboxLeftObjects2= [];
gdjs.InicioCode.GDHitboxLeftObjects3= [];
gdjs.InicioCode.GDHitboxLeftObjects4= [];
gdjs.InicioCode.GDHitboxLeftObjects5= [];
gdjs.InicioCode.GDHitboxDownObjects1= [];
gdjs.InicioCode.GDHitboxDownObjects2= [];
gdjs.InicioCode.GDHitboxDownObjects3= [];
gdjs.InicioCode.GDHitboxDownObjects4= [];
gdjs.InicioCode.GDHitboxDownObjects5= [];
gdjs.InicioCode.GDHitboxUpObjects1= [];
gdjs.InicioCode.GDHitboxUpObjects2= [];
gdjs.InicioCode.GDHitboxUpObjects3= [];
gdjs.InicioCode.GDHitboxUpObjects4= [];
gdjs.InicioCode.GDHitboxUpObjects5= [];
gdjs.InicioCode.GDhitrightObjects1= [];
gdjs.InicioCode.GDhitrightObjects2= [];
gdjs.InicioCode.GDhitrightObjects3= [];
gdjs.InicioCode.GDhitrightObjects4= [];
gdjs.InicioCode.GDhitrightObjects5= [];
gdjs.InicioCode.GDBFIconObjects1= [];
gdjs.InicioCode.GDBFIconObjects2= [];
gdjs.InicioCode.GDBFIconObjects3= [];
gdjs.InicioCode.GDBFIconObjects4= [];
gdjs.InicioCode.GDBFIconObjects5= [];
gdjs.InicioCode.GDPauseButtonObjects1= [];
gdjs.InicioCode.GDPauseButtonObjects2= [];
gdjs.InicioCode.GDPauseButtonObjects3= [];
gdjs.InicioCode.GDPauseButtonObjects4= [];
gdjs.InicioCode.GDPauseButtonObjects5= [];
gdjs.InicioCode.GDPauseButton2Objects1= [];
gdjs.InicioCode.GDPauseButton2Objects2= [];
gdjs.InicioCode.GDPauseButton2Objects3= [];
gdjs.InicioCode.GDPauseButton2Objects4= [];
gdjs.InicioCode.GDPauseButton2Objects5= [];
gdjs.InicioCode.GDBlackScreenObjects1= [];
gdjs.InicioCode.GDBlackScreenObjects2= [];
gdjs.InicioCode.GDBlackScreenObjects3= [];
gdjs.InicioCode.GDBlackScreenObjects4= [];
gdjs.InicioCode.GDBlackScreenObjects5= [];
gdjs.InicioCode.GDPauseTextObjects1= [];
gdjs.InicioCode.GDPauseTextObjects2= [];
gdjs.InicioCode.GDPauseTextObjects3= [];
gdjs.InicioCode.GDPauseTextObjects4= [];
gdjs.InicioCode.GDPauseTextObjects5= [];
gdjs.InicioCode.GDExitTextObjects1= [];
gdjs.InicioCode.GDExitTextObjects2= [];
gdjs.InicioCode.GDExitTextObjects3= [];
gdjs.InicioCode.GDExitTextObjects4= [];
gdjs.InicioCode.GDExitTextObjects5= [];
gdjs.InicioCode.GDRestartTextObjects1= [];
gdjs.InicioCode.GDRestartTextObjects2= [];
gdjs.InicioCode.GDRestartTextObjects3= [];
gdjs.InicioCode.GDRestartTextObjects4= [];
gdjs.InicioCode.GDRestartTextObjects5= [];
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects1= [];
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects2= [];
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects3= [];
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects4= [];
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects5= [];
gdjs.InicioCode.GDBfUpNoteObjects1= [];
gdjs.InicioCode.GDBfUpNoteObjects2= [];
gdjs.InicioCode.GDBfUpNoteObjects3= [];
gdjs.InicioCode.GDBfUpNoteObjects4= [];
gdjs.InicioCode.GDBfUpNoteObjects5= [];
gdjs.InicioCode.GDBfDownNoteObjects1= [];
gdjs.InicioCode.GDBfDownNoteObjects2= [];
gdjs.InicioCode.GDBfDownNoteObjects3= [];
gdjs.InicioCode.GDBfDownNoteObjects4= [];
gdjs.InicioCode.GDBfDownNoteObjects5= [];
gdjs.InicioCode.GDBfLeftNoteObjects1= [];
gdjs.InicioCode.GDBfLeftNoteObjects2= [];
gdjs.InicioCode.GDBfLeftNoteObjects3= [];
gdjs.InicioCode.GDBfLeftNoteObjects4= [];
gdjs.InicioCode.GDBfLeftNoteObjects5= [];
gdjs.InicioCode.GDBfRightNoteObjects1= [];
gdjs.InicioCode.GDBfRightNoteObjects2= [];
gdjs.InicioCode.GDBfRightNoteObjects3= [];
gdjs.InicioCode.GDBfRightNoteObjects4= [];
gdjs.InicioCode.GDBfRightNoteObjects5= [];
gdjs.InicioCode.GDOppIconObjects1= [];
gdjs.InicioCode.GDOppIconObjects2= [];
gdjs.InicioCode.GDOppIconObjects3= [];
gdjs.InicioCode.GDOppIconObjects4= [];
gdjs.InicioCode.GDOppIconObjects5= [];
gdjs.InicioCode.GDtimerBarObjects1= [];
gdjs.InicioCode.GDtimerBarObjects2= [];
gdjs.InicioCode.GDtimerBarObjects3= [];
gdjs.InicioCode.GDtimerBarObjects4= [];
gdjs.InicioCode.GDtimerBarObjects5= [];
gdjs.InicioCode.GDtimeObjects1= [];
gdjs.InicioCode.GDtimeObjects2= [];
gdjs.InicioCode.GDtimeObjects3= [];
gdjs.InicioCode.GDtimeObjects4= [];
gdjs.InicioCode.GDtimeObjects5= [];
gdjs.InicioCode.GDtimerBar2Objects1= [];
gdjs.InicioCode.GDtimerBar2Objects2= [];
gdjs.InicioCode.GDtimerBar2Objects3= [];
gdjs.InicioCode.GDtimerBar2Objects4= [];
gdjs.InicioCode.GDtimerBar2Objects5= [];
gdjs.InicioCode.GDRatinsPopUpObjects1= [];
gdjs.InicioCode.GDRatinsPopUpObjects2= [];
gdjs.InicioCode.GDRatinsPopUpObjects3= [];
gdjs.InicioCode.GDRatinsPopUpObjects4= [];
gdjs.InicioCode.GDRatinsPopUpObjects5= [];
gdjs.InicioCode.GDLongNoteObjects1= [];
gdjs.InicioCode.GDLongNoteObjects2= [];
gdjs.InicioCode.GDLongNoteObjects3= [];
gdjs.InicioCode.GDLongNoteObjects4= [];
gdjs.InicioCode.GDLongNoteObjects5= [];
gdjs.InicioCode.GDnotesObjects1= [];
gdjs.InicioCode.GDnotesObjects2= [];
gdjs.InicioCode.GDnotesObjects3= [];
gdjs.InicioCode.GDnotesObjects4= [];
gdjs.InicioCode.GDnotesObjects5= [];
gdjs.InicioCode.GDOppLeftNoteObjects1= [];
gdjs.InicioCode.GDOppLeftNoteObjects2= [];
gdjs.InicioCode.GDOppLeftNoteObjects3= [];
gdjs.InicioCode.GDOppLeftNoteObjects4= [];
gdjs.InicioCode.GDOppLeftNoteObjects5= [];
gdjs.InicioCode.GDOppDownNoteObjects1= [];
gdjs.InicioCode.GDOppDownNoteObjects2= [];
gdjs.InicioCode.GDOppDownNoteObjects3= [];
gdjs.InicioCode.GDOppDownNoteObjects4= [];
gdjs.InicioCode.GDOppDownNoteObjects5= [];
gdjs.InicioCode.GDOppUpNoteObjects1= [];
gdjs.InicioCode.GDOppUpNoteObjects2= [];
gdjs.InicioCode.GDOppUpNoteObjects3= [];
gdjs.InicioCode.GDOppUpNoteObjects4= [];
gdjs.InicioCode.GDOppUpNoteObjects5= [];
gdjs.InicioCode.GDOppRightNoteObjects1= [];
gdjs.InicioCode.GDOppRightNoteObjects2= [];
gdjs.InicioCode.GDOppRightNoteObjects3= [];
gdjs.InicioCode.GDOppRightNoteObjects4= [];
gdjs.InicioCode.GDOppRightNoteObjects5= [];
gdjs.InicioCode.GDLongNoteOppObjects1= [];
gdjs.InicioCode.GDLongNoteOppObjects2= [];
gdjs.InicioCode.GDLongNoteOppObjects3= [];
gdjs.InicioCode.GDLongNoteOppObjects4= [];
gdjs.InicioCode.GDLongNoteOppObjects5= [];
gdjs.InicioCode.GDStatistics2Objects1= [];
gdjs.InicioCode.GDStatistics2Objects2= [];
gdjs.InicioCode.GDStatistics2Objects3= [];
gdjs.InicioCode.GDStatistics2Objects4= [];
gdjs.InicioCode.GDStatistics2Objects5= [];


gdjs.InicioCode.eventsList0 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
{
{gdjs.evtsExt__DragCameraWithPointer__DragCameraWithPointer.func(runtimeScene, 0, "", "vertical", "Left", null);
}
{gdjs.evtTools.camera.setCameraY(runtimeScene, gdjs.evtTools.camera.getCameraY(runtimeScene, "", 0) - (gdjs.evtTools.input.getMouseWheelDelta(runtimeScene) * 1.4), "", 0);
}
}

}


};gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects = Hashtable.newFrom({"begfont": gdjs.InicioCode.GDbegfontObjects1});
gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects = Hashtable.newFrom({"begfont": gdjs.InicioCode.GDbegfontObjects1});
gdjs.InicioCode.userFunc0x18a7f40 = function GDJSInlineCode(runtimeScene) {
"use strict";
// ===================================================================
// PlayerUniversal Export/Import (mobile-friendly) - Removed fallback button
// - Keeps automatic fallback but removes explicit "Save to device" button.
// - Ensures max 3 saved entries per user+modShort; deletes oldest when excede.
// - UI close (X) fixed, download/share explicit buttons remain.
// ===================================================================

(function () {
  // ---------- Config ----------
  const PBKDF2_ITERATIONS = 150000;
  const SALT_BYTES = 16;
  const IV_BYTES = 12;
  const DERIVED_BITS = 512;
  const FIELDS = ['BestScore', 'Pfcs', 'Points'];
  const MAX_FALLBACK_ENTRIES = 3; // máximo mantido por usuário+modShort

  // ---------- Utils ----------
  function strToU8(s) { return new TextEncoder().encode(s); }
  function u8ToStr(u) { return new TextDecoder().decode(u); }
  function randomBytes(n) { const b = new Uint8Array(n); crypto.getRandomValues(b); return b; }
  function abToB64(buf) { let binary = ''; const bytes = new Uint8Array(buf); for (let i=0;i<bytes.length;i++) binary += String.fromCharCode(bytes[i]); return btoa(binary); }
  function b64ToU8(b64) { const binary = atob(b64); const bytes = new Uint8Array(binary.length); for (let i=0;i<binary.length;i++) bytes[i]=binary.charCodeAt(i); return bytes; }
  function concatU8(...arrs){ const total = arrs.reduce((s,a)=>s+a.length,0); const out = new Uint8Array(total); let off=0; for (const a of arrs){ out.set(a, off); off+=a.length; } return out; }
  function isNumericString(s){ return typeof s==='string' && /^[\s]*[+-]?(?:\d+)(?:\.\d+)?[\s]*$/.test(s.trim()); }
  function parseToNumberOrZero(v){
    if (typeof v === 'number') return Number.isFinite(v) ? v : 0;
    if (typeof v === 'string' && isNumericString(v)) return Number(v);
    if (v && typeof v === 'object') {
      try { if ('value' in v && typeof v.value === 'number') return v.value; const js = JSON.stringify(v); if (isNumericString(js)) return Number(js); } catch(e){}
    }
    return 0;
  }

  // ---------- Crypto core ----------
  async function deriveKeys(password, saltU8){
    const baseKey = await crypto.subtle.importKey("raw", strToU8(password), {name:"PBKDF2"}, false, ["deriveBits"]);
    const derived = await crypto.subtle.deriveBits({name:"PBKDF2", salt: saltU8, iterations: PBKDF2_ITERATIONS, hash:"SHA-256"}, baseKey, DERIVED_BITS);
    const db = new Uint8Array(derived);
    const aesBytes = db.slice(0,32);
    const hmacBytes = db.slice(32,64);
    const aesKey = await crypto.subtle.importKey("raw", aesBytes, {name:"AES-GCM"}, false, ["encrypt","decrypt"]);
    const hmacKey = await crypto.subtle.importKey("raw", hmacBytes, {name:"HMAC", hash:"SHA-256"}, false, ["sign","verify"]);
    return { aesKey, hmacKey };
  }
  async function computeHmac(hmacKey, dataU8){ const sig = await crypto.subtle.sign("HMAC", hmacKey, dataU8); return new Uint8Array(sig); }

  async function encryptFilePayload(secret, jsonText){
    const salt = randomBytes(SALT_BYTES);
    const iv = randomBytes(IV_BYTES);
    const { aesKey, hmacKey } = await deriveKeys(secret, salt);
    const cipherBuf = await crypto.subtle.encrypt({name:"AES-GCM", iv: iv}, aesKey, strToU8(jsonText));
    const cipher = new Uint8Array(cipherBuf);
    const macData = concatU8(salt, iv, cipher);
    const hmac = await computeHmac(hmacKey, macData);
    return `${abToB64(salt.buffer)}.${abToB64(iv.buffer)}.${abToB64(cipher.buffer)}.${abToB64(hmac.buffer)}`;
  }
  async function decryptFilePayload(secret, fileText){
    const parts = fileText.trim().split('.');
    if (parts.length !== 4) throw new Error("Invalid file format");
    const salt = b64ToU8(parts[0]);
    const iv = b64ToU8(parts[1]);
    const cipher = b64ToU8(parts[2]);
    const hmac = b64ToU8(parts[3]);
    const { aesKey, hmacKey } = await deriveKeys(secret, salt);
    const macData = concatU8(salt, iv, cipher);
    const expected = await computeHmac(hmacKey, macData);
    if (expected.length !== hmac.length) throw new Error("HMAC mismatch");
    let r = 0; for (let i=0;i<expected.length;i++) r |= expected[i] ^ hmac[i]; if (r !== 0) throw new Error("HMAC mismatch");
    const plainBuf = await crypto.subtle.decrypt({name:"AES-GCM", iv: iv}, aesKey, cipher);
    return u8ToStr(new Uint8Array(plainBuf));
  }
  async function encryptFieldString(secret, plaintextString){
    const salt = randomBytes(SALT_BYTES);
    const iv = randomBytes(IV_BYTES);
    const { aesKey, hmacKey } = await deriveKeys(secret, salt);
    const cipherBuf = await crypto.subtle.encrypt({name:"AES-GCM", iv: iv}, aesKey, strToU8(plaintextString));
    const cipher = new Uint8Array(cipherBuf);
    const macData = concatU8(salt, iv, cipher);
    const hmac = await computeHmac(hmacKey, macData);
    return `${abToB64(salt.buffer)}.${abToB64(iv.buffer)}.${abToB64(cipher.buffer)}.${abToB64(hmac.buffer)}`;
  }

  // ---------- GDevelop helpers ----------
  function getUsername(){ try{ if (typeof gdjs !== 'undefined' && gdjs.playerAuthentication && typeof gdjs.playerAuthentication.getUsername === 'function') return gdjs.playerAuthentication.getUsername(); }catch(e){} return ''; }
  function getToken(){ try{ if (typeof gdjs !== 'undefined' && gdjs.playerAuthentication && typeof gdjs.playerAuthentication.getUserToken === 'function') return gdjs.playerAuthentication.getUserToken() || ''; } catch(e){} return ''; }
  function getModShort(runtimeScene){
    try {
      const gvars = runtimeScene.getGame().getVariables();
      if (gvars && typeof gvars.get === 'function') {
        const gv = gvars.get('ModShortName');
        if (gv && typeof gv.getAsString === 'function'){ const s=gv.getAsString(); if (s && s.trim()!=='') return s; }
        if (gv) return (gv.getAsString?gv.getAsString():String(gv));
      }
    } catch(e){}
    try {
      const svs = runtimeScene.getVariables();
      if (svs && typeof svs.get === 'function') {
        const sv = svs.get('ModShortName');
        if (sv && typeof sv.getAsString === 'function'){ const s2=sv.getAsString(); if (s2 && s2.trim()!=='') return s2; }
        if (sv) return (sv.getAsString?sv.getAsString():String(sv));
      }
    } catch(e){}
    return 'online';
  }

  // ---------- Modal helpers ----------
  let modalRoot = null;
  function ensureModalRoot(){
    if (modalRoot) return modalRoot;
    const root = document.createElement('div');
    root.id = 'gd-save-modal-root';
    root.style.position = 'fixed';
    root.style.top = '0';
    root.style.left = '0';
    root.style.width = '100vw';
    root.style.height = '100vh';
    root.style.zIndex = '2147483647';
    root.style.display = 'none';
    document.body.appendChild(root);
    modalRoot = root;
    return root;
  }
  function createModal(titleHtml){
    const root = ensureModalRoot();
    root.innerHTML = '';
    root.style.display = 'flex';
    root.style.alignItems = 'center';
    root.style.justifyContent = 'center';
    root.style.background = 'rgba(0,0,0,0.45)';
    root.style.backdropFilter = 'blur(2px)';
    root.style.pointerEvents = 'auto';
    const box = document.createElement('div');
    box.style.width = 'min(94vw,820px)';
    box.style.maxHeight = '90vh';
    box.style.overflow = 'auto';
    box.style.borderRadius = '12px';
    box.style.background = '#0b1220';
    box.style.boxShadow = '0 10px 40px rgba(0,0,0,0.6)';
    box.style.padding = '16px';
    box.style.color = '#e6eef8';
    box.style.display = 'flex';
    box.style.flexDirection = 'column';
    box.style.gap = '10px';
    const header = document.createElement('div');
    header.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div style="font-size:17px;font-weight:600">${titleHtml}</div>
      <button id="gd-save-close-btn" aria-label="Fechar" title="Fechar"
        style="background:transparent;border:none;color:inherit;font-size:20px;cursor:pointer;padding:6px;border-radius:8px;">✕</button>
    </div>`;
    box.appendChild(header);
    const body = document.createElement('div');
    body.style.display = 'flex';
    body.style.flexDirection = 'column';
    body.style.gap = '8px';
    box.appendChild(body);
    const footer = document.createElement('div');
    footer.style.display = 'flex';
    footer.style.gap = '8px';
    footer.style.justifyContent = 'flex-end';
    box.appendChild(footer);
    root.appendChild(box);

    const closeBtn = header.querySelector('#gd-save-close-btn');
    function close(){
      try { root.style.display = 'none'; root.innerHTML = ''; root.remove(); } catch(e) {}
      modalRoot = null;
    }
    closeBtn.addEventListener('click', close);
    root.addEventListener('click', (ev)=>{ ev.stopPropagation(); });

    return { root, box, header, body, footer, close, closeBtn };
  }
  function createButton(text, primary=false){
    const b = document.createElement('button'); b.innerText = text;
    b.style.padding = '8px 12px'; b.style.borderRadius='8px'; b.style.border='none'; b.style.cursor='pointer'; b.style.fontSize='14px';
    if (primary){ b.style.background = 'linear-gradient(90deg,#2563eb,#7c3aed)'; b.style.color='#fff'; b.style.fontWeight='600'; }
    else { b.style.background='rgba(255,255,255,0.03)'; b.style.color='#e6eef8'; }
    return b;
  }
  function createSmallNote(txt){ const p=document.createElement('div'); p.style.fontSize='13px'; p.style.opacity='0.95'; p.innerText=txt; return p; }

  // ---------- Storage helpers with trimming ----------
  function saveToLocalFallback(key, text){
    try { localStorage.setItem(key, text); return true; } catch(e){ try { sessionStorage.setItem(key, text); return true; } catch(e2){ return false; } }
  }
  function readLocalFallback(key){ try { return localStorage.getItem(key); } catch(e){ try { return sessionStorage.getItem(key); } catch(e2){ return null; } } }

  // Return keys for prefix sorted ascending by timestamp (oldest first)
  function getFallbackKeysSortedAsc(prefix){
    const out = [];
    try {
      for (let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if (!k) continue;
        if (k.startsWith(prefix)) {
          // try extract timestamp at end
          const m = k.match(/_(\d+)$/);
          const stamp = m ? Number(m[1]) : 0;
          out.push({ key: k, stamp });
        }
      }
    } catch(e){}
    // also check sessionStorage as backup
    try {
      for (let i=0;i<sessionStorage.length;i++){
        const k = sessionStorage.key(i);
        if (!k) continue;
        if (k.startsWith(prefix)) {
          if (out.find(o=>o.key===k)) continue;
          const m = k.match(/_(\d+)$/);
          const stamp = m ? Number(m[1]) : 0;
          out.push({ key: k, stamp });
        }
      }
    } catch(e){}
    out.sort((a,b)=> (a.stamp - b.stamp) || a.key.localeCompare(b.key));
    return out.map(o=>o.key);
  }

  // Trim oldest until count < MAX_FALLBACK_ENTRIES, then store new key
  function doLocalFallbackStoreWithTrim(keyPrefix, text){
    try {
      const keysAsc = getFallbackKeysSortedAsc(keyPrefix);
      // Delete oldest until count < MAX
      while (keysAsc.length >= MAX_FALLBACK_ENTRIES){
        const oldest = keysAsc.shift();
        try { localStorage.removeItem(oldest); } catch(e){ try { sessionStorage.removeItem(oldest); } catch(e2){} }
      }
      const stamp = Date.now();
      const newKey = `${keyPrefix}_${stamp}`;
      const ok = saveToLocalFallback(newKey, text);
      return ok ? newKey : null;
    } catch(e){
      return null;
    }
  }

  function loadLocalFallbackKeys(prefix){
    // return newest-first for UI convenience
    const asc = getFallbackKeysSortedAsc(prefix);
    return asc.reverse();
  }

  async function copyToClipboard(text){ try { if (navigator.clipboard && navigator.clipboard.writeText) { await navigator.clipboard.writeText(text); return true; } const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); return true; } catch(e){ return false; } }

  // ---------- Export method primitives ----------
  function doDownloadBlob(blob, filename){
    try {
      const a = document.createElement('a');
      const url = URL.createObjectURL(blob);
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url), 1500);
      return true;
    } catch(e){ console.error('doDownloadBlob error', e); return false; }
  }
  async function doShareFile(blob, filename){
    try {
      const file = new File([blob], filename, { type: 'application/octet-stream' });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({ files: [file], title: filename });
        return true;
      }
      return false;
    } catch(e){ console.warn('doShareFile failed', e); return false; }
  }

  // ---------- Export UI ----------
  async function openExportUI(runtimeScene){
    const modal = createModal('Export save — PlayerUniversal');
    const { body, footer, root, close } = modal;

    const username = getUsername();
    if (!username) {
      body.appendChild(createSmallNote('Save available only for logged-in players (please log in from the menu)'));
      const btnClose = createButton('Close', true); footer.appendChild(btnClose); btnClose.addEventListener('click', ()=> close());
      return;
    }

    body.appendChild(createSmallNote('Exporting save for user: ' + username));
    body.appendChild(createSmallNote('Choose export method or press Export to auto-choose.'));

    const status = document.createElement('div'); status.style.fontSize='13px'; status.style.minHeight='22px'; body.appendChild(status);

    // Buttons row: method choices (no fallback explicit button)
    const methodRow = document.createElement('div'); methodRow.style.display='flex'; methodRow.style.flexWrap='wrap'; methodRow.style.gap='8px'; body.appendChild(methodRow);
    const btnDownload = createButton('Download (.save)', false);
    const btnShare = createButton('Share (mobile)', false);
    methodRow.appendChild(btnDownload); methodRow.appendChild(btnShare);

    // main footer buttons
    const btnRow = document.createElement('div'); btnRow.style.display='flex'; btnRow.style.gap='8px'; footer.appendChild(btnRow);
    const btnCancel = createButton('Cancel', false); btnRow.appendChild(btnCancel);
    const btnExport = createButton('Export (auto)', true); btnRow.appendChild(btnExport);

    btnCancel.addEventListener('click', ()=> close());

    // Core export action (returns true if some method succeeded)
    async function performExport(runtimeScene, chosenMethod){
      status.innerText = 'Generating encrypted save...';
      try {
        const gvars = runtimeScene.getGame().getVariables();
        const pu = gvars.get('PlayerUniversal');
        if (!pu) throw new Error('PlayerUniversal variable not found.');
        const payload = {};
        for (const k of FIELDS){
          try { payload[k] = pu.getChild(k).toJSObject(); } catch(e){ try { payload[k] = (pu.getChild(k).getAsString?pu.getChild(k).getAsString():null); } catch(e2){ payload[k] = null; } }
        }
        const json = JSON.stringify({ version:1, payload: payload });
        const token = getToken();
        const secret = username + (token ? ('|' + token) : '');
        if (!('crypto' in window) || !crypto.subtle) throw new Error('WebCrypto not available (required for encryption).');
        const outText = await encryptFilePayload(secret, json);

        const filename = 'PlayerUniversal.save';
        const blob = new Blob([outText], { type: 'application/octet-stream' });

        if (chosenMethod === 'download') {
          const ok = doDownloadBlob(blob, filename);
          if (ok) { status.innerText = 'Downloaded file.'; return true; }
        } else if (chosenMethod === 'share') {
          const ok = await doShareFile(blob, filename);
          if (ok) { status.innerText = 'Shared via system dialog.'; return true; }
        } else if (chosenMethod === 'auto') {
          // try anchor download first
          try {
            if (doDownloadBlob(blob, filename)) { status.innerText = 'Downloaded file.'; return true; }
          } catch(e){}
          // try share
          try {
            if (await doShareFile(blob, filename)) { status.innerText = 'Shared via system dialog.'; return true; }
          } catch(e){}
          // fallback (automatic) with trimming
          const keyPrefix = `PlayerSave_${username}_${getModShort(runtimeScene)}`;
          const key = doLocalFallbackStoreWithTrim(keyPrefix, outText);
          if (key) { status.innerText = `Saved to device storage as key: ${key}`; return true; }
          throw new Error('All export methods failed.');
        }
        // if method-specific didn't succeed, try automatic fallback (trimmed)
        const keyPrefix = `PlayerSave_${username}_${getModShort(runtimeScene)}`;
        const key = doLocalFallbackStoreWithTrim(keyPrefix, outText);
        if (key) { status.innerText = `Saved to device storage as key: ${key}`; return true; }
        throw new Error('Export method failed.');
      } catch (err) {
        status.innerText = 'Error: ' + (err && err.message ? err.message : String(err));
        console.error('Export error', err);
        return false;
      }
    }

    // wire explicit method buttons
    btnDownload.addEventListener('click', async () => {
      btnDownload.disabled = true; status.innerText = 'Starting download...';
      const ok = await performExport(runtimeScene, 'download');
      setTimeout(()=>{ btnDownload.disabled=false; if(ok) close(); }, 900);
    });
    btnShare.addEventListener('click', async () => {
      btnShare.disabled = true; status.innerText = 'Opening share...';
      const ok = await performExport(runtimeScene, 'share');
      setTimeout(()=>{ btnShare.disabled=false; if(ok) close(); }, 900);
    });

    // auto export button
    btnExport.addEventListener('click', async () => {
      btnExport.disabled = true; status.innerText = 'Exporting (auto)...';
      const ok = await performExport(runtimeScene, 'auto');
      setTimeout(()=>{ btnExport.disabled=false; if(ok) close(); }, 1100);
    });

    return;
  }

  // ---------- Import UI ----------
  async function openImportUI(runtimeScene){
    const modal = createModal('Import save — PlayerUniversal');
    const { body, footer, root, close } = modal;

    const username = getUsername();
    if (!username) {
      body.appendChild(createSmallNote('Save available only for logged-in players (please log in from the menu)'));
      const btnClose = createButton('Close', true); footer.appendChild(btnClose); btnClose.addEventListener('click', ()=> close());
      return;
    }

    body.appendChild(createSmallNote('Importing for user: ' + username));
    body.appendChild(createSmallNote('Choose a .save file, paste encrypted text, or pick a saved device entry.'));

    // file selector
    const fileInput = document.createElement('input'); fileInput.type='file'; fileInput.accept='.save,application/octet-stream,text/plain'; fileInput.style.display='block';
    body.appendChild(fileInput);
    const pasteLabel = document.createElement('div'); pasteLabel.style.fontSize='13px'; pasteLabel.innerText='Or paste encrypted save text below:'; body.appendChild(pasteLabel);
    const pasteArea = document.createElement('textarea'); pasteArea.rows=6; pasteArea.style.width='100%'; pasteArea.placeholder='Paste encrypted save text here'; body.appendChild(pasteArea);
    const btnPasteClipboard = createButton('Paste from clipboard', false); body.appendChild(btnPasteClipboard);

    // fallback list
    const fallbackListDiv = document.createElement('div'); fallbackListDiv.style.display='block'; fallbackListDiv.style.marginTop='8px'; body.appendChild(fallbackListDiv);

    const status = document.createElement('div'); status.style.minHeight='20px'; status.style.fontSize='13px'; body.appendChild(status);

    // Populate fallback localStorage saves (max 3 enforced by store)
    const modShort = getModShort(runtimeScene);
    const fallbackPrefix = `PlayerSave_${username}_${modShort}`;
    function refreshFallbackList(){
      fallbackListDiv.innerHTML = '<div style="font-size:13px;font-weight:600;margin-bottom:6px">Saved entries on device:</div>';
      const keys = loadLocalFallbackKeys(`${fallbackPrefix}_`);
      if (!keys.length) { fallbackListDiv.innerHTML += '<div style="font-size:13px;opacity:0.9">No local fallback saves found.</div>'; return; }
      for (const k of keys){
        const row = document.createElement('div'); row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.marginBottom='6px';
        const label = document.createElement('div'); label.style.fontSize='12px'; label.style.opacity='0.95'; label.innerText = k;
        const btnLoad = createButton('Load', false); const btnCopy = createButton('Copy text', false);
        row.appendChild(label); row.appendChild(btnLoad); row.appendChild(btnCopy); fallbackListDiv.appendChild(row);
        btnLoad.addEventListener('click', ()=> {
          const txt = readLocalFallback(k);
          pasteArea.value = txt || '';
          status.innerText = txt ? `Loaded ${k}` : `Could not read ${k}`;
        });
        btnCopy.addEventListener('click', async ()=>{
          const txt = readLocalFallback(k);
          if (!txt) { status.innerText = 'Empty'; return; }
          const ok = await copyToClipboard(txt);
          status.innerText = ok ? 'Copied to clipboard' : 'Failed to copy';
        });
      }
    }
    refreshFallbackList();

    btnPasteClipboard.addEventListener('click', async ()=>{
      try {
        if (navigator.clipboard && navigator.clipboard.readText) {
          const txt = await navigator.clipboard.readText();
          pasteArea.value = txt || '';
          status.innerText = 'Pasted from clipboard';
        } else {
          status.innerText = 'Clipboard API not available';
        }
      } catch(e){ status.innerText = 'Clipboard read error'; }
    });

    const btnCancel = createButton('Cancel', false); const btnImport = createButton('Import', true);
    footer.appendChild(btnCancel); footer.appendChild(btnImport);
    btnCancel.addEventListener('click', ()=> close());

    // file reading
    let fileText = null;
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if (!f) { status.innerText = 'No file selected'; fileText = null; return; }
      const reader = new FileReader();
      reader.onload = ()=> { fileText = String(reader.result); status.innerText = `File loaded (${f.name})`; };
      reader.onerror = ()=> { fileText = null; status.innerText = 'Failed to read file'; };
      reader.readAsText(f);
    });

    btnImport.addEventListener('click', async ()=>{
      status.innerText = 'Importing...';
      try {
        const token = getToken();
        const secret = username + (token ? ('|' + token) : '');
        let encryptedText = fileText || (pasteArea.value && pasteArea.value.trim()) || null;
        if (!encryptedText) { status.innerText = 'Choose a file or paste encrypted text'; return; }
        if (!('crypto' in window) || !crypto.subtle) { status.innerText = 'WebCrypto not available; cannot decrypt here.'; return; }

        // decrypt file payload
        let plain;
        try { plain = await decryptFilePayload(secret, encryptedText); } catch(e){ status.innerText = 'Decryption failed: ' + (e.message || e); console.error(e); return; }
        let parsed;
        try { parsed = JSON.parse(plain); } catch(e){ status.innerText = 'Invalid payload JSON'; console.error(e); return; }
        const payload = parsed.payload || parsed;

        // apply numeric fields into PlayerUniversal and create per-field ciphertexts in Encpt
        const gvars = runtimeScene.getGame().getVariables();
        const pu = gvars.get('PlayerUniversal');
        if (!pu) { status.innerText = 'PlayerUniversal missing'; return; }
        try { pu.getChild('Encpt'); } catch(e){}

        for (const k of FIELDS){
          try {
            const v = (payload && (k in payload)) ? payload[k] : null;
            const num = parseToNumberOrZero(v);
            try { pu.getChild(k).setNumber(num); } catch(e){ try { pu.getChild(k).setNumber(Number(num) || 0); } catch(e2){} }
            try {
              const ctxt = await encryptFieldString(secret, String(num));
              pu.getChild('Encpt').getChild(k).setString(ctxt);
            } catch(e){ console.warn('Per-field encrypt failed for', k, e); }
          } catch(e){ console.warn('Apply field error', k, e); }
        }

        // After applying fields set PlayerOnSave = 1
        try { const pv = gvars.get('PlayerOnSave'); if (pv && typeof pv.setNumber === 'function') pv.setNumber(1); } catch(e){ console.warn('Failed set PlayerOnSave', e); }

        status.innerText = 'Import applied — PlayerOnSave set to 1. Perform native save if desired.';
        setTimeout(()=>close(), 1200);
      } catch (err) {
        status.innerText = 'Import error: ' + (err && err.message ? err.message : String(err));
        console.error('Import error', err);
      }
    });

    return;
  }

  // expose to window
  window.openPlayerSaveExportUI = function(runtimeScene){ try { return openExportUI(runtimeScene); } catch(e){ console.error('openPlayerSaveExportUI', e); } };
  window.openPlayerSaveImportUI = function(runtimeScene){ try { return openImportUI(runtimeScene); } catch(e){ console.error('openPlayerSaveImportUI', e); } };

  console.log('PlayerUniversal Export/Import module (mobile-friendly, UI & storage trimming) loaded.');
})();

};
gdjs.InicioCode.userFunc0x18971b0 = function GDJSInlineCode(runtimeScene) {
"use strict";
(function(runtimeScene){
  // --- GESTÃO DE UI E CENA (AUTO-CLEANUP) ---
  // ID da interface gráfica
  const UI_ID = "gd-firebase-auth-overlay";
  
  // 1. Atualizar referência da cena global para que a lógica saiba quem é a cena atual
  window._gd_runtimeScene = runtimeScene;

  // 2. Limpeza Inteligente de UI "Zumbi"
  // Se a UI existe, mas pertence a uma cena anterior (ou foi duplicada), removemos.
  // Como o Firebase é global, podemos recriar a UI a qualquer momento sem perder o login.
  const existingUI = document.getElementById(UI_ID);
  if (existingUI) {
      // Se já existe, verificamos se precisamos reiniciar os listeners (opcional)
      // Para garantir limpeza, vamos remover e deixar o módulo recriar (soft reset da UI)
      // OU se preferir performance absoluta, mantemos:
      // existingUI.style.display = 'none'; // Esconde ao iniciar a cena
      // return; 
      
      // Decisão: Vamos destruir a UI antiga para garantir que os inputs/eventos
      // estejam limpos e vinculados ao contexto atual se necessário.
      // O módulo abaixo tem uma checagem "if (document.getElementById... return"
      // Então se removermos aqui, ele recria limpo.
      existingUI.remove();
  }

  // --- SINGLETON DA LÓGICA (FIREBASE) ---
  // A lógica de conexão e autenticação NÃO deve ser destruída ou recriada.
  if (window._gd_firebase_users_combined_v1) {
    // Apenas sinalizamos para o módulo global que a cena mudou e ele deve
    // re-injetar a UI se ela foi removida acima.
    if (window.gdFirebaseAuthUI && window.gdFirebaseAuthUI.rebuildUI) {
        window.gdFirebaseAuthUI.rebuildUI();
    }
    return;
  }
  
  // Marca como inicializado
  window._gd_firebase_users_combined_v1 = true;

  const moduleCode = `
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js';
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged,
  updateProfile,
  sendPasswordResetEmail
} from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js';
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  updateDoc,
  serverTimestamp,
  arrayUnion,
  arrayRemove
} from 'https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js';

/* ---------- Light obfuscation / API key ---------- */
function _obfDecode(b64xor) {
  const raw = atob(b64xor);
  let out = '';
  for (let i=0;i<raw.length;i++) out += String.fromCharCode(raw.charCodeAt(i) ^ 13);
  return out;
}
const _OBF_APIKEY = "TER3bF50T2hHOGNmQV9IQ2ZnX2FJYE46QWVBfko4VU9sPU9ESlJm";
const firebaseConfig = {
  apiKey: _obfDecode(_OBF_APIKEY),
  authDomain: "fnf-gdev-online.firebaseapp.com",
  projectId: "fnf-gdev-online",
  storageBucket: "fnf-gdev-online.firebasestorage.app",
  messagingSenderId: "595615246122",
  appId: "1:595615246122:web:4b545361c1f01ea1c7a053",
  measurementId: "G-MD2E4G1195"
};

// Inicialização ÚNICA do Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ---------- Crypto primitives ---------- */
const PBKDF2_ITERATIONS = 150000;
const SALT_BYTES = 16;
const IV_BYTES = 12;
const DERIVED_BITS = 512;

function strToU8(s){ return new TextEncoder().encode(String(s)); }
function u8ToStr(u){ return new TextDecoder().decode(u); }
function randomBytes(n){ const b = new Uint8Array(n); crypto.getRandomValues(b); return b; }
function abToB64(buf){ let binary=''; const bytes=new Uint8Array(buf); for(let i=0;i<bytes.length;i++) binary+=String.fromCharCode(bytes[i]); return btoa(binary); }
function b64ToU8(b64){ const binary=atob(b64); const bytes=new Uint8Array(binary.length); for(let i=0;i<binary.length;i++) bytes[i]=binary.charCodeAt(i); return bytes; }
function concatU8(...arrs){ const total=arrs.reduce((s,a)=>s+a.length,0); const out=new Uint8Array(total); let off=0; for(const a of arrs){ out.set(a, off); off+=a.length;} return out; }

async function deriveKeys(password, saltU8){
  const baseKey = await crypto.subtle.importKey("raw", strToU8(password), {name:"PBKDF2"}, false, ["deriveBits"]);
  const derived = await crypto.subtle.deriveBits({name:"PBKDF2", salt: saltU8, iterations: PBKDF2_ITERATIONS, hash:"SHA-256"}, baseKey, DERIVED_BITS);
  const dbuf = new Uint8Array(derived);
  const aesBytes = dbuf.slice(0,32);
  const hmacBytes = dbuf.slice(32,64);
  const aesKey = await crypto.subtle.importKey("raw", aesBytes, {name:"AES-GCM"}, false, ["encrypt","decrypt"]);
  const hmacKey = await crypto.subtle.importKey("raw", hmacBytes, {name:"HMAC", hash:"SHA-256"}, false, ["sign","verify"]);
  return { aesKey, hmacKey };
}

async function computeHmac(hmacKey, dataU8){ const sig = await crypto.subtle.sign("HMAC", hmacKey, dataU8); return new Uint8Array(sig); }

async function encryptFilePayload(secret, jsonText){
  const salt = randomBytes(SALT_BYTES);
  const iv = randomBytes(IV_BYTES);
  const { aesKey, hmacKey } = await deriveKeys(secret, salt);
  const cipherBuf = await crypto.subtle.encrypt({name:"AES-GCM", iv: iv}, aesKey, strToU8(jsonText));
  const cipher = new Uint8Array(cipherBuf);
  const macData = concatU8(salt, iv, cipher);
  const hmac = await computeHmac(hmacKey, macData);
  return \`\${abToB64(salt.buffer)}.\${abToB64(iv.buffer)}.\${abToB64(cipher.buffer)}.\${abToB64(hmac.buffer)}\`;
}

async function decryptFilePayload(secret, fileText){
  const parts = fileText.trim().split('.');
  if (parts.length !== 4) throw new Error("Invalid file format");
  const salt = b64ToU8(parts[0]);
  const iv = b64ToU8(parts[1]);
  const cipher = b64ToU8(parts[2]);
  const hmac = b64ToU8(parts[3]);
  const { aesKey, hmacKey } = await deriveKeys(secret, salt);
  const macData = concatU8(salt, iv, cipher);
  const expected = await computeHmac(hmacKey, macData);
  if (expected.length !== hmac.length) throw new Error("HMAC mismatch");
  let r = 0; for (let i=0;i<expected.length;i++) r |= expected[i] ^ hmac[i]; if (r !== 0) throw new Error("HMAC mismatch");
  const plainBuf = await crypto.subtle.decrypt({name:"AES-GCM", iv: iv}, aesKey, cipher);
  return u8ToStr(new Uint8Array(plainBuf));
}

async function sha256Hex(text){
  const buf = await crypto.subtle.digest('SHA-256', strToU8(text));
  const u8 = new Uint8Array(buf);
  return Array.from(u8).map(b => b.toString(16).padStart(2,'0')).join('');
}

/* ---------- GDevelop helpers ---------- */
function getUsername(){
  try{ if (typeof gdjs !== 'undefined' && gdjs.playerAuthentication && typeof gdjs.playerAuthentication.getUsername === 'function') return gdjs.playerAuthentication.getUsername(); }catch(e){}
  try { if (auth && auth.currentUser) return auth.currentUser.displayName || (auth.currentUser.email ? auth.currentUser.email.split('@')[0] : ''); } catch(e){}
  return 'guest';
}
function getToken(){
  try{ if (typeof gdjs !== 'undefined' && gdjs.playerAuthentication && typeof gdjs.playerAuthentication.getUserToken === 'function') return gdjs.playerAuthentication.getUserToken() || ''; } catch(e) {}
  return '';
}
function parseToNumberOrZero(v){
  if (typeof v === 'number') return Number.isFinite(v) ? v : 0;
  if (typeof v === 'string' && /^\\s*[+-]?(?:\\d+)(?:\\.\\d+)?\\s*$/.test(v)) return Number(v);
  if (v && typeof v === 'object') {
    try { if ('getAsNumber' in v && typeof v.getAsNumber === 'function') return v.getAsNumber();
    if ('value' in v && typeof v.value === 'number') return v.value;
    if ('value' in v && typeof v.value === 'string' && /^\\s*[+-]?(?:\\d+)(?:\\.\\d+)?\\s*$/.test(v.value)) return Number(v.value); } catch(e){}
  }
  return 0;
}

const EXPORT_FIELDS = ['BestScore','Pfcs','Points'];
function readNumericChildrenOrdered(runtimeScene){
  try {
    const gameVars = runtimeScene.getGame().getVariables();
    const pu = gameVars.get('PlayerUniversal');
    if (!pu) throw new Error('PlayerUniversal not found');
    const payload = {};
    try {
      if (typeof pu.toJSObject === 'function') {
        const obj = pu.toJSObject();
        for (const k of EXPORT_FIELDS) payload[k] = parseToNumberOrZero(obj[k]);
        return payload;
      }
    } catch(e){}
    for (const k of EXPORT_FIELDS){
      try {
        const child = pu.getChild(k);
        let val = null;
        if (child) {
          if (typeof child.getAsNumber === 'function') val = child.getAsNumber();
          else if (typeof child.getAsString === 'function') val = child.getAsString();
          else if ('value' in child) val = child.value;
        }
        payload[k] = parseToNumberOrZero(val);
      } catch(e){ payload[k] = 0; }
    }
    return payload;
  } catch(e){
    const payload = {}; for (const k of EXPORT_FIELDS) payload[k] = 0; return payload;
  }
}
function buildPlaintextSaveJson(runtimeScene){
  const ordered = {};
  const payload = readNumericChildrenOrdered(runtimeScene);
  for (const k of EXPORT_FIELDS) ordered[k] = payload[k];
  return JSON.stringify({ version: 1, payload: ordered });
}

/* ---------- Firestore helpers ---------- */
const _gd_userDocCache = {};

async function readUsersDoc(uid, opts = { force:false }){
  if (!uid) return null;
  if (!opts.force && _gd_userDocCache[uid] && _gd_userDocCache[uid].data) return _gd_userDocCache[uid].data;
  try {
    const snap = await getDoc(doc(db, 'users', uid));
    if (!snap.exists()) { _gd_userDocCache[uid] = { data: null, ts: Date.now() }; return null; }
    const data = snap.data();
    _gd_userDocCache[uid] = { data, ts: Date.now() };
    return data;
  } catch(e){ console.warn('readUsersDoc failed', e); return null; }
}

async function writeUsersDocPartial(uid, partial){
  if (!uid) throw new Error('uid required');
  const ref = doc(db, 'users', uid);
  await setDoc(ref, partial, { merge: true });
  _gd_userDocCache[uid] = _gd_userDocCache[uid] || { data: {}, ts: 0 };
  _gd_userDocCache[uid].data = Object.assign({}, _gd_userDocCache[uid].data || {}, partial);
  _gd_userDocCache[uid].ts = Date.now();
  return true;
}

async function applyDecryptedSaveToGame(runtimeScene, decryptedJsonText){
  const parsed = JSON.parse(decryptedJsonText);
  const payload = parsed.payload || parsed;
  const gvars = runtimeScene.getGame().getVariables();
  const pu = gvars.get('PlayerUniversal');
  if (!pu) throw new Error('PlayerUniversal missing');
  try {
    try { pu.getChild('Encpt'); } catch(e){}
    for (const k of EXPORT_FIELDS){
      const v = (payload && (k in payload)) ? payload[k] : 0;
      const num = parseToNumberOrZero(v);
      try { pu.getChild(k).setNumber(num); } catch(e){ try { pu.getChild(k).setNumber(Number(num) || 0); } catch(e2){} }
      try {
        const secret = getUsername() + (getToken() ? ('|' + getToken()) : '');
        const ctxt = await encryptFilePayload(secret, String(num));
        pu.getChild('Encpt').getChild(k).setString(ctxt);
      } catch(e){ console.warn('Per-field encrypt failed for', k, e); }
    }
    try { const pv = gvars.get('PlayerOnSave'); if (pv && typeof pv.setNumber === 'function') pv.setNumber(1); } catch(e){}
  } catch(e){ console.warn('applyDecryptedSaveToGame error', e); }
}

async function reconcilePlayerSave_ReadOnly(runtimeScene, opts = { forceRead:false }){
  const user = auth.currentUser;
  if (!user) return;
  const uid = user.uid;
  window._gd_reconcile_ran = window._gd_reconcile_ran || {};
  if (window._gd_reconcile_ran[uid] && !opts.forceRead) return;

  try {
    const docData = await readUsersDoc(uid, { force: !!opts.forceRead });
    if (docData && docData.playerSave && docData.playerSave.save) {
      const secret = getUsername() + (getToken() ? ('|' + getToken()) : '');
      try {
        const remotePlain = await decryptFilePayload(secret, docData.playerSave.save);
        await applyDecryptedSaveToGame(runtimeScene || window._gd_runtimeScene, remotePlain);
        console.log('Applied remote playerSave');
      } catch(e){ console.warn('Failed to decrypt remote save', e); }
    }
    window._gd_reconcile_ran[uid] = true;
  } catch(e){ console.error('reconcile error', e); }
}

async function createAndSaveEncryptedSaveInternal(runtimeScene){
  runtimeScene = runtimeScene || window._gd_runtimeScene;
  if (!runtimeScene) throw new Error('runtimeScene required');
  const user = auth.currentUser;
  if (!user) throw new Error('User not authenticated');
  const uid = user.uid;
  const plain = buildPlaintextSaveJson(runtimeScene);
  const hashHex = await sha256Hex(plain);
  const secret = getUsername() + (getToken() ? ('|' + getToken()) : '');
  const enc = await encryptFilePayload(secret, plain);
  await writeUsersDocPartial(uid, { playerSave: { save: enc, hash: hashHex, updatedAt: serverTimestamp() } });
  try {
    const gs = runtimeScene.getGame().getVariables();
    const v = gs.get('PlayerOnSave');
    if (v && typeof v.setNumber === 'function') v.setNumber(1);
  } catch(e){}
  return { uid, hash: hashHex };
}

async function saveProfileInternal({ name, avatarURL, description }){
  const user = auth.currentUser;
  if (!user) throw new Error('User not authenticated');
  const uid = user.uid;
  const toWrite = {};
  if (name !== undefined) toWrite.displayName = name;
  if (avatarURL !== undefined) toWrite.avatarURL = avatarURL;
  if (description !== undefined) toWrite.description = description;
  toWrite.updatedAt = serverTimestamp();
  await writeUsersDocPartial(uid, toWrite);
  try { await updateProfile(user, { displayName: name || user.displayName, photoURL: avatarURL || user.photoURL }); } catch(e){}
  return true;
}

/* ---------- UI CREATION (Pode ser chamada múltiplas vezes para recriar o DOM) ---------- */
function createAuthOverlayAndBind(){
  // Se já existe, não recria
  if (document.getElementById('gd-firebase-auth-overlay')) return;

  const css = \`
#gd-firebase-auth-overlay { position: fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:999999; background: rgba(0,0,0,0.45); font-family: system-ui, -apple-system, sans-serif; }
#gd-firebase-auth-card { width: 520px; max-width: calc(100% - 32px); background: #0f1724; color: #e6eef8; border-radius: 12px; box-shadow: 0 10px 30px rgba(2,6,23,0.6); padding: 18px; position:relative; min-height:120px; }
.gd-input { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); color:inherit; box-sizing:border-box; }
.gd-btn { padding:10px 12px; border-radius:8px; border:none; background:#2563eb; color:white; cursor:pointer; font-weight:600; }
.gd-link { cursor:pointer; color:#60a5fa; text-decoration:underline; margin-top:8px; display:inline-block; }
.gd-small { font-size:13px; color:#bcd7ff; margin-top:6px; }
#gd-auth-error { color:#ffd1d1; min-height:18px; margin-top:6px; font-size:13px; }
#gd-auth-close { position:absolute; right:14px; top:10px; cursor:pointer; color:#9fb8ff; font-weight:700; }
#gd-pfp-preview { width:96px; height:96px; border-radius:10px; object-fit:cover; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); }
#gd-pfp-mini { width:64px; height:64px; border-radius:8px; object-fit:cover; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.06); }
#gd-settings-actions { display:flex; gap:8px; margin-top:10px; }
#gd-auth-title { margin-bottom:6px; }
#gd-eye-btn { background: transparent; color: #9fb8ff; border: none; cursor: pointer; font-size: 14px; }
\`;
  
  if(!document.getElementById('gd-firebase-auth-style')) {
      const style = document.createElement('style');
      style.id = 'gd-firebase-auth-style';
      style.textContent = css;
      document.head.appendChild(style);
  }

  const overlay = document.createElement('div');
  overlay.id = 'gd-firebase-auth-overlay';
  overlay.style.display = 'none';
  overlay.innerHTML = \`
    <div id="gd-firebase-auth-card" role="dialog" aria-modal="true">
      <div id="gd-auth-close" title="Fechar">✕</div>
      <h2 id="gd-auth-title">Entrar</h2>
      <div id="gd-auth-forms">
        <div id="gd-login-form">
          <input id="gd-email" class="gd-input" type="email" placeholder="Email" autocomplete="email" />
          <input id="gd-password" class="gd-input" type="password" placeholder="Senha" autocomplete="current-password" />
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button id="gd-login-btn" class="gd-btn" style="flex:1;">Entrar</button>
            <button id="gd-show-register-btn" class="gd-btn" style="flex:1; background:#10B981;">Criar</button>
          </div>
          <div id="gd-auth-error"></div>
          <div id="gd-auth-footer"> <span class="gd-link" id="gd-forgot">Esqueci a senha</span> </div>
        </div>
        <div id="gd-register-form" style="display:none;">
          <input id="gd-reg-name" class="gd-input" type="text" placeholder="Nome (obrigatório)" />
          <input id="gd-reg-email" class="gd-input" type="email" placeholder="Email" autocomplete="email" />
          <input id="gd-reg-password" class="gd-input" type="password" placeholder="Senha (6+ caracteres)" />
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button id="gd-register-btn" class="gd-btn" style="flex:1; background:#10B981;">Criar Conta</button>
            <button id="gd-show-login-btn" class="gd-btn" style="flex:1; background:#64748b;">Voltar</button>
          </div>
          <div id="gd-auth-error-reg" style="color:#ffd1d1; min-height:18px; margin-top:6px; font-size:13px;"></div>
        </div>
      </div>
      <div id="gd-auth-user" style="display:none;">
        <div id="gd-user-info">
          <div id="gd-user-display" class="gd-small">Conectado</div>
          <div style="display:flex;align-items:center;gap:8px;margin-top:6px;">
            <button id="gd-eye-btn" title="Mostrar/Ocultar email">👁️</button>
            <div id="gd-user-email" class="gd-small" style="opacity:0.9;"></div>
          </div>
          <div id="gd-user-avatar-url" class="gd-small" style="opacity:0.8; margin-top:8px; word-break:break-all;"></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
          <img id="gd-pfp-mini" src="" alt="PFP" />
          <div style="display:flex; gap:8px;">
            <button id="gd-settings-btn" class="gd-btn" style="background:#0ea5a4;">Configurar</button>
            <button id="gd-logout-btn" class="gd-btn" style="background:#ef4444;">Sair</button>
          </div>
        </div>
      </div>
      <div id="gd-settings-panel" style="display:none;">
        <h3 style="margin:0 0 8px 0;font-size:15px;color:#cbe7ff;">Configurações da Conta</h3>
        <input id="gd-settings-name" class="gd-input" type="text" placeholder="Nome (obrigatório)" />
        <textarea id="gd-settings-desc" class="gd-input" placeholder="Descrição (visível ao público)" style="height:80px; resize:vertical;"></textarea>
        <div id="gd-pfp-row" style="display:flex; gap:12px; align-items:flex-start; margin-top:8px;">
          <img id="gd-pfp-preview" src="" alt="Preview" />
          <div style="flex:1;">
            <input id="gd-pfp-url" class="gd-input" type="text" placeholder="URL da imagem (apenas URL)" />
            <div style="margin-top:8px;"> <input id="gd-pfp-file" type="file" accept="image/*" /> </div>
            <div id="gd-settings-actions">
              <button id="gd-save-settings" class="gd-btn" style="background:#2563eb;">Salvar</button>
              <button id="gd-remove-pfp" class="gd-btn" style="background:#6b7280;">Remover PFP</button>
              <button id="gd-settings-back" class="gd-btn" style="background:#94a3b8;">Voltar</button>
            </div>
            <div id="gd-settings-msg" class="gd-small" style="margin-top:6px;"></div>
          </div>
        </div>
      </div>
    </div>
  \`;
  document.body.appendChild(overlay);

  const $ = id => document.getElementById(id);
  function showOverlay(){ const o=$('gd-firebase-auth-overlay'); if(o) o.style.display='flex'; }
  function hideOverlay(){ const o=$('gd-firebase-auth-overlay'); if(o) o.style.display='none'; }

  $('gd-auth-close').addEventListener('click', hideOverlay);
  $('gd-show-register-btn').addEventListener('click', ()=>{ $('gd-login-form').style.display='none'; $('gd-register-form').style.display=''; });
  $('gd-show-login-btn').addEventListener('click', ()=>{ $('gd-login-form').style.display=''; $('gd-register-form').style.display='none'; });
  $('gd-forgot').addEventListener('click', async ()=>{
    const readyEmail = $('gd-email').value.trim(); const email = readyEmail || prompt('Digite seu email para reset de senha:');
    if (!email) return;
    try { await sendPasswordResetEmail(auth, email); alert('Email de redefinição enviado!'); } catch(err){ alert('Erro: '+(err.message||err)); }
  });
  $('gd-register-btn').addEventListener('click', async ()=>{
    const name = $('gd-reg-name').value.trim(); const email = $('gd-reg-email').value.trim(); const password = $('gd-reg-password').value;
    if (!name) { $('gd-auth-error-reg').textContent = 'Nome é obrigatório.'; return; }
    try {
      const allRef = doc(db, 'names', 'AllNames'); const allSnap = await getDoc(allRef); const list = (allSnap.exists() && Array.isArray(allSnap.data().list)) ? allSnap.data().list : [];
      if (list.includes(name)) { $('gd-auth-error-reg').textContent = 'Nome já em uso.'; return; }
      const uc = await createUserWithEmailAndPassword(auth, email, password);
      const uid = uc.user.uid;
      await setDoc(doc(db, 'users', uid), { displayName: name, avatarURL: null, description: '', playerSave: null, updatedAt: serverTimestamp() });
      if (allSnap.exists()) await updateDoc(allRef, { list: arrayUnion(name) }); else await setDoc(allRef, { list: [name] });
      try { await updateProfile(uc.user, { displayName: name }); } catch(e){}
      await handleUserAfterLogin(uc.user || auth.currentUser);
    } catch(err){ console.warn('register error', err); $('gd-auth-error-reg').textContent = err && err.message ? err.message : String(err); }
  });
  $('gd-login-btn').addEventListener('click', async ()=>{
    const email = $('gd-email').value.trim(); const password = $('gd-password').value;
    $('gd-auth-error').textContent = '';
    try { const cred = await signInWithEmailAndPassword(auth, email, password); await handleUserAfterLogin(cred && cred.user ? cred.user : auth.currentUser); } catch(err){ console.warn('signIn error', err); $('gd-auth-error').textContent = err && err.message ? err.message : String(err); }
  });
  $('gd-logout-btn').addEventListener('click', async ()=>{ try { await signOut(auth); hideOverlay(); } catch(err){ alert('Erro ao sair: ' + (err && err.message ? err.message : String(err))); } });
  let emailVisible = false; $('gd-eye-btn').addEventListener('click', ()=>{ emailVisible = !emailVisible; $('gd-user-email').style.opacity = emailVisible ? '1' : '0'; });
  $('gd-settings-btn').addEventListener('click', async ()=>{ const u = auth.currentUser; if (!u) { $('gd-login-form').style.display=''; showOverlay(); return; } $('gd-settings-panel').style.display = 'block'; $('gd-auth-user').style.display='none'; showOverlay(); setTimeout(()=> populateSettingsFields(u),60); });
  $('gd-settings-back').addEventListener('click', ()=>{ $('gd-settings-panel').style.display='none'; $('gd-auth-user').style.display=''; });
  $('gd-remove-pfp').addEventListener('click', async ()=>{ const u = auth.currentUser; if (!u) { $('gd-settings-msg').textContent = 'Faça login primeiro.'; return; } try { await saveProfileInternal({ avatarURL: null }); $('gd-pfp-preview').src=''; $('gd-pfp-mini').src=''; $('gd-pfp-url').value=''; $('gd-settings-msg').textContent='PFP removida.'; updateGDevelopVarsFromUser(u); } catch(err){ $('gd-settings-msg').textContent = 'Erro: '+(err.message||err); } });
  $('gd-save-settings').addEventListener('click', async ()=>{
    const u = auth.currentUser; if (!u) { $('gd-settings-msg').textContent='Faça login primeiro.'; return; }
    const newName = $('gd-settings-name').value.trim(); const description=$('gd-settings-desc').value||''; const urlCandidate=$('gd-pfp-url').value.trim();
    if (!newName) { $('gd-settings-msg').textContent='Nome é obrigatório.'; return; }
    try {
      const allRef = doc(db, 'names', 'AllNames'); const allSnap = await getDoc(allRef); const list = (allSnap.exists() && Array.isArray(allSnap.data().list)) ? allSnap.data().list : [];
      let currentName = null; try { const ud = await readUsersDoc(u.uid); if (ud && ud.displayName) currentName = ud.displayName; } catch(e){}
      if (list.includes(newName) && newName !== currentName) { $('gd-settings-msg').textContent='Nome já em uso.'; return; }
      try { if (currentName && currentName !== newName) await updateDoc(allRef, { list: arrayRemove(currentName) }).catch(()=>{}); if (!list.includes(newName)){ if (allSnap.exists()) await updateDoc(allRef, { list: arrayUnion(newName) }); else await setDoc(allRef, { list: [newName] }); } }catch(e){}
      await saveProfileInternal({ name: newName, avatarURL: urlCandidate || null, description: description || '' }); $('gd-settings-msg').textContent='Configurações salvas.'; updateGDevelopVarsFromUser(u);
    } catch(err){ console.error('save settings error', err); $('gd-settings-msg').textContent='Erro ao salvar: '+(err&&err.message?err.message:String(err)); }
  });
  (function attachFileHandler(){
    const fileInput = $('gd-pfp-file'); if (!fileInput) return;
    fileInput.addEventListener('change', async (e)=>{
      const u = auth.currentUser; if (!u) { alert('Faça login primeiro'); return; }
      const file = e.target.files && e.target.files[0] ? e.target.files[0] : null; if (!file) return;
      $('gd-settings-msg').textContent='Convertendo...';
      try {
        const dataUrl = await (async (file)=> {
           return new Promise((res, rej)=>{
            const img = new Image(); const reader = new FileReader();
            reader.onload = ()=> { img.src = reader.result; }; reader.onerror = rej;
            img.onload = ()=> { try {
                const max = 256; const canvas = document.createElement('canvas'); canvas.width=max; canvas.height=max; const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,max,max);
                const scale = Math.min(max/img.width, max/img.height); const w = Math.round(img.width*scale); const h=Math.round(img.height*scale); const x = Math.round((max-w)/2); const y = Math.round((max-h)/2);
                ctx.drawImage(img, x, y, w, h); res(canvas.toDataURL('image/png'));
              } catch(e){ rej(e); } };
            reader.readAsDataURL(file);
          });
        })(file);
        await saveProfileInternal({ avatarURL: dataUrl }); $('gd-pfp-preview').src = dataUrl; $('gd-pfp-mini').src = dataUrl; $('gd-pfp-url').value = dataUrl; $('gd-settings-msg').textContent='Avatar salvo.'; updateGDevelopVarsFromUser(u);
      } catch(err){ console.error('avatar upload failed', err); $('gd-settings-msg').textContent='Erro ao salvar avatar.'; }
    });
  })();
  
  // Auto-fill se já estiver logado (para quando recriar UI)
  if(auth.currentUser) handleUserAfterLogin(auth.currentUser).catch(()=>{});
}

// Helpers que precisam ser acessíveis globalmente ou internamente pelo módulo
async function populateSettingsFields(user){
    try {
      const nameEl = document.getElementById('gd-settings-name');
      const urlEl = document.getElementById('gd-pfp-url'); const preview=document.getElementById('gd-pfp-preview'); const mini=document.getElementById('gd-pfp-mini'); const msg=document.getElementById('gd-settings-msg'); const descEl=document.getElementById('gd-settings-desc'); const avatarUrlDisplay=document.getElementById('gd-user-avatar-url');
      const ud = await readUsersDoc(user.uid, { force:false });
      if(nameEl) nameEl.value = (ud && ud.displayName) ? ud.displayName : (user.displayName || '');
      const avatar = (ud && ud.avatarURL) ? ud.avatarURL : (user.photoURL || '');
      if(urlEl) urlEl.value = avatar || '';
      if(preview) preview.src = avatar || '';
      if(mini) mini.src = avatar || '';
      if (avatarUrlDisplay) avatarUrlDisplay.textContent = avatar ? ('Avatar: ' + (avatar.length>80 ? avatar.slice(0,80)+'…' : avatar)) : '';
      if(descEl) descEl.value = (ud && ud.description) ? ud.description : (ud && ud.playerDescription ? ud.playerDescription : '');
      if (msg) msg.textContent = '';
    } catch(e){ console.warn('populateSettingsFields error', e); }
}

async function updateGDevelopVarsFromUser(user){
    try {
      const rs = window._gd_runtimeScene;
      if (!rs) return;
      const vars = rs.getVariables ? rs.getVariables() : (rs.getScene ? rs.getScene().getVariables() : null); if (!vars) return;
      vars.get('auth_uid').setString(user ? user.uid : ''); vars.get('auth_email').setString(user ? (user.email||'') : ''); vars.get('auth_name').setString(user ? (user.displayName||'') : ''); vars.get('auth_photo').setString(user ? (user.photoURL||'') : '');
      try {
        if (user) {
          const ud = await readUsersDoc(user.uid, { force:false });
          const url = (ud && ud.avatarURL) ? ud.avatarURL : (user.photoURL || '');
          vars.get('auth_avatar_url').setString(url || '');
          const desc = (ud && ud.description) ? ud.description : '';
          vars.get('auth_description').setString(desc || '');
          const game = rs.getGame ? rs.getGame() : (typeof runtimeGame !== 'undefined' ? runtimeGame : null);
          if (game && game.getVariables){ game.getVariables().get('auth_avatar_url').setString(url||''); game.getVariables().get('auth_description').setString(desc||''); }
        } else { vars.get('auth_avatar_url').setString(''); vars.get('auth_description').setString(''); }
      } catch(e){ console.warn('updateGDevelopVarsFromUser avatar/desc read failed', e); }
    } catch(e){ console.warn('updateGDevelopVarsFromUser error', e); }
}

async function handleUserAfterLogin(user){
    if (!user) return;
    try {
      const title = document.getElementById('gd-auth-title'); if(title) title.textContent = 'Perfil';
      const login = document.getElementById('gd-login-form'); if(login) login.style.display='none';
      const reg = document.getElementById('gd-register-form'); if(reg) reg.style.display='none';
      const panel = document.getElementById('gd-settings-panel'); if(panel) panel.style.display='none';
      const authUser = document.getElementById('gd-auth-user'); if(authUser) authUser.style.display='';
      
      const disp = document.getElementById('gd-user-display'); if(disp) disp.textContent = user.displayName || user.email || 'Usuário';
      const emailEl = document.getElementById('gd-user-email'); if(emailEl) { emailEl.textContent = user.email || ''; emailEl.style.opacity='0'; }
      try { const ud = await readUsersDoc(user.uid, { force:false });
      const url = (ud && ud.avatarURL) ? ud.avatarURL : (user.photoURL||''); 
      const mini = document.getElementById('gd-pfp-mini'); if(mini) mini.src = url || ''; 
      const ad = document.getElementById('gd-user-avatar-url'); if (ad) ad.textContent = url ? ('Avatar: ' + (url.length>80?url.slice(0,80)+'…':url)) : ''; } catch(e){ 
      const mini = document.getElementById('gd-pfp-mini'); if(mini) mini.src = user.photoURL || ''; }
      updateGDevelopVarsFromUser(user);
      try { await reconcilePlayerSave_ReadOnly(window._gd_runtimeScene); } catch(e){ console.warn('reconcile read-only failed', e); }
    } catch(e){ console.warn('handleUserAfterLogin error', e); }
}

// Global Auth State Observer
onAuthStateChanged(auth, async (user) => {
    // console.log('onAuthStateChanged', user);
    if (user) { await handleUserAfterLogin(user); }
    else { 
        const overlay = document.getElementById('gd-firebase-auth-overlay'); 
        if (overlay && overlay.style.display === 'flex') { 
            const l=document.getElementById('gd-login-form'); if(l)l.style.display=''; 
            const r=document.getElementById('gd-register-form'); if(r)r.style.display='none'; 
            const a=document.getElementById('gd-auth-user'); if(a)a.style.display='none'; 
            const s=document.getElementById('gd-settings-panel'); if(s)s.style.display='none'; 
        } 
        updateGDevelopVarsFromUser(null); 
    }
});

// EXPOSIÇÃO GLOBAL
window.gdFirebaseAuthUI = window.gdFirebaseAuthUI || {};
window.gdFirebaseAuthUI.show = () => { 
    // Garante que a UI existe antes de mostrar
    createAuthOverlayAndBind();
    const o = document.getElementById('gd-firebase-auth-overlay'); if(o) o.style.display='flex';
    const user = auth.currentUser; 
    if (user) { handleUserAfterLogin(user).catch(()=>{}); return; } 
    const l=document.getElementById('gd-login-form'); if(l)l.style.display=''; 
};
window.gdFirebaseAuthUI.hide = () => { const o=document.getElementById('gd-firebase-auth-overlay'); if(o) o.style.display='none'; };
window.gdFirebaseAuthUI.setRuntimeScene = (rs) => { window._gd_runtimeScene = rs; updateGDevelopVarsFromUser(auth.currentUser); };
window.gdFirebaseAuthUI.openSettings = () => { 
    createAuthOverlayAndBind(); // Garante UI
    const user = auth.currentUser; if (!user) { window.gdFirebaseAuthUI.show(); return; } 
    const o=document.getElementById('gd-firebase-auth-overlay'); if(o) o.style.display='flex';
    const title=document.getElementById('gd-auth-title'); if(title) title.textContent='Perfil — Configurações'; 
    const l=document.getElementById('gd-login-form'); if(l)l.style.display='none';
    const r=document.getElementById('gd-register-form'); if(r)r.style.display='none'; 
    const a=document.getElementById('gd-auth-user'); if(a)a.style.display='none'; 
    const s=document.getElementById('gd-settings-panel'); if(s)s.style.display='block'; 
    setTimeout(()=> populateSettingsFields(user),60); 
};
window.gdFirebaseAuthUI.savePlayerNow = async function(maybeRuntimeScene){ const rs = maybeRuntimeScene || window._gd_runtimeScene; return await createAndSaveEncryptedSaveInternal(rs); };
window.gdFirebaseAuthUI.saveProfile = async function(profile){ return await saveProfileInternal(profile); };
window.gdFirebaseAuthUI.readUserDoc = async function(force){ const u = auth.currentUser; if (!u) return null; return await readUsersDoc(u.uid, { force: !!force }); };
window.gdFirebaseAuthUI.rebuildUI = createAuthOverlayAndBind; // Hook para recriar se deletado

// Criação Inicial
createAuthOverlayAndBind();

// Check inicial
(async ()=>{
  try {
    if (auth && auth.currentUser && auth.currentUser.uid) {
      await new Promise(r=>setTimeout(r,120));
      await reconcilePlayerSave_ReadOnly(window._gd_runtimeScene || null);
    }
  } catch(e){ }
})();
`;

  const s = document.createElement('script');
  s.type = 'module';
  s.textContent = moduleCode;
  document.head.appendChild(s);

})(runtimeScene);
};
gdjs.InicioCode.userFunc0x1993b08 = function GDJSInlineCode(runtimeScene) {
"use strict";
(function(runtimeScene) {
    // --- SINGLETON ---
    if (window.GDJS_ULTIMATE_INSPECTOR) return;
    window.GDJS_ULTIMATE_INSPECTOR = true;

    // --- CONFIG ---
    const DOM_SELECTORS = [
        "#gdjs-mod-list-ui-final", ".skin-modal", "#skin-download-loading", 
        "#gdjs-debug-overlay", "#gdjs-ui-inspector-panel"
    ];

    // --- CRIAR UI ---
    const panel = document.createElement("div");
    panel.id = "gdjs-ultimate-inspector";
    Object.assign(panel.style, {
        position: "fixed", top: "10px", left: "10px", width: "340px", maxHeight: "90vh",
        backgroundColor: "rgba(10, 10, 12, 0.90)", backdropFilter: "blur(6px)",
        border: "1px solid rgba(255, 255, 255, 0.1)", borderRadius: "8px",
        color: "#eee", fontFamily: "Consolas, monospace", fontSize: "11px",
        padding: "0", zIndex: "2147483647", display: "none", overflowY: "auto",
        boxShadow: "0 8px 32px rgba(0,0,0,0.6)"
    });

    const header = document.createElement("div");
    header.innerHTML = "<strong>GDEVELOP PROCESS INSPECTOR</strong><span style='float:right;opacity:0.5'>[G] to Close</span>";
    Object.assign(header.style, { padding: "10px", background: "rgba(255,255,255,0.05)", borderBottom: "1px solid rgba(255,255,255,0.1)" });
    panel.appendChild(header);

    const content = document.createElement("div");
    content.style.padding = "10px";
    panel.appendChild(content);

    document.body.appendChild(panel);

    // --- HELPERS DE ESTILO ---
    function createSection(title) {
        const d = document.createElement("div");
        d.innerHTML = `__ ${title.toUpperCase()} __`;
        d.style.color = "#88efff"; d.style.margin = "12px 0 6px 0"; d.style.fontWeight = "bold";
        return d;
    }

    function createRow(label, status, actionBtn = null) {
        const row = document.createElement("div");
        Object.assign(row.style, { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "4px 0", borderBottom: "1px solid rgba(255,255,255,0.05)" });
        
        const txt = document.createElement("span");
        txt.innerHTML = `<span style="color:#aaa">${label}:</span> <span style="color:${status.includes('OFF')?'#f55':'#5f5'}">${status}</span>`;
        row.appendChild(txt);

        if (actionBtn) {
            const btn = document.createElement("button");
            btn.textContent = actionBtn.text;
            Object.assign(btn.style, { background: "#333", border: "1px solid #555", color: "#fff", borderRadius: "3px", cursor: "pointer", fontSize: "10px", padding: "2px 6px" });
            btn.onclick = () => { actionBtn.onClick(); refreshAll(); };
            row.appendChild(btn);
        }
        return row;
    }

    // --- SCANNER LOGIC ---
    function refreshAll() {
        content.innerHTML = "";

        // 1. SEÇÃO DOM (INTERFACES VISUAIS)
        content.appendChild(createSection("Interface Gráfica (DOM)"));
        let foundUI = false;
        
        // Scan específico
        DOM_SELECTORS.forEach(sel => {
            const el = document.querySelector(sel);
            if (el && el.id !== "gdjs-ultimate-inspector") {
                foundUI = true;
                const isVis = el.style.display !== 'none';
                content.appendChild(createRow(
                    sel, 
                    isVis ? "VISIBLE" : "HIDDEN", 
                    { text: "DESTROY", onClick: () => el.remove() }
                ));
            }
        });

        // Scan genérico (Z-Index alto)
        document.querySelectorAll('div').forEach(div => {
            if(DOM_SELECTORS.includes("#"+div.id) || DOM_SELECTORS.includes("."+div.className) || div.id === "gdjs-ultimate-inspector") return;
            const z = parseInt(window.getComputedStyle(div).zIndex);
            if (z > 5000 && div.innerHTML.trim() !== "") {
                foundUI = true;
                content.appendChild(createRow(
                    div.id ? "#"+div.id : "Unknown Div", 
                    "Z-IDX "+z, 
                    { text: "KILL", onClick: () => div.remove() }
                ));
            }
        });

        if(!foundUI) content.innerHTML += "<div style='color:#777'>No active UIs found.</div>";

        // 2. SEÇÃO SCRIPTS & PROCESSOS (JS GLOBALS)
        content.appendChild(createSection("Scripts & Background Tasks"));

        // -> Script A (Chart Loader)
        // Detectamos se o cache de manifesto existe
        const scriptA_Active = !!localStorage.getItem("gdjs_active_repo_id_v1"); // Indício de uso
        content.appendChild(createRow("Script A (Repo)", scriptA_Active ? "DATA STORED" : "CLEAN"));

        // -> Script B (Music Loader)
        const scriptB_Ready = !!window.GDJS_SCRIPT_B_READY;
        const scriptB_Chans = Object.keys(window.gdjsChannels || {}).length;
        const scriptB_Cache = Object.keys(window.gdjsCustomAudio || {}).length;
        
        content.appendChild(createRow("Script B (Core)", scriptB_Ready ? "RUNNING" : "OFF"));
        
        if (scriptB_Ready || scriptB_Chans > 0) {
            content.appendChild(createRow("Audio Channels", scriptB_Chans + " active", {
                text: "STOP ALL", 
                onClick: () => {
                    if(window._gdjs_stopAndCleanupAll) window._gdjs_stopAndCleanupAll(true); // Chama limpeza do Script B
                    else { // Fallback manual
                        if(window.gdjsChannels) Object.values(window.gdjsChannels).forEach(a=>a.pause());
                        window.gdjsChannels = {};
                    }
                }
            }));
            content.appendChild(createRow("Song Cache (RAM)", scriptB_Cache + " folders", {
                text: "PURGE RAM", 
                onClick: () => {
                    if(window._gdjs_stopAndCleanupAll) window._gdjs_stopAndCleanupAll(true);
                    window.gdjsCustomAudio = {};
                }
            }));
        }

        // -> Script C (FPS Monitor)
        const scriptC_Active = !!window.GDJS_FPS_MONITOR_ACTIVE;
        content.appendChild(createRow("Script C (Monitor)", scriptC_Active ? "LOOPING" : "OFF"));

        // -> Skin Loader
        const skinUI = !!window.GDSkinLoaderUI;
        content.appendChild(createRow("Skin Loader System", skinUI ? "LOADED" : "OFF"));

        // 3. SEÇÃO MEMÓRIA (Estimativa)
        content.appendChild(createSection("Memória (JS Heap)"));
        let mem = "N/A";
        if (performance && performance.memory) {
            mem = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + " MB";
        }
        const memRow = document.createElement("div");
        memRow.textContent = "JS Heap Used: " + mem;
        memRow.style.color = "#fe8";
        content.appendChild(memRow);
        
        const reloadBtn = document.createElement("button");
        reloadBtn.textContent = "FORCE PAGE RELOAD (Panic)";
        Object.assign(reloadBtn.style, { width:"100%", marginTop:"15px", padding:"8px", background:"#d22", color:"white", border:"none", borderRadius:"4px", cursor:"pointer" });
        reloadBtn.onclick = () => location.reload();
        content.appendChild(reloadBtn);
    }

    // --- LOOP DE INPUT ---
    window.addEventListener("keydown", (e) => {
        if ((e.key === "g" || e.key === "G") && !["INPUT","TEXTAREA"].includes(e.target.tagName)) {
            const isHidden = panel.style.display === "none";
            panel.style.display = isHidden ? "block" : "none";
            if (isHidden) refreshAll();
        }
    });

})(runtimeScene);
};
gdjs.InicioCode.asyncCallback34895236 = function (runtimeScene, asyncObjectsList) {
asyncObjectsList.restoreLocalVariablesContainers(gdjs.InicioCode.localVariables);
gdjs.InicioCode.localVariables.length = 0;
}
gdjs.InicioCode.idToCallbackMap.set(34895236, gdjs.InicioCode.asyncCallback34895236);
gdjs.InicioCode.eventsList1 = function(runtimeScene) {

{


{
{
const asyncObjectsList = new gdjs.LongLivedObjectsList();
asyncObjectsList.backupLocalVariablesContainers(gdjs.InicioCode.localVariables);
runtimeScene.getAsyncTasksManager().addTask(gdjs.evtTools.runtimeScene.wait(5), (runtimeScene) => (gdjs.InicioCode.asyncCallback34895236(runtimeScene, asyncObjectsList)), 34895236, asyncObjectsList);
}
}

}


};gdjs.InicioCode.eventsList2 = function(runtimeScene) {

};gdjs.InicioCode.eventsList3 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getScene().getVariables().getFromIndex(9).getAsBoolean();
}
if (isConditionTrue_0) {
{runtimeScene.getScene().getVariables().getFromIndex(9).setBoolean(false);
}
}

}


{



}


{


gdjs.InicioCode.userFunc0x18a7f40(runtimeScene);

}


{


let isConditionTrue_0 = false;
{
{gdjs.evtTools.sound.preloadSound(runtimeScene, "freakyMenu.aac");
}
{gdjs.evtTools.runtimeScene.prioritizeLoadingOfScene(runtimeScene, "All songs Death Scene");
}
{gdjs.evtTools.runtimeScene.prioritizeLoadingOfScene(runtimeScene, "Gameplay Modifiers");
}
{gdjs.evtTools.input.touchSimulateMouse(runtimeScene, true);
}
}

}


{


gdjs.InicioCode.userFunc0x18971b0(runtimeScene);

}


{


gdjs.InicioCode.userFunc0x1993b08(runtimeScene);

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.evtTools.sound.isSoundOnChannelPlaying(runtimeScene, 1));
if (isConditionTrue_0) {
{gdjs.evtTools.sound.playSoundOnChannel(runtimeScene, "freakyMenu.aac", 1, true, 80, 1);
}
{gdjs.evtTools.sound.setGlobalVolume(runtimeScene, 100);
}

{ //Subevents
gdjs.InicioCode.eventsList1(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("nextbutton"), gdjs.InicioCode.GDnextbuttonObjects1);

for (gdjs.InicioCode.forEachIndex2 = 0;gdjs.InicioCode.forEachIndex2 < gdjs.InicioCode.GDnextbuttonObjects1.length;++gdjs.InicioCode.forEachIndex2) {
gdjs.InicioCode.GDnextbuttonObjects2.length = 0;


gdjs.InicioCode.forEachTemporary2 = gdjs.InicioCode.GDnextbuttonObjects1[gdjs.InicioCode.forEachIndex2];
gdjs.InicioCode.GDnextbuttonObjects2.push(gdjs.InicioCode.forEachTemporary2);
let isConditionTrue_0 = false;
if (true) {
{for(var i = 0, len = gdjs.InicioCode.GDnextbuttonObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDnextbuttonObjects2[i].deleteFromScene(runtimeScene);
}
}
}
}

}


};gdjs.InicioCode.userFunc0x19b4be8 = function GDJSInlineCode(runtimeScene) {
"use strict";
// SCRIPT A (ORIGINAL) — OTIMIZADO + AUTO-CLEANUP (Scene Watcher)
(function () {
  const UI_ID = "gdjs-mod-list-ui-final";

  // --- SINGLETON CHECK ---
  // Se a janela já existe, apenas mostre-a (previne recriação na mesma cena)
  if (document.getElementById(UI_ID)) {
    const existing = document.getElementById(UI_ID);
    existing.style.display = "flex";
    return;
  }

  // Captura a cena atual para garantir que o script morra se mudar de cena
  let originSceneName = "";
  try { 
      if (typeof runtimeScene !== "undefined") originSceneName = runtimeScene.getName(); 
      else if (window.runtimeScene) originSceneName = window.runtimeScene.getName();
  } catch(e) {}

  // --- REPO STORAGE / HELPERS ---
  const REPO_STORAGE_KEY = "gdjs_repo_list_v1";
  const ACTIVE_REPO_KEY = "gdjs_active_repo_id_v1";
  const FAVORITES_STORAGE_KEY = "gdjs_fav_songs_v1";
  const MANIFEST_CACHE_PREFIX = "gdjs_manifest_cache_";

  function defaultRepoEntry() {
    return { id: "official", name: "oficial (LucyYuih/gdev-custom-charts)", owner: "LucyYuih", repo: "gdev-custom-charts", branch: "main", enabled: true };
  }

  function loadRepoList() {
    try {
      const raw = localStorage.getItem(REPO_STORAGE_KEY);
      if (!raw) { 
        const list = [defaultRepoEntry()]; localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list)); return list; 
      }
      return JSON.parse(raw);
    } catch (e) { const list = [defaultRepoEntry()]; localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list)); return list; }
  }

  function saveRepoList(list) {
    try { localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list || [])); } catch(e){}
  }

  function getActiveRepo() {
    try {
      const id = localStorage.getItem(ACTIVE_REPO_KEY);
      const list = loadRepoList();
      let pick = list.find(r => r.id === id && r.enabled);
      if (!pick) pick = list.find(r => r.enabled) || list[0];
      return pick || defaultRepoEntry();
    } catch(e){ return defaultRepoEntry(); }
  }

  function setActiveRepoById(id) { try { localStorage.setItem(ACTIVE_REPO_KEY, String(id)); } catch(e){} }

  function makeRepoId() { return "r_" + Math.random().toString(36).slice(2,10); }

  function parseRepoInput(input) {
    if (!input) return null;
    input = input.trim();
    if (/manifest\.json/.test(input) || /^https?:\/\//.test(input)) {
      const m = input.match(/cdn\.jsdelivr\.net\/gh\/([^\/]+)\/([^@\/]+)@([^\/]+)\/.*manifest\.json/i);
      if (m) return { owner: m[1], repo: m[2], branch: m[3], manifestUrl: input };
      return { owner: "", repo: "", branch: "", manifestUrl: input };
    }
    const m2 = input.match(/^([^\/\s]+)\/([^@\/\s]+)(?:@(.+))?$/);
    if (m2) {
      return { owner: m2[1], repo: m2[2], branch: m2[3] || "main" };
    }
    return null;
  }

  function buildManifestCdnUrl(entry) {
    if (!entry) return null;
    if (entry.manifestUrl) return entry.manifestUrl;
    if (entry.owner && entry.repo) return `https://cdn.jsdelivr.net/gh/${entry.owner}/${entry.repo}@${entry.branch}/manifest.json`;
    return null;
  }

  function buildManifestRawUrl(entry) {
    if (!entry) return null;
    if (entry.manifestUrl) return entry.manifestUrl; 
    if (entry.owner && entry.repo) {
        return `https://raw.githubusercontent.com/${entry.owner}/${entry.repo}/${entry.branch || "main"}/manifest.json`;
    }
    return null;
  }

  // --- HELPERS ---
  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
  function isAudioFile(name){ return /\.(mp3|ogg|wav|aac|m4a)$/i.test(name); }
  function isJsonFile(name){ return /\.json$/i.test(name); }
  function basenameNoExt(p){ if(!p) return "";
    const s = p.split("/").pop(); return s.replace(/\.[^.]+$/, ""); }

  // --- MANIFEST LOGIC ---
  function getBaseUrl(manifest) {
    if (manifest && manifest._base) {
      return `https://cdn.jsdelivr.net/gh/${manifest._base}/`;
    }
    const activeRepo = getActiveRepo();
    return `https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/`;
  }

  function buildFileUrl(baseUrl, folderPath, filePath) {
    if (!filePath) return null;
    if (filePath.startsWith("http://") || filePath.startsWith("https://")) return filePath;
    if (filePath.indexOf('/') !== -1) {
      return baseUrl + filePath.replace(/^\/+/,'');
    }
    if (folderPath && folderPath !== "") {
      return baseUrl + folderPath.replace(/^\/+|\/+$/g,'') + "/" + filePath;
    }
    return baseUrl + filePath;
  }

  function parseManifestEntry(entry, baseUrl = "", folderPath = "") {
    if (!entry) return null;
    if (Array.isArray(entry) && entry.length > 0 && typeof entry[0] === "string") {
      const firstItem = entry[0];
      if (firstItem.includes('.') || firstItem.includes('/')) {
        return {
          type: 'files',
          value: entry.map(filePath => {
            const fileName = filePath.split('/').pop();
            const url = buildFileUrl(baseUrl, folderPath, filePath);
            return { name: fileName, type: "file", url: url };
          })
        };
      } else {
        return { type: 'subdirs', value: entry.slice() };
      }
    }
    if (typeof entry === 'object' && entry !== null && !Array.isArray(entry)) {
      if (entry.subdirs && entry.files) {
        return {
          type: 'folder',
          subdirs: entry.subdirs,
          files: entry.files.map(filePath => {
            const fileName = filePath.split('/').pop();
            const url = buildFileUrl(baseUrl, folderPath, filePath);
            return { name: fileName, type: "file", url: url };
          })
        };
      }
    }
    if (Array.isArray(entry) && entry.length > 0 && typeof entry[0] === "object") {
      return {
        type: 'files',
        value: entry.map(item => {
          const name = item.n || item.name;
          const urlRaw = item.u || item.url || "";
          let url;
          if (!urlRaw) { url = buildFileUrl(baseUrl, folderPath, name); } 
          else if (urlRaw.startsWith("http://") || urlRaw.startsWith("https://") || urlRaw.indexOf('/') !== -1) {
            url = urlRaw.startsWith("http") ? urlRaw : baseUrl + urlRaw.replace(/^\/+/,'');
          } else { url = buildFileUrl(baseUrl, folderPath, urlRaw); }
          return { name: name, type: "file", url: url };
        })
      };
    }
    return null;
  }

  async function tryManifestFromGameVar(runtimeScene) {
    try {
      if (typeof runtimeScene !== "undefined" && runtimeScene.getGame) {
        const gg = runtimeScene.getGame().getVariables();
        if (gg.has("manifestjson")) {
          const s = gg.get("manifestjson").getAsString();
          if (s && s.trim()) { try { return JSON.parse(s); } catch(e) { return null; } }
        }
      }
    } catch(e){}
    return null;
  }

  async function tryManifestFromProjectResource() {
    try {
      const tries = ["manifest.json","resources/manifest.json","res/manifest.json","./manifest.json"];
      for (const p of tries) {
        try { const r = await fetch(p, {cache:"no-cache"});
        if (r.ok) { try { return await r.json(); } catch(e){} } } catch(e){}
      }
    } catch(e){}
    return null;
  }

  async function tryManifestFromCdnOf(entry) {
    try {
      const url = buildManifestCdnUrl(entry);
      if (!url) return null;
      const r = await fetch(url, {cache:"no-cache"});
      if (r.ok) return await r.json();
    } catch(e){}
    return null;
  }

  async function tryManifestFromRawNetwork(entry) {
    try {
        const url = buildManifestRawUrl(entry);
        if(!url) return null;
        const r = await fetch(url + "?t=" + Date.now()); 
        if(r.ok) return await r.json();
    } catch(e){}
    return null;
  }

  async function tryManifestFromGithubApiFor(entry, path="") {
    if (!entry || (!entry.owner || !entry.repo)) throw new Error("Invalid repo entry");
    const apiUrl = `https://api.github.com/repos/${entry.owner}/${entry.repo}/contents/${encodeURIComponent(path)}?ref=${entry.branch || "main"}`;
    let token = "";
    try { token = localStorage.getItem("gdjs_github_token") || ""; } catch(e){}
    const headers = token ? { "Authorization": "token " + token } : {};
    const r = await fetch(apiUrl, { headers });
    if (!r.ok) throw new Error(`GitHub API: ${r.status}`);
    const json = await r.json();
    return json.map(item => ({ name: item.name, path: item.path, type: item.type, download_url: item.download_url || null }));
  }

  const _manifest_cache_by_repo = {};

  async function loadManifestPreferLocalFor(entry, runtimeScene) {
    const repoId = (entry && entry.id) ? entry.id : "__default__";
    if (typeof _manifest_cache_by_repo[repoId] !== "undefined" && _manifest_cache_by_repo[repoId] !== null) {
        return _manifest_cache_by_repo[repoId];
    }
    const storageKey = MANIFEST_CACHE_PREFIX + repoId;
    const fromNetwork = await tryManifestFromRawNetwork(entry);
    if (fromNetwork) {
        try { localStorage.setItem(storageKey, JSON.stringify(fromNetwork)); } catch(e) {}
        _manifest_cache_by_repo[repoId] = fromNetwork;
        return fromNetwork;
    }
    try {
        const localRaw = localStorage.getItem(storageKey);
        if (localRaw) {
            const parsed = JSON.parse(localRaw);
            if (parsed) { _manifest_cache_by_repo[repoId] = parsed; return parsed; }
        }
    } catch(e) {}
    const fromVar = await tryManifestFromGameVar(runtimeScene);
    if (fromVar) { _manifest_cache_by_repo[repoId] = fromVar; return fromVar; }
    const fromRes = await tryManifestFromProjectResource();
    if (fromRes) { _manifest_cache_by_repo[repoId] = fromRes; return fromRes; }
    const fromCdn = await tryManifestFromCdnOf(entry);
    if (fromCdn) { _manifest_cache_by_repo[repoId] = fromCdn; return fromCdn; }
    _manifest_cache_by_repo[repoId] = null;
    return null;
  }

  async function ghListForFolderUsingEntry(entry, path="") {
    if (!entry || (!entry.owner || !entry.repo)) throw new Error("No GitHub owner/repo specified for ghList");
    return await tryManifestFromGithubApiFor(entry, path);
  }

  // --- UI CREATION ---
  const container = document.createElement("div");
  container.id = UI_ID;
  Object.assign(container.style, {
    position: "fixed", left: "0", top: "0", right: "0", bottom: "0",
    zIndex: 9999999, fontFamily: "Inter, system-ui, Arial", color: "#eee",
    overflow: "hidden", display: "flex", flexDirection: "column",
    background: "linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.95))"
  });
  
  const header = document.createElement("div");
  Object.assign(header.style, { padding: "10px", display: "flex", gap: "8px", alignItems: "center", borderBottom: "1px solid rgba(255,255,255,0.04)", flex: "0 0 auto" });
  header.innerHTML = `
    <div style="display:flex;gap:8px;align-items:center">
      <div style="font-weight:700">Mods</div>
      <select id="gdjs-repo-select" style="padding:6px;border-radius:6px;background:#0b0b0b;color:#eee;border:1px solid rgba(255,255,255,0.06)"></select>
      <button id="gdjs-repo-manage" style="padding:6px;border-radius:6px">Gerenciar Repos</button>
      <button id="gdjs-repo-refresh" style="padding:6px;border-radius:6px">Atualizar</button>
      <button id="gdjs-repo-cache" style="padding:6px;border-radius:6px">Ver Cache</button>
    </div>
    <input id="gdjs-final-search" placeholder="Pesquisar mods / músicas..." style="margin-left:8px;flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b0b0b;color:#eee" />
    <button id="gdjs-final-close" style="margin-left:8px;padding:6px;border-radius:6px">Fechar</button>
  `;
  const main = document.createElement("div");
  Object.assign(main.style, { display: "flex", gap: "10px", padding: "10px", flex: "1 1 auto", minHeight: 0, overflow: "hidden" });
  const leftPane = document.createElement("div");
  Object.assign(leftPane.style, { width: "38%", minWidth: "260px", maxWidth: "640px", overflowY: "auto", borderRight: "1px solid rgba(255,255,255,0.03)", paddingRight: "8px" });
  const rightPane = document.createElement("div");
  Object.assign(rightPane.style, { flex: "1 1 auto", overflowY: "auto", paddingLeft: "8px" });
  const footer = document.createElement("div");
  Object.assign(footer.style, { padding: "10px", borderTop: "1px solid rgba(255,255,255,0.04)", display: "flex", gap: "12px", alignItems: "center", flex: "0 0 auto" });
  footer.innerHTML = `<div id="gdjs-final-status" style="font-size:13px;opacity:0.9"></div><div id="gdjs-final-last" style="margin-left:auto;font-size:13px;opacity:0.85"></div>`;

  container.appendChild(header);
  main.appendChild(leftPane); main.appendChild(rightPane);
  container.appendChild(main); container.appendChild(footer);
  document.body.appendChild(container);

  // --- UI REFS ---
  const repoSelect = document.getElementById("gdjs-repo-select");
  const btnManage = document.getElementById("gdjs-repo-manage");
  const btnRefresh = document.getElementById("gdjs-repo-refresh");
  const btnCache = document.getElementById("gdjs-repo-cache");
  const btnClose = document.getElementById("gdjs-final-close");
  const searchInput = document.getElementById("gdjs-final-search");
  const statusEl = document.getElementById("gdjs-final-status");
  const lastEl = document.getElementById("gdjs-final-last");

  function setStatus(s){ statusEl.textContent = s || ""; }
  function setLast(s){ lastEl.textContent = s || ""; }

  // --- STATE ---
  let currentModPath = "";
  let modsList = [];
  let songsList = [];
  let modElementMap = {};
  let songElementMap = {};
  let favorites = loadFavorites();

  // --- FAVORITES ---
  function loadFavorites() {
    try { const raw = localStorage.getItem(FAVORITES_STORAGE_KEY); if (!raw) return []; return JSON.parse(raw) || []; } catch(e){ return []; }
  }
  function saveFavorites() {
    try { localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(favorites || [])); } catch(e){}
    try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){}
  }
  function isFavorite(path) { if (!path) return false; return favorites.some(f => f.path === path); }
  function addFavorite(path, name) {
    if (!path || isFavorite(path)) return;
    const entry = { path: path, name: name || basenameNoExt(path.split("/").pop()||path), repoId: getActiveRepo().id || null };
    favorites.push(entry); saveFavorites();
  }
  function removeFavorite(path) { if (!path) return; favorites = (favorites || []).filter(f => f.path !== path); saveFavorites(); }
  function toggleFavorite(path, name) {
    if (isFavorite(path)) removeFavorite(path); else addFavorite(path, name);
    if (songElementMap[path] && songElementMap[path].favIcon) { try { songElementMap[path].favIcon.textContent = isFavorite(path) ? "★" : "☆"; } catch(e){} }
    if (currentModPath === "__favorites__") openMod("__favorites__");
  }

  // --- REPO UI ---
  function renderRepoSelect() {
    const list = loadRepoList();
    repoSelect.innerHTML = "";
    for (const r of list) {
      const opt = document.createElement("option");
      opt.value = r.id;
      opt.textContent = (r.enabled ? "● " : "○ ") + (r.name || (r.owner? (r.owner + "/" + r.repo + (r.branch? "@" + r.branch : "")) : r.manifestUrl || "custom"));
      repoSelect.appendChild(opt);
    }
    const active = getActiveRepo();
    setActiveRepoById(active.id);
    try { repoSelect.value = active.id; } catch(e){}
  }

  function showRepoManagerModal() {
    const overlay = document.createElement("div");
    Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000000, display: "flex", alignItems: "center", justifyContent: "center" });
    const box = document.createElement("div");
    Object.assign(box.style, { width: "720px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" });
    box.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">Gerenciar Repositórios</div><div style="margin-left:auto;font-size:13px;opacity:0.85">Formato: owner/repo@branch ou URL do manifest</div></div><div style="margin-top:10px" id="gdjs-repo-list-area"></div><div style="margin-top:10px;display:flex;gap:8px"><input id="gdjs-repo-input" placeholder="ex: LucyYuih/gdev-custom-charts@main" style="flex:1;padding:8px;border-radius:6px;background:#0b0b0b;color:#eee;border:1px solid rgba(255,255,255,0.06)"/><button id="gdjs-repo-add" style="padding:8px;border-radius:6px">Adicionar</button></div><div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="gdjs-repo-close" style="padding:8px;border-radius:6px">Fechar</button></div>`;
    overlay.appendChild(box); document.body.appendChild(overlay);
    const listArea = box.querySelector("#gdjs-repo-list-area");
    function renderListArea() {
      const lst = loadRepoList();
      listArea.innerHTML = "";
      for (const r of lst) {
        const row = document.createElement("div");
        Object.assign(row.style, { display: "flex", gap: "8px", alignItems: "center", padding: "6px", borderRadius: "6px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))", marginBottom: "6px" });
        const label = document.createElement("div"); label.style.flex = "1"; label.innerHTML = `<div style="font-weight:600">${r.name || (r.owner? (r.owner + "/" + r.repo) : r.manifestUrl)}</div><div style="font-size:12px;opacity:0.8">${r.owner? (r.owner + "/" + r.repo + (r.branch? "@" + r.branch : "")) : r.manifestUrl}</div>`;
        const controls = document.createElement("div"); controls.style.display = "flex"; controls.style.gap = "6px";
        const toggle = document.createElement("button"); toggle.textContent = r.enabled ? "Ativo" : "Desativar"; toggle.style.padding = "6px"; toggle.style.borderRadius = "6px";
        toggle.onclick = () => { r.enabled = !r.enabled; saveRepoList(lst); renderListArea(); renderRepoSelect(); };
        const setActiveBtn = document.createElement("button"); setActiveBtn.textContent = "Selecionar"; setActiveBtn.style.padding = "6px"; setActiveBtn.style.borderRadius = "6px";
        setActiveBtn.onclick = () => { setActiveRepoById(r.id); renderRepoSelect(); loadFolder(""); overlay.remove(); };
        const del = document.createElement("button"); del.textContent = "Excluir"; del.style.padding = "6px"; del.style.borderRadius = "6px";
        del.onclick = () => { const idx = lst.findIndex(x=>x.id===r.id); if (idx>=0) { lst.splice(idx,1); saveRepoList(lst); renderListArea(); renderRepoSelect(); } };
        controls.appendChild(toggle); controls.appendChild(setActiveBtn); controls.appendChild(del);
        row.appendChild(label); row.appendChild(controls); listArea.appendChild(row);
      }
      if ((lst||[]).length === 0) listArea.innerHTML = "<div style='opacity:0.8'>Nenhum repositório adicionado.</div>";
    }
    renderListArea();
    const input = box.querySelector("#gdjs-repo-input");
    box.querySelector("#gdjs-repo-add").onclick = () => {
      const v = input.value.trim(); if (!v) return;
      const parsed = parseRepoInput(v);
      if (!parsed) { alert("Formato inválido"); return; }
      const list = loadRepoList();
      const entry = { id: makeRepoId(), name: parsed.owner? (parsed.owner + "/" + parsed.repo + (parsed.branch? "@" + parsed.branch : "")) : (parsed.manifestUrl || v), owner: parsed.owner||"", repo: parsed.repo||"", branch: parsed.branch||"main", manifestUrl: parsed.manifestUrl||null, enabled: true };
      list.push(entry); saveRepoList(list); input.value = ""; renderListArea(); renderRepoSelect();
    };
    box.querySelector("#gdjs-repo-close").onclick = () => overlay.remove();
  }

  // --- CACHE MANAGER ---
  function showCacheManager() {
    const overlay = document.createElement("div");
    Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000000, display: "flex", alignItems: "center", justifyContent: "center" });
    const box = document.createElement("div");
    Object.assign(box.style, { width: "760px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" });
    box.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">Cache de Músicas</div><div style="margin-left:auto;font-size:13px;opacity:0.85">Gerencie músicas baixadas</div></div><div id="gdjs-cache-list" style="margin-top:10px"></div><div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end"><button id="gdjs-cache-clear" style="padding:8px;border-radius:6px">Limpar Tudo</button><button id="gdjs-cache-close" style="padding:8px;border-radius:6px">Fechar</button></div>`;
    overlay.appendChild(box); document.body.appendChild(overlay);
    const listArea = box.querySelector("#gdjs-cache-list");
    function renderCache() {
      const keys = Object.keys(window.gdjsCustomAudio || {});
      listArea.innerHTML = "";
      if (!keys || keys.length === 0) { listArea.innerHTML = "<div style='opacity:0.8'>Nenhuma música em cache.</div>"; return; }
      for (const k of keys) {
        const row = document.createElement("div");
        Object.assign(row.style, { display: "flex", gap: "8px", alignItems: "center", padding: "8px", borderRadius: "6px", marginBottom: "6px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" });
        const label = document.createElement("div"); label.style.flex = "1"; label.innerHTML = `<div style="font-weight:600">${k}</div><div style="font-size:12px;opacity:0.8">${Object.keys((window.gdjsCustomAudio[k] && window.gdjsCustomAudio[k].audios) || {}).length} audios • ${Object.keys((window.gdjsCustomAudio[k] && window.gdjsCustomAudio[k].rawFiles) || {}).length} jsons</div>`;
        const btns = document.createElement("div"); btns.style.display = "flex"; btns.style.gap = "6px";
        const del = document.createElement("button"); del.textContent = "Deletar"; del.style.padding = "6px"; del.style.borderRadius = "6px";
        del.onclick = () => { 
            try { const data = window.gdjsCustomAudio[k]; if (data && data.audios) Object.values(data.audios).forEach(a => { if (a.blobUrl) URL.revokeObjectURL(a.blobUrl); }); } catch(e){} 
            delete window.gdjsCustomAudio[k]; renderCache(); 
        };
        const openBtn = document.createElement("button"); openBtn.textContent = "Abrir pasta"; openBtn.style.padding = "6px"; openBtn.style.borderRadius = "6px";
        openBtn.onclick = () => { showCacheDetails(k); };
        btns.appendChild(openBtn); btns.appendChild(del); row.appendChild(label); row.appendChild(btns); listArea.appendChild(row);
      }
    }
    function showCacheDetails(key) {
      const data = window.gdjsCustomAudio && window.gdjsCustomAudio[key];
      const modal = document.createElement("div");
      Object.assign(modal.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000001, display: "flex", alignItems: "center", justifyContent: "center" });
      const b = document.createElement("div"); Object.assign(b.style, { width: "720px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", color: "#eee" });
      b.innerHTML = `<div style="font-weight:700;margin-bottom:8px">${key}</div><div id="gdjs-cache-detail-list" style="display:flex;flex-direction:column;gap:6px"></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button id="gdjs-cache-detail-close" style="padding:8px;border-radius:6px">Fechar</button></div>`;
      modal.appendChild(b); document.body.appendChild(modal);
      const listEl = b.querySelector("#gdjs-cache-detail-list");
      const audios = (data && data.audios) ? Object.keys(data.audios) : [];
      const raws = (data && data.rawFiles) ? Object.keys(data.rawFiles) : [];
      if (audios.length === 0 && raws.length === 0) listEl.innerHTML = "<div style='opacity:0.8'>Vazio</div>";
      for (const a of audios) {
        const row = document.createElement("div"); row.style.display = "flex"; row.style.justifyContent = "space-between"; row.style.alignItems = "center";
        row.innerHTML = `<div>${a}</div>`;
        const btn = document.createElement("button"); btn.textContent = "Deletar"; btn.style.padding = "6px"; btn.style.borderRadius = "6px";
        btn.onclick = () => { try { if(data.audios[a] && data.audios[a].blobUrl) URL.revokeObjectURL(data.audios[a].blobUrl); delete data.audios[a]; } catch(e){} row.remove(); };
        row.appendChild(btn); listEl.appendChild(row);
      }
      for (const r of raws) {
        const row = document.createElement("div"); row.style.display = "flex"; row.style.justifyContent = "space-between"; row.style.alignItems = "center";
        row.innerHTML = `<div>${r}</div>`;
        const btn = document.createElement("button"); btn.textContent = "Deletar"; btn.style.padding = "6px"; btn.style.borderRadius = "6px";
        btn.onclick = () => { try { delete data.rawFiles[r]; } catch(e){} row.remove(); };
        row.appendChild(btn); listEl.appendChild(row);
      }
      b.querySelector("#gdjs-cache-detail-close").onclick = () => modal.remove();
    }
    box.querySelector("#gdjs-cache-clear").onclick = () => {
      if (!confirm("Deletar todo o cache de músicas?")) return;
      try { if (window.gdjsCustomAudio) Object.values(window.gdjsCustomAudio).forEach(folder => { if(folder.audios) Object.values(folder.audios).forEach(a => { if(a.blobUrl) URL.revokeObjectURL(a.blobUrl); }); }); } catch(e){}
      try { window.gdjsCustomAudio = {}; } catch(e){}
      renderCache();
    };
    box.querySelector("#gdjs-cache-close").onclick = () => overlay.remove();
    renderCache();
  }

  // --- LIST RENDERING ---
  function renderModsList(items) {
    leftPane.innerHTML = "";
    modElementMap = {};
    const favCount = (favorites || []).length;
    const favRow = document.createElement("div");
    Object.assign(favRow.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", cursor: "pointer", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" });
    const leftFav = document.createElement("div"); leftFav.style.display = "flex"; leftFav.style.flexDirection = "column"; leftFav.innerHTML = `<div style="font-weight:600">Favorites</div><div style="font-size:12px;opacity:0.8">${favCount} músicas</div>`;
    favRow.appendChild(leftFav); favRow.onclick = ()=> openMod("__favorites__"); leftPane.appendChild(favRow);
    modElementMap["__favorites__"] = { element: favRow, data: { name: "Favorites", path: "__favorites__" } };
    if (!items || items.length === 0) { const e = document.createElement("div"); e.textContent = "Nenhum mod encontrado."; e.style.opacity = "0.8"; leftPane.appendChild(e); return; }
    for (const item of items) {
      const row = document.createElement("div");
      Object.assign(row.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", cursor: "pointer", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))", transition: "transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease" });
      row.addEventListener('mouseenter', ()=> { try { row.style.transform = "translateY(-4px) scale(1.02)"; row.style.boxShadow = "0 10px 30px rgba(0,0,0,0.45)"; row.style.background = "linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008))"; } catch(e){} });
      row.addEventListener('mouseleave', ()=> { try { row.style.transform = "translateY(0) scale(1)"; row.style.boxShadow = "none"; row.style.background = "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))"; } catch(e){} });
      const left = document.createElement("div"); left.style.display = "flex"; left.style.flexDirection = "column"; left.innerHTML = `<div style="font-weight:600">${item.name}</div>`;
      row.appendChild(left); row.onclick = ()=> openMod(item.path); leftPane.appendChild(row);
      modElementMap[item.path] = { element: row, data: item };
    }
  }

  function renderSongsList(items) {
    rightPane.innerHTML = "";
    songElementMap = {};
    if (!items || items.length === 0) { const e = document.createElement("div"); e.textContent = "Selecione um mod à esquerda."; e.style.opacity = "0.8"; rightPane.appendChild(e); return; }
    for (const item of items) {
      const row = document.createElement("div");
      Object.assign(row.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" });
      const left = document.createElement("div"); left.style.display = "flex"; left.style.flexDirection = "column"; left.innerHTML = `<div style="font-weight:600">${item.name}</div>`;
      const right = document.createElement("div"); right.style.display = "flex"; right.style.gap = "8px"; right.style.alignItems = "center";
      const favIcon = document.createElement("div"); favIcon.textContent = isFavorite(item.path) ? "★" : "☆";
      Object.assign(favIcon.style, { cursor: "pointer", fontSize: "18px", userSelect: "none" });
      favIcon.onclick = (ev) => { ev.stopPropagation(); toggleFavorite(item.path, item.name); };
      const checkBtn = document.createElement("button"); checkBtn.textContent = "Checando..."; checkBtn.disabled = true; checkBtn.style.padding="6px"; checkBtn.style.borderRadius="6px";
      right.appendChild(favIcon); right.appendChild(checkBtn); row.appendChild(left); row.appendChild(right); rightPane.appendChild(row);
      songElementMap[item.path] = { element: row, data: item, rightContainer: right, placeholderBtn: checkBtn, name: item.name, favIcon: favIcon };
    }
    startBackgroundCheckOnSongs(items);
  }

  // --- BACKGROUND CHECK ---
  let bgController = null;
  const hasSubCache = {};
  function startBackgroundCheckOnSongs(items) {
    if (bgController && typeof bgController.abort === "function") try { bgController.abort(); } catch(e){}
    bgController = { aborted:false, abort(){ this.aborted=true; } };
    const list = items || [];
    const concurrency = 3; let idx = 0;
    const activeRepo = getActiveRepo();
    async function worker() {
      while(!bgController.aborted) {
        if (idx >= list.length) break;
        const p = list[idx++].path;
        try {
          if (typeof hasSubCache[p] !== "undefined") { updateButtonsForDecisionFromCache(p, hasSubCache[p]); await sleep(0); continue; }
          const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined);
          let hasSubdirs = false;
          if (manifest && manifest.hasOwnProperty(p)) {
            const baseUrl = getBaseUrl(manifest);
            const parsed = parseManifestEntry(manifest[p], baseUrl, p);
            if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs && parsed.subdirs.length > 0))) hasSubdirs = true;
          } else {
            try { const api = await ghListForFolderUsingEntry(activeRepo, p).catch(()=>[]); hasSubdirs = Array.isArray(api) && api.some(x=>x.type==="dir"); } catch(e) { hasSubdirs = false; }
          }
          hasSubCache[p] = hasSubdirs; updateButtonsForDecisionFromCache(p, hasSubdirs);
        } catch(e){}
        await sleep(40);
      }
    }
    for (let i=0;i<concurrency;i++) worker();
  }

  function updateButtonsForDecisionFromCache(path, hasSubdirs) {
    const el = songElementMap[path]; if (!el) return;
    const right = el.rightContainer; right.innerHTML = "";
    const itemName = el.name || path.split("/").pop();
    const favIcon = document.createElement("div"); favIcon.textContent = isFavorite(path) ? "★" : "☆";
    Object.assign(favIcon.style, { cursor: "pointer", fontSize: "18px", userSelect: "none" });
    favIcon.onclick = (ev) => { ev.stopPropagation(); toggleFavorite(path, itemName); };
    if (hasSubdirs) {
      const pickBtn = document.createElement("button"); pickBtn.textContent = "Selecionar difficulty"; pickBtn.style.padding="6px"; pickBtn.style.borderRadius="6px";
      pickBtn.onclick = async ()=>{ 
        try {
          setStatus("Carregando difficulties de " + itemName + "...");
          const activeRepo = getActiveRepo();
          const subdirs = await fetchSubdirsUsingEntry(activeRepo, path);
          if (!subdirs || subdirs.length === 0) { setStatus("Nenhuma difficulty encontrada."); return; }
          showDifficultyChooser(path, subdirs); setStatus("");
        } catch(e){ setStatus("Erro listando difficulties."); }
      };
      right.appendChild(favIcon); right.appendChild(pickBtn);
    } else {
      const dlBtn = document.createElement("button"); dlBtn.textContent = "Selecionar e baixar"; dlBtn.style.padding="6px"; dlBtn.style.borderRadius="6px";
      dlBtn.onclick = ()=> downloadSongFolder(path);
      right.appendChild(favIcon); right.appendChild(dlBtn);
    }
    if (songElementMap[path]) songElementMap[path].favIcon = favIcon;
  }

  async function fetchSubdirsUsingEntry(entry, folderPath) {
    try {
      const manifest = await loadManifestPreferLocalFor(entry, window.runtimeScene || undefined);
      if (manifest && manifest.hasOwnProperty(folderPath)) {
        const baseUrl = getBaseUrl(manifest);
        const parsed = parseManifestEntry(manifest[folderPath], baseUrl, folderPath);
        if (parsed && parsed.type === 'subdirs') return parsed.value.slice();
        else if (parsed && parsed.type === 'folder' && parsed.subdirs) return parsed.subdirs.slice();
      }
    } catch(e){}
    try {
      const api = await ghListForFolderUsingEntry(entry, folderPath);
      return (api || []).filter(i=> i.type === "dir").map(i=> i.name);
    } catch(e){ return []; }
  }

  async function loadFolder(path="") {
    try {
      setStatus("Carregando pasta...");
      const activeRepo = getActiveRepo();
      for (const d of (modsList||[])) delete hasSubCache[d.path];
      const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined);
      let items = [];
      if (manifest && manifest.hasOwnProperty(path)) {
        const baseUrl = getBaseUrl(manifest);
        const parsed = parseManifestEntry(manifest[path], baseUrl, path);
        if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs))) {
          const subdirs = parsed.type === 'subdirs' ? parsed.value : parsed.subdirs;
          items = subdirs.map(name => ({ name, path: (path? path + "/" + name : name), type: "dir" }));
        }
      } else {
        try {
          const api = await ghListForFolderUsingEntry(activeRepo, path);
          items = (api || []).filter(it => it.type === "dir").map(it => ({ name: it.name, path: it.path, type: "dir" }));
        } catch(e){ items = []; }
      }
      modsList = items || []; currentModPath = ""; renderModsList(modsList); renderSongsList([]);
      setStatus(((path||"Mods")) + ` — ${modsList.length} mods`);
      setTimeout(()=> startBackgroundCheckOnSongs(modsList), 10);
      try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){}
    } catch (err) { modsList = []; renderModsList(modsList); setStatus("Erro carregando pasta."); }
  }

  async function openMod(path) {
    try {
      setStatus("Abrindo " + path + "..."); currentModPath = path;
      if (path === "__favorites__") {
        const items = (favorites || []).map(f => ({ name: f.name || basenameNoExt(f.path.split("/").pop()||f.path), path: f.path }));
        songsList = items; renderSongsList(songsList); setStatus(`Favorites — ${songsList.length} músicas`); return;
      }
      const activeRepo = getActiveRepo();
      const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined);
      let items = [];
      if (manifest && manifest.hasOwnProperty(path)) {
        const baseUrl = getBaseUrl(manifest);
        const parsed = parseManifestEntry(manifest[path], baseUrl, path);
        if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs))) {
          const subdirs = parsed.type === 'subdirs' ? parsed.value : parsed.subdirs;
          items = subdirs.map(name => ({ name, path: (path? path + "/" + name : name), type: "dir" }));
        } else if (parsed && parsed.type === 'files') {
          items = (parsed.value || []).map(f => ({ name: f.name, path: (path? path + "/" + f.name : f.name) }));
        }
      } else {
        try {
          const api = await ghListForFolderUsingEntry(activeRepo, path);
          items = (api || []).filter(it => it.type === "dir").map(it => ({ name: it.name, path: it.path, type: "dir" }));
        } catch(e){ items = []; }
      }
      songsList = items || []; renderSongsList(songsList); setStatus(`${path} — ${songsList.length} músicas`);
    } catch(e){ setStatus("Erro ao abrir mod."); }
  }

  // --- DOWNLOADERS ---
  async function getFilesFromManifest(path) {
    try {
      const activeRepo = getActiveRepo();
      const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined);
      if (!manifest || !manifest.hasOwnProperty(path)) return null;
      const baseUrl = getBaseUrl(manifest);
      const parsed = parseManifestEntry(manifest[path], baseUrl, path);
      if (!parsed) return null;
      if (parsed.type === 'files') return parsed.value;
      else if (parsed.type === 'folder' && parsed.files) return parsed.files;
      return null;
    } catch(e){} return null;
  }

  function stopAndCleanupPrevious(options){
    options = options || {}; const revokeBlobUrls = options.revokeBlobUrls === true;
    try {
      if (window.gdjsChannels) Object.keys(window.gdjsChannels).forEach(k=>{ try { const a = window.gdjsChannels[k]; if (a) { try { a.pause(); a.currentTime = 0; } catch(e){} if (a._gdjs_ended_handler) { try { a.removeEventListener('ended', a._gdjs_ended_handler); } catch(e){} a._gdjs_ended_handler = null; } if (revokeBlobUrls && a.src && a.src.startsWith('blob:')) URL.revokeObjectURL(a.src); } } catch(e){} });
      if (window.gdjsCustomAudio) Object.keys(window.gdjsCustomAudio).forEach(folder=>{ try { const entry = window.gdjsCustomAudio[folder] || {}; Object.keys(entry.audios||{}).forEach(name=>{ try { const info = entry.audios[name]; if (info && info.blobUrl && revokeBlobUrls) URL.revokeObjectURL(info.blobUrl); } catch(e){} }); try { delete window.gdjsCustomAudio[folder]; } catch(e){} } catch(e){} });
      window.gdjsChannels = {};
    } catch(e){}
  }

  async function findAudioFilesWithFallback(rootFolder, difficultyPath) {
    const activeRepo = getActiveRepo();
    async function audioListFromManifestPathLocal(p) { try { const files = await getFilesFromManifest(p); if (!files) return []; return files.filter(e => isAudioFile(e.name)).map(e => ({ name: e.name, url: e.url })); } catch(e){} return []; }
    async function audioListFromGithubPath(p) { try { const api = await ghListForFolderUsingEntry(activeRepo, p).catch(()=>[]); return (api || []).filter(i => i.type !== "dir" && isAudioFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){} return []; }
    try { let list = await audioListFromManifestPathLocal(difficultyPath); if (list && list.length>0) return list; list = await audioListFromGithubPath(difficultyPath); if (list && list.length>0) return list; } catch(e){}
    try { let list = await audioListFromManifestPathLocal(rootFolder); if (list && list.length>0) return list; list = await audioListFromGithubPath(rootFolder); if (list && list.length>0) return list; } catch(e){}
    try { const parts = (rootFolder || "").split("/").filter(Boolean); if (parts.length >= 2) { const modFolder = parts.slice(0, parts.length - 1).join("/"); if (modFolder) { let list = await audioListFromManifestPathLocal(modFolder); if (list && list.length>0) return list; list = await audioListFromGithubPath(modFolder); if (list && list.length>0) return list; } } } catch(e){}
    return [];
  }

  async function downloadDifficultyKeepAudioRoot(rootFolder, difficultyName) {
    const difficultyPath = (rootFolder? rootFolder + "/" + difficultyName : difficultyName);
    try { btnClose.disabled = true; } catch(e){}
    try {
      stopAndCleanupPrevious({ revokeBlobUrls: true });
      try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("selectedTrackKey").setString(rootFolder); } catch(e){}
      try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongName").setString(basenameNoExt(rootFolder.split("/").pop()||rootFolder)); } catch(e){}
      setStatus("Listando arquivos...");
      const audioFiles = await findAudioFilesWithFallback(rootFolder, difficultyPath);
      let chartFiles = []; const activeRepo = getActiveRepo();
      const files = await getFilesFromManifest(difficultyPath);
      if (files) chartFiles = files.filter(e => isJsonFile(e.name)).map(e => ({ name: e.name, url: e.url }) );
      else try { const api = await ghListForFolderUsingEntry(activeRepo, difficultyPath); chartFiles = (api || []).filter(i => i.type !== "dir" && isJsonFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){}
      let rootJsons = []; const rootFiles = await getFilesFromManifest(rootFolder);
      if (rootFiles) rootJsons = rootFiles.filter(e => isJsonFile(e.name)).map(e => ({ name: e.name, url: e.url }) );
      else try { const api = await ghListForFolderUsingEntry(activeRepo, rootFolder); rootJsons = (api || []).filter(i => i.type !== "dir" && isJsonFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){}
      const allJsonsMap = {}; rootJsons.forEach(j => { allJsonsMap[j.name] = j; }); chartFiles.forEach(j => { allJsonsMap[j.name] = j; });
      window.gdjsCustomAudio = window.gdjsCustomAudio || {}; window.gdjsCustomAudio[rootFolder] = window.gdjsCustomAudio[rootFolder] || { audios: {}, rawFiles: {} }; const dest = window.gdjsCustomAudio[rootFolder];
      let nextChannelIndex = 0; const unlockQueue = [];
      for (const f of (audioFiles || [])) {
        try {
          setStatus("Baixando áudio: " + f.name + "..."); const resp = await fetch(f.url); if (!resp.ok) continue;
          const blob = await resp.blob(); const blobUrl = URL.createObjectURL(blob);
          const audioEl = new Audio(blobUrl); audioEl.preload = "auto"; audioEl.crossOrigin = "anonymous"; audioEl.loop = false;
          dest.audios[f.name] = { blobUrl, audioEl }; window.gdjsChannels[nextChannelIndex] = audioEl; nextChannelIndex++;
          try { const p = audioEl.play(); if (p && typeof p.then === "function") p.then(()=>{ try{ audioEl.pause(); audioEl.currentTime = 0; }catch(e){} }).catch(()=>{ unlockQueue.push({audioEl, name: f.name}); }); else try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} } catch(e){ unlockQueue.push({audioEl, name: f.name}); }
        } catch(e){} await sleep(0);
      }
      for (const name in allJsonsMap) {
        try {
          const j = allJsonsMap[name]; setStatus("Baixando chart: " + name + "..."); const r = await fetch(j.url); if (!r.ok) continue; const txt = await r.text();
          const key = difficultyName + "/" + name; dest.rawFiles[key] = txt; const lname = name.toLowerCase();
          const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null;
          if (gg) {
            if (/metadata|meta/.test(lname)) gg.get("metadatajson").setString(txt); else if (/(bf|chartbf|chart_bf)/.test(lname)) gg.get("BfChartJsonLoader").setString(txt); else if (/(dad|opp|opponent)/.test(lname)) gg.get("OppChartJsonLoader").setString(txt);
            else { try { const parsed = JSON.parse(txt); if (parsed && parsed.notes) { if (!gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt); else if (!gg.get("OppChartJsonLoader").getAsString()) gg.get("OppChartJsonLoader").setString(txt); else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } catch(e){ if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } }
          }
        } catch(e){} await sleep(0);
      }
      if (unlockQueue.length > 0) { const unlock = async () => { for (const it of unlockQueue) { try { await it.audioEl.play(); it.audioEl.pause(); it.audioEl.currentTime = 0; } catch(e){} } window.removeEventListener('pointerdown', unlock); }; window.addEventListener('pointerdown', unlock, { once: true }); }
      setStatus('Download concluído.');
    } catch(e){ setStatus("Erro ao baixar: " + e); } finally { try { btnClose.disabled = false; } catch(e){} }
  }

  async function downloadSongFolder(folderPath) {
    try { btnClose.disabled = true; } catch(e){}
    try {
      stopAndCleanupPrevious({ revokeBlobUrls: true }); setStatus("Listando arquivos...");
      let files = await getFilesFromManifest(folderPath);
      if (!files) { const activeRepo = getActiveRepo(); try { const apiList = await ghListForFolderUsingEntry(activeRepo, folderPath); files = (apiList || []).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`), type: i.type })); files = files.filter(x => x.type !== "dir"); } catch(e){ files = []; } }
      if (!Array.isArray(files) || files.length === 0) { setStatus("Pasta vazia."); return; }
      window.gdjsCustomAudio = window.gdjsCustomAudio || {}; window.gdjsCustomAudio[folderPath] = window.gdjsCustomAudio[folderPath] || {audios:{}, rawFiles:{}}; const dest = window.gdjsCustomAudio[folderPath];
      try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("selectedTrackKey").setString(folderPath); } catch(e){}
      try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongName").setString(basenameNoExt(folderPath.split("/").pop()||folderPath)); } catch(e){}
      let nextChannelIndex = (window.gdjsChannels) ? Object.keys(window.gdjsChannels).length : 0; const unlockQueue = [];
      for (const f of files) {
        const fname = f.name; const url = f.url; if (!url) continue;
        if (isJsonFile(fname)) { try { const txtResp = await fetch(url); if (txtResp.ok) { const txt = await txtResp.text(); dest.rawFiles[fname] = txt; const lname = fname.toLowerCase(); const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg) { if (/metadata|meta/.test(lname)) gg.get("metadatajson").setString(txt); else if (/(bf|chartbf|chart_bf)/.test(lname)) gg.get("BfChartJsonLoader").setString(txt); else if (/(dad|opp|opponent)/.test(lname)) gg.get("OppChartJsonLoader").setString(txt); else { try { const parsed = JSON.parse(txt); if (parsed && parsed.notes) { if (!gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt); else if (!gg.get("OppChartJsonLoader").getAsString()) gg.get("OppChartJsonLoader").setString(txt); else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } catch(e) { if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } } } } } catch(e){} } else if (isAudioFile(fname)) { try { setStatus("Baixando áudio: " + fname + "..."); const resp = await fetch(url); if (!resp.ok) continue; const blob = await resp.blob(); const blobUrl = URL.createObjectURL(blob); const audioEl = new Audio(blobUrl); audioEl.preload = "auto"; audioEl.crossOrigin = "anonymous"; audioEl.loop = false; dest.audios[fname] = { blobUrl, audioEl, audioElRef: audioEl }; window.gdjsChannels = window.gdjsChannels || {}; window.gdjsChannels[nextChannelIndex] = audioEl; nextChannelIndex++; try { const p = audioEl.play(); if (p && typeof p.then === "function") p.then(()=>{ try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} }).catch(()=>{ unlockQueue.push({audioEl, name: fname}); }); else try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} } catch(e){ unlockQueue.push({audioEl, name: fname}); } try { const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg && !gg.get("SongName").getAsString()) gg.get("SongName").setString(basenameNoExt(fname)); } catch(e){} } catch(e){} } await sleep(0);
      }
      if (unlockQueue.length > 0) { const unlock = async () => { for (const it of unlockQueue) { try { await it.audioEl.play(); it.audioEl.pause(); it.audioEl.currentTime = 0; } catch(e){} } window.removeEventListener('pointerdown', unlock); }; window.addEventListener('pointerdown', unlock, { once: true }); }
      setStatus('Download concluído.');
    } catch(e){ setStatus("Erro ao baixar: " + e); } finally { try { btnClose.disabled = false; } catch(e){} }
  }

  function showDifficultyChooser(rootFolder, subdirs) {
    const overlay = document.createElement("div");
    Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000010, display: "flex", alignItems: "center", justifyContent: "center", pointerEvents: "auto" });
    const box = document.createElement("div");
    Object.assign(box.style, { width: "420px", maxHeight: "70vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" });
    box.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Escolha uma difficulty para:</div><div style="margin-bottom:8px;color:#bbb">${rootFolder}</div>`;
    const list = document.createElement("div"); list.style.display = "flex"; list.style.flexDirection = "column"; list.style.gap = "6px";
    for (const d of subdirs) { const b = document.createElement("button"); b.textContent = d; b.style.padding="8px"; b.style.borderRadius="6px"; b.onclick = ()=> { overlay.remove(); downloadDifficultyKeepAudioRoot(rootFolder, d); }; list.appendChild(b); }
    const cancel = document.createElement("button"); cancel.textContent = "Cancelar"; cancel.style.marginTop="10px"; cancel.style.padding="8px"; cancel.style.borderRadius="6px"; cancel.onclick = ()=> overlay.remove();
    box.appendChild(list); box.appendChild(cancel); overlay.appendChild(box); document.body.appendChild(overlay);
  }

  btnClose.onclick = ()=> container.remove();
  btnManage.onclick = ()=> showRepoManagerModal();
  btnCache.onclick = ()=> showCacheManager();
  btnRefresh.onclick = async ()=> {
    try { setStatus("Atualizando..."); } catch(e){}
    try { for (const it of modsList) delete hasSubCache[it.path]; } catch(e){}
    try { Object.keys(_manifest_cache_by_repo).forEach(k=> delete _manifest_cache_by_repo[k]); } catch(e){}
    try { const active = getActiveRepo(); if(active && active.id) localStorage.removeItem(MANIFEST_CACHE_PREFIX + active.id); } catch(e){}
    const prevOpen = currentModPath; await loadFolder("");
    try { if (prevOpen && prevOpen === "__favorites__") openMod("__favorites__"); else if (prevOpen) setTimeout(()=>{ try { const found = modsList.find(m => m.path === prevOpen); if (found) openMod(prevOpen); } catch(e){} }, 60); } catch(e){}
  };
  repoSelect.onchange = ()=> { try { setActiveRepoById(repoSelect.value); } catch(e){} try { Object.keys(_manifest_cache_by_repo).forEach(k=> delete _manifest_cache_by_repo[k]); } catch(e){} const prevOpen = currentModPath; loadFolder("").then(()=>{ try { if (prevOpen && prevOpen === "__favorites__") openMod("__favorites__"); else if (prevOpen) { const found = modsList.find(m => m.path === prevOpen); if (found) openMod(prevOpen); } } catch(e){} }).catch(()=>{}); };
  searchInput.addEventListener("input", ()=> {
    const q = searchInput.value.trim().toLowerCase();
    if (!q) { renderModsList(modsList); setStatus((currentModPath||"Mods")+` — ${modsList.length}`); if (currentModPath) { if (currentModPath === "__favorites__") openMod("__favorites__"); else openMod(currentModPath); } else { renderSongsList([]); } setTimeout(()=> startBackgroundCheckOnSongs(modsList), 10); return; }
    const filteredMods = modsList.filter(it => (it.name || "").toLowerCase().includes(q)); renderModsList(filteredMods);
    if (currentModPath === "__favorites__") { const favItems = (favorites || []).map(f => ({ name: f.name || basenameNoExt(f.path.split("/").pop()||f.path), path: f.path })); const filteredSongs = favItems.filter(s => (s.name || "").toLowerCase().includes(q)); renderSongsList(filteredSongs); setStatus(`Resultado: ${filteredSongs.length} / ${favItems.length} (favorites)`); } 
    else if (currentModPath) { const filteredSongs = (songsList || []).filter(s => (s.name || "").toLowerCase().includes(q)); renderSongsList(filteredSongs); setStatus(`Resultado: ${filteredSongs.length} / ${songsList.length}`); setTimeout(()=> startBackgroundCheckOnSongs(filteredSongs), 10); } 
    else { setStatus(`Resultado: ${filteredMods.length} / ${modsList.length}`); }
  });

  // --- SCENE WATCHER & INIT ---
  (function init() {
    const list = loadRepoList();
    if (!list || list.length === 0) { saveRepoList([defaultRepoEntry()]); }
    renderRepoSelect();
    loadFolder("");
    try { if (typeof runtimeScene !== "undefined") window.runtimeScene = runtimeScene; } catch(e){}
    try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){}
    
    // --- AUTO CLEANUP ---
    // Se a cena mudar (ex: usuário iniciou a música), a janela se autodestroi
    const watcher = setInterval(() => {
        let currentSceneName = "";
        try { currentSceneName = runtimeScene.getGame().getSceneStack().getCurrentScene().getName(); } catch(e) {}
        
        if (!document.getElementById(UI_ID)) {
            clearInterval(watcher); // Se o user fechou, para de vigiar
        } else if (currentSceneName && originSceneName && currentSceneName !== originSceneName) {
            // Cena mudou! Destruir UI
            try { document.getElementById(UI_ID).remove(); } catch(e){}
            clearInterval(watcher);
        }
    }, 1000);

  })();
})();
};
gdjs.InicioCode.eventsList4 = function(runtimeScene) {

{


gdjs.InicioCode.userFunc0x19b4be8(runtimeScene);

}


};gdjs.InicioCode.userFunc0x19b4ca0 = function GDJSInlineCode(runtimeScene) {
"use strict";
(async function(runtimeScene) {
  // --- 1. CONFIGURAÇÃO DE CLEANUP (Scene Watcher) ---
  const originSceneName = runtimeScene.getName();
  
  // Se já existe a UI, apenas mostra (Singleton intra-cena)
  if (document.querySelector(".skin-modal")) {
    const existingModal = document.querySelector(".skin-modal");
    existingModal.style.display = "flex";
    return;
  }

  // --- 2. CONSTANTES E HELPERS ---
  const MANIFEST_NAME = "manifestskins.json";
  const JSDELIVR_PREFIX = "https://cdn.jsdelivr.net/gh";
  
  function log(...s){ console.log("[skin-loader]", ...s); }
  function warn(...s){ console.warn("[skin-loader]", ...s); }

  function clearPixiTextureCache(skinName) {
    if (!window.PIXI) return;
    try {
        let count = 0;
        for (const key in PIXI.utils.TextureCache) {
            if (key.includes(skinName)) {
                try { PIXI.utils.TextureCache[key].destroy(true); delete PIXI.utils.TextureCache[key]; count++; } catch(e) {}
            }
        }
        for (const key in PIXI.utils.BaseTextureCache) {
             if (key.includes(skinName)) { try { delete PIXI.utils.BaseTextureCache[key]; } catch(e) {} }           
        }
        log(`Cache PIXI limpo para "${skinName}". Texturas removidas: ${count}`);
    } catch (e) { warn("Erro ao limpar cache PIXI:", e); }
  }

  function encodePathForCdn(p){ return String(p).replace(/^\.\//,'').replace(/\\/g,'/').replace(/ /g,'%20'); }
  function buildCdnUrl(owner, repo, branch, path){ if (!owner || !repo) return null; const br = branch || "main"; return `${JSDELIVR_PREFIX}/${owner}/${repo}@${br}/${encodePathForCdn(path)}`; }

  async function fetchCdnFirst(pathOrUrl, as="json", cdnBase=null){
    const isAbs = typeof pathOrUrl === "string" && (pathOrUrl.startsWith("http://") || pathOrUrl.startsWith("https://"));
    const tries = [];
    if (isAbs) tries.push(pathOrUrl);
    if (!isAbs && cdnBase && cdnBase.owner && cdnBase.repo) { const c = buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, pathOrUrl); if (c) tries.push(c); }
    tries.push(pathOrUrl); tries.push("resources/" + pathOrUrl); tries.push("./" + pathOrUrl);
    
    for (const u of tries) {
      try {
        const r = await fetch(u); if (!r.ok) continue;
        if (as === "json") return await r.json();
        if (as === "arraybuffer") return await r.arrayBuffer();
        if (as === "blob") return await r.blob();
        return await r.text();
      } catch (e) {}
    }
    throw new Error("Fetch failed for " + pathOrUrl);
  }

  function getSkinName(sk) {
    if (!sk) return "";
    if (sk.name && typeof sk.name === "string" && sk.name.trim() !== "") return sk.name;
    if (sk.path) { const parts = sk.path.replace(/\\/g,'/').split('/'); return parts[parts.length - 1] || ""; }
    return "";
  }

  function buildFilePathFromSkin(sk, field) {
    if (!sk) return ""; const v = sk[field] || ""; if (!v) return "";
    if (v.startsWith("http")) return v;
    if (v.indexOf('/') !== -1) return v.replace(/\\/g,'/');
    if (sk.path) return sk.path.replace(/\\/g,'/') + "/" + v;
    return v;
  }

  // --- 3. UI BUILDER ---
  function createLoadingModal() {
    const modal = document.createElement("div"); modal.id = "skin-download-loading";
    modal.style.cssText = `position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 100000; color: white; font-family: Arial, sans-serif; flex-direction: column; gap: 16px;`;
    modal.innerHTML = `<div style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #1976d2; animation: spin 1s linear infinite;"></div><div style="font-size:16px;">Baixando skin...</div>`;
    const style = document.createElement("style"); style.textContent = `@keyframes spin { to { transform: rotate(360deg); } }`; document.head.appendChild(style);
    return modal;
  }
  function showLoadingModal() { const existing = document.getElementById("skin-download-loading"); if (existing) return existing; const modal = createLoadingModal(); document.body.appendChild(modal); return modal; }
  function hideLoadingModal() { const modal = document.getElementById("skin-download-loading"); if (modal) modal.remove(); }

  function createModal(defaultOwner, defaultRepo, defaultBranch) {
    if(document.querySelector(".skin-modal")) return;
    const css = `
      :root { --modal-gap: 12px; --panel-bg: #0f0f11; --panel-radius: 12px; --accent: #1976d2; --muted: #999; }
      .skin-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:99999; padding:20px; box-sizing: border-box; }
      .skin-panel { width: min(1100px, 98%); max-width: 1100px; height: min(86vh, 820px); background: var(--panel-bg); color:#eee; border-radius:var(--panel-radius); display:grid; grid-template-columns: 300px 1fr; gap: var(--modal-gap); overflow: hidden; font-family: Arial, sans-serif; box-shadow: 0 12px 32px rgba(0,0,0,0.6); }
      @media (max-width: 720px) { .skin-panel { grid-template-columns: 1fr; height: calc(100vh - 36px); width: 100%; } .skin-left { order: 0; max-height: 160px; overflow:auto; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.04); display:flex; gap:8px; flex-wrap:wrap; } .skin-right { order: 1; } }
      .skin-left { padding:14px; border-right:1px solid rgba(255,255,255,0.05); overflow:auto; min-width: 180px; }
      .skin-right { padding:14px; display:flex; flex-direction:column; min-width: 0; overflow:auto; }
      .skin-left-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; gap:8px; }
      .skin-toggle-btn { background:transparent; border:1px solid rgba(255,255,255,0.04); padding:6px 8px; border-radius:6px; color: #ddd; cursor:pointer; font-size:13px; }
      .skin-mod { padding:8px; margin:6px 0; background:rgba(255,255,255,0.02); border-radius:8px; cursor:pointer; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; user-select: none; }
      .skin-mod:hover { background: rgba(255,255,255,0.03); }
      .skin-top { display:flex; flex-direction:column; gap:8px; }
      .skin-title-row { display:flex; justify-content:space-between; align-items:center; gap:8px; }
      .skin-title { font-weight:700; font-size:1rem; }
      .skin-controls { display:flex; gap:8px; align-items:center; margin-top:6px; flex-wrap:wrap; }
      .skin-btn { padding:8px 10px; border-radius:8px; background: var(--accent); color:white; border:none; cursor:pointer; font-size:13px; }
      .skin-btn.opponent { background: #d32f2f; } .skin-btn.bf { background: #1976d2; }
      .cdn-inputs { display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap; }
      .cdn-inputs input { background: #0b0b0b; color:#ddd; border:1px solid rgba(255,255,255,0.04); padding:7px 8px; border-radius:6px; min-width:100px; font-size:13px; }
      .skin-list { display:flex; flex-wrap:wrap; gap:10px; overflow:auto; padding:6px; align-content:flex-start; }
      .skin-card { width: clamp(110px, 22%, 160px); min-width:110px; background: rgba(255,255,255,0.02); border-radius:8px; padding:8px; text-align:center; cursor:pointer; display:flex; flex-direction:column; gap:8px; user-select: none; }
      .skin-card img { width:100%; height:90px; object-fit:contain; background:#222; border-radius:6px; pointer-events:none; transition: opacity 0.3s; opacity: 0; }
      .skin-card img.loaded { opacity: 1; }
      .skin-card .label { font-size:13px; color:#ddd; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; }
      .skin-card .card-footer { display:flex; gap:6px; justify-content:center; align-items:center; flex-direction: column; }
      .skin-card button.skin-btn { padding:6px 8px; font-size:12px; border-radius:6px; width: 100%; }
    `;
    const style = document.createElement("style"); style.className = "skin-loader-style"; style.textContent = css; document.head.appendChild(style);
    const modal = document.createElement("div"); modal.className = "skin-modal";
    const panel = document.createElement("div"); panel.className = "skin-panel";
    const left = document.createElement("div"); left.className = "skin-left";
    const leftList = document.createElement("div"); leftList.className = "skin-left-list";
    const right = document.createElement("div"); right.className = "skin-right";
    const leftHeader = document.createElement("div"); leftHeader.className = "skin-left-header";
    const leftTitle = document.createElement("div"); leftTitle.textContent = "Mods"; leftTitle.style.fontWeight="700";
    const toggleBtn = document.createElement("button"); toggleBtn.className = "skin-toggle-btn"; toggleBtn.textContent = "Toggle";
    leftHeader.append(leftTitle, toggleBtn); left.append(leftHeader, leftList);
    const top = document.createElement("div"); top.className = "skin-top";
    const titleRow = document.createElement("div"); titleRow.className = "skin-title-row";
    const title = document.createElement("div"); title.className = "skin-title"; title.textContent = "Skins";
    const controls = document.createElement("div"); controls.className = "skin-controls";
    const closeBtn = document.createElement("button"); closeBtn.className = "skin-btn"; closeBtn.textContent = "Fechar";
    controls.appendChild(closeBtn); titleRow.append(title, controls);
    const cdnRow = document.createElement("div"); cdnRow.className = "cdn-inputs";
    const ownerIn = document.createElement("input"); ownerIn.value = defaultOwner;
    const repoIn = document.createElement("input"); repoIn.value = defaultRepo;
    const branchIn = document.createElement("input"); branchIn.value = defaultBranch;
    cdnRow.append(ownerIn, repoIn, branchIn); top.append(titleRow, cdnRow);
    const info = document.createElement("div"); info.textContent = "Selecione um mod.";
    const skinListWrap = document.createElement("div"); skinListWrap.style.flex="1"; skinListWrap.style.overflow="auto";
    right.append(top, info, skinListWrap); panel.append(left, right); modal.appendChild(panel); document.body.appendChild(modal);
    return { modal, panel, left, leftList, right, ownerIn, repoIn, branchIn, closeBtn, info, skinListWrap, toggleBtn, styleEl: style, controlsEl: controls };
  }

  function findSkinInManifest(manifest, modName, skinName){
    if (!manifest || !modName || !skinName) return null;
    const arr = manifest[modName] || [];
    for (const s of arr) { if (getSkinName(s) === skinName.toString()) return s; }
    return null;
  }

  async function openSkinSelector(manifest){
    let baseOwner="LucyYuih", baseRepo="gdev-custom-skins", baseBranch="main";
    if (manifest && manifest._base) { try { const [or, br] = manifest._base.split("@"); const [o, r] = or.split("/"); baseOwner=o; baseRepo=r; baseBranch=br||"main"; } catch(e){} }

    const ui = createModal(baseOwner, baseRepo, baseBranch);
    if(!ui) return; 
    const { modal, left, leftList, ownerIn, repoIn, branchIn, closeBtn, info, skinListWrap, toggleBtn, controlsEl } = ui;
    let currentMod = null; let thumbsCache = {}; let downloading = false;

    // LAZY LOAD
    let lazyObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                const src = img.dataset.src;
                if (src) {
                    const cdnBase = JSON.parse(img.dataset.cdnBase);
                    fetchCdnFirst(src, "blob", cdnBase).then(blob => {
                        const url = URL.createObjectURL(blob); img.src = url; img.classList.add("loaded");
                        if(img.dataset.modName && thumbsCache[img.dataset.modName]) { const c = thumbsCache[img.dataset.modName].find(x => x.imgEl === img); if(c) c.blobUrl = url; }
                    }).catch(()=>{});
                }
                observer.unobserve(img);
            }
        });
    }, { root: skinListWrap, rootMargin: "100px" });

    // RESET BUTTON
    const resetSelectedBtn = document.createElement("button"); resetSelectedBtn.className = "skin-btn"; resetSelectedBtn.textContent = "Reset Selected";
    resetSelectedBtn.onclick = async () => {
      try {
        let selStr = null;
        try { const gv = runtimeScene.getGame().getVariables(); if (gv.has("SelectedSkin")) selStr = gv.get("SelectedSkin").getAsString(); } catch(e){}
        if (!selStr) selStr = localStorage.getItem("gd_selected_skin");
        const parsed = JSON.parse(selStr);
        await resetAndRedownload(parsed.mod, { name: parsed.name, zip: parsed.zip_cdn||parsed.zip }, true);
      } catch(e){}
    };
    controlsEl.insertBefore(resetSelectedBtn, controlsEl.firstChild);

    // MODS LIST
    const mods = manifest[""] || [];
    if (!mods.length) leftList.textContent = "No mods";
    else {
      for (const m of mods) {
        const el=document.createElement("div"); el.className="skin-mod"; el.textContent=m;
        el.onclick=()=>selectMod(m); leftList.appendChild(el);
      }
    }

    let leftHidden = false;
    toggleBtn.onclick = ()=> { leftHidden = !leftHidden; left.style.display = leftHidden ? 'none' : 'flex'; };
    closeBtn.onclick = () => { modal.style.display = 'none'; };

    function unloadModThumbs(modName){ 
        const arr = thumbsCache[modName]; if (!arr) return;
        for (const it of arr) { if (it.blobUrl) URL.revokeObjectURL(it.blobUrl); } delete thumbsCache[modName]; 
    }

    async function selectMod(modName){
      if (downloading || currentMod === modName) return;
      if (currentMod) unloadModThumbs(currentMod);
      currentMod = modName; skinListWrap.innerHTML=""; info.textContent="Carregando...";
      const skins = manifest[modName] || [];
      if (!skins.length) { info.textContent = "Vazio."; return; }
      info.textContent=""; const list=document.createElement("div"); list.className="skin-list"; skinListWrap.appendChild(list);
      thumbsCache[modName]=[];
      const cdnBase={ owner: ownerIn.value, repo: repoIn.value, branch: branchIn.value };
      
      for (const sk of skins){
        const card=document.createElement("div"); card.className="skin-card";
        const img=document.createElement("img"); img.alt=getSkinName(sk); img.draggable = false;
        let thumbPath = buildFilePathFromSkin(sk, "thumb");
        if(thumbPath) {
            const candidate = (thumbPath.startsWith("http")) ? thumbPath : buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, thumbPath);
            img.dataset.src = candidate || thumbPath; img.dataset.cdnBase = JSON.stringify(cdnBase); img.dataset.modName = modName;
            lazyObserver.observe(img);
        } else { img.style.background = "#333"; }

        const lbl=document.createElement("div"); lbl.className="label"; lbl.textContent=getSkinName(sk);
        const footer = document.createElement("div"); footer.className="card-footer";
        const btnBF = document.createElement("button"); btnBF.className = "skin-btn bf"; btnBF.textContent = "BF";
        btnBF.onclick = (e)=> { e.stopPropagation(); applyNow(modName, sk, "BF"); };
        const btnOpp = document.createElement("button"); btnOpp.className = "skin-btn opponent"; btnOpp.textContent = "Opp";
        btnOpp.onclick = (e)=> { e.stopPropagation(); applyNow(modName, sk, "Opponent"); };
        const btnRst = document.createElement("button"); btnRst.className = "skin-btn"; btnRst.textContent = "Reset";
        btnRst.onclick = (e)=> { e.stopPropagation(); resetAndRedownload(modName, sk, false); };

        footer.append(btnBF, btnOpp, btnRst); card.append(img, lbl, footer);
        card.onclick = ()=> downloadAndSaveOnly(modName, sk, false);
        list.appendChild(card); thumbsCache[modName].push({ skin: sk, imgEl: img, blobUrl: null });
      }
    }

    async function downloadAndSaveOnly(modName, skinObj, auto=false, target="BF"){
      if (downloading) return;
      let zipPath = buildFilePathFromSkin(skinObj, "zip");
      if (!zipPath) { const found = findSkinInManifest(manifest, modName, getSkinName(skinObj)); if (found) zipPath = buildFilePathFromSkin(found, "zip"); }
      if (!zipPath) return;
      downloading = true; showLoadingModal();
      try {
        const cdnBase = { owner: ownerIn.value, repo: repoIn.value, branch: branchIn.value };
        const cdnCandidate = (zipPath.startsWith("http")) ? zipPath : buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, zipPath);
        await fetchCdnFirst(cdnCandidate || zipPath, "arraybuffer", cdnBase);
        const sel = { mod: modName, name: getSkinName(skinObj), zip: zipPath, zip_cdn: cdnCandidate };
        const varName = target === "BF" ? "SelectedSkin" : "SelectedDadSkin";
        const storageKey = target === "BF" ? "gd_selected_skin" : "gd_selected_dad_skin";
        const gv = runtimeScene.getGame().getVariables();
        if (gv.has(varName)) gv.get(varName).setString(JSON.stringify(sel));
        else gv.pushNew(varName).setString(JSON.stringify(sel));
        localStorage.setItem(storageKey, JSON.stringify(sel));
      } catch(e){ console.error(e); } finally { hideLoadingModal(); downloading = false; }
    }

    async function applyNow(modName, skinObj, target){
      if (downloading) return;
      let zipPath = buildFilePathFromSkin(skinObj, "zip");
      if (!zipPath) { const found = findSkinInManifest(manifest, modName, getSkinName(skinObj)); if (found) zipPath = buildFilePathFromSkin(found, "zip"); }
      if (!zipPath) return;
      downloading = true; showLoadingModal();
      try {
        const cdnBase = { owner: ownerIn.value, repo: repoIn.value, branch: branchIn.value };
        const cdnCandidate = (zipPath.startsWith("http")) ? zipPath : buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, zipPath);
        const arrbuf = await fetchCdnFirst(cdnCandidate || zipPath, "arraybuffer", cdnBase);
        const sel = { mod: modName, name: getSkinName(skinObj), zip: zipPath, zip_cdn: cdnCandidate };
        const varName = target === "BF" ? "SelectedSkin" : "SelectedDadSkin";
        const storageKey = target === "BF" ? "gd_selected_skin" : "gd_selected_dad_skin";
        clearPixiTextureCache(getSkinName(skinObj));
        const gv = runtimeScene.getGame().getVariables();
        if (gv.has(varName)) gv.get(varName).setString(JSON.stringify(sel));
        else gv.pushNew(varName).setString(JSON.stringify(sel));
        localStorage.setItem(storageKey, JSON.stringify(sel));
        if (window.GD_SKIN_PLAYER) {
          const pkg = await window.GD_SKIN_PLAYER.loadFromArrayBuffer(runtimeScene, arrbuf, { targetName: target === "BF" ? "BF" : "BFPixel" });
          await window.GD_SKIN_PLAYER.applyPackageToScene(runtimeScene, pkg, { targetName: target === "BF" ? "BF" : "BFPixel", targetAnimVar: target === "BF" ? "BFAnim" : "OPPAnim" });
        }
      } catch(e){ console.error(e); } finally { hideLoadingModal(); downloading = false; }
    }

    async function resetAndRedownload(modName, skinObj, auto=false){
      if (downloading) return;
      if(!auto && !confirm("Resetar?")) return;
      const skinName = typeof skinObj === "object" ? getSkinName(skinObj) : skinObj;
      downloading = true; showLoadingModal();
      try {
          const gv = runtimeScene.getGame().getVariables();
          if (gv.has("SelectedSkin")) gv.get("SelectedSkin").setString("");
          if (gv.has("SelectedDadSkin")) gv.get("SelectedDadSkin").setString("");
          localStorage.removeItem("gd_selected_skin"); localStorage.removeItem("gd_selected_dad_skin");
          if (window.GD_SKIN_PLAYER && window.GD_SKIN_PLAYER.clearCache) await window.GD_SKIN_PLAYER.clearCache();
          clearPixiTextureCache(skinName);
          if(!auto) alert("Resetado. Recarregue.");
      } catch(e){} finally { hideLoadingModal(); downloading = false; }
    }
  }

  // --- 4. EXECUÇÃO & AUTO-CLEANUP ---
  try {
    let manifest = await fetchCdnFirst(MANIFEST_NAME, "json");
    if (!manifest) manifest = { "": [] };
    window.GDSkinLoaderUI = true;
    await openSkinSelector(manifest);

    // VIGILANTE DE CENA (A Mágica)
    const watcher = setInterval(() => {
        let currentSceneName = "";
        try { currentSceneName = runtimeScene.getGame().getSceneStack().getCurrentScene().getName(); } catch(e) {}
        
        // Se a cena mudou, matar tudo
        if (currentSceneName && originSceneName && currentSceneName !== originSceneName) {
            const m = document.querySelector(".skin-modal");
            if (m) m.remove(); // Remove do DOM
            window.GDSkinLoaderUI = false; // Permite recriar na próxima cena
            clearInterval(watcher); // Para de vigiar
        }
    }, 1000);

  } catch(e){ console.error(e); }

})(runtimeScene);
};
gdjs.InicioCode.eventsList5 = function(runtimeScene) {

{


gdjs.InicioCode.userFunc0x19b4ca0(runtimeScene);

}


};gdjs.InicioCode.userFunc0x1e8f228 = function GDJSInlineCode(runtimeScene) {
"use strict";
if (window.gdFirebaseAuthUI && window.gdFirebaseAuthUI.show) window.gdFirebaseAuthUI.show();
};
gdjs.InicioCode.eventsList6 = function(runtimeScene) {

{


gdjs.InicioCode.userFunc0x1e8f228(runtimeScene);

}


};gdjs.InicioCode.userFunc0x19b70a0 = function GDJSInlineCode(runtimeScene) {
"use strict";
window.openPlayerSaveImportUI(runtimeScene);
};
gdjs.InicioCode.eventsList7 = function(runtimeScene) {

{


gdjs.InicioCode.userFunc0x19b70a0(runtimeScene);

}


};gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects = Hashtable.newFrom({"begfont": gdjs.InicioCode.GDbegfontObjects1});
gdjs.InicioCode.eventsList8 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber() < gdjs.evtTools.variable.getVariableChildCount(runtimeScene.getGame().getVariables().getFromIndex(67)));
}
if (isConditionTrue_0) {
{runtimeScene.getScene().getVariables().getFromIndex(6).setBoolean(true);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber() >= gdjs.evtTools.variable.getVariableChildCount(runtimeScene.getGame().getVariables().getFromIndex(67)));
}
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(69).setNumber(0);
}
}

}


};gdjs.InicioCode.asyncCallback34906092 = function (runtimeScene, asyncObjectsList) {
asyncObjectsList.restoreLocalVariablesContainers(gdjs.InicioCode.localVariables);
{gdjs.evtsExt__JSONResourceLoader__LoadJSONToGlobal.func(runtimeScene, "assets\\weeks\\freeplayList.json", runtimeScene.getGame().getVariables().getFromIndex(68), null);
}
{gdjs.evtsExt__ArrayTools__GlobalSplitString.func(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(68).getAsString(), "/", runtimeScene.getGame().getVariables().getFromIndex(67), null);
}
{runtimeScene.getScene().getVariables().getFromIndex(6).setBoolean(true);
}
{gdjs.evtTools.window.setWindowTitle(runtimeScene, "GDev Online");
}
{gdjs.evtTools.storage.writeNumberInJSONFile("Song", "Page", runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}
gdjs.InicioCode.localVariables.length = 0;
}
gdjs.InicioCode.idToCallbackMap.set(34906092, gdjs.InicioCode.asyncCallback34906092);
gdjs.InicioCode.eventsList9 = function(runtimeScene) {

{


{
{
const asyncObjectsList = new gdjs.LongLivedObjectsList();
asyncObjectsList.backupLocalVariablesContainers(gdjs.InicioCode.localVariables);
runtimeScene.getAsyncTasksManager().addTask(gdjs.evtTools.runtimeScene.wait(0.1), (runtimeScene) => (gdjs.InicioCode.asyncCallback34906092(runtimeScene, asyncObjectsList)), 34906092, asyncObjectsList);
}
}

}


};gdjs.InicioCode.eventsList10 = function(runtimeScene) {

};gdjs.InicioCode.eventsList11 = function(runtimeScene) {

};gdjs.InicioCode.eventsList12 = function(runtimeScene) {

{

gdjs.copyArray(runtimeScene.getObjects("begfont"), gdjs.InicioCode.GDbegfontObjects2);

for (gdjs.InicioCode.forEachIndex3 = 0;gdjs.InicioCode.forEachIndex3 < gdjs.InicioCode.GDbegfontObjects2.length;++gdjs.InicioCode.forEachIndex3) {
gdjs.InicioCode.GDbegfontObjects3.length = 0;


gdjs.InicioCode.forEachTemporary3 = gdjs.InicioCode.GDbegfontObjects2[gdjs.InicioCode.forEachIndex3];
gdjs.InicioCode.GDbegfontObjects3.push(gdjs.InicioCode.forEachTemporary3);
let isConditionTrue_0 = false;
if (true) {
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects3.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects3[i].deleteFromScene(runtimeScene);
}
}
{runtimeScene.getGame().getVariables().getFromIndex(69).setNumber(0);
}
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("OppIcon"), gdjs.InicioCode.GDOppIconObjects2);

for (gdjs.InicioCode.forEachIndex3 = 0;gdjs.InicioCode.forEachIndex3 < gdjs.InicioCode.GDOppIconObjects2.length;++gdjs.InicioCode.forEachIndex3) {
gdjs.InicioCode.GDOppIconObjects3.length = 0;


gdjs.InicioCode.forEachTemporary3 = gdjs.InicioCode.GDOppIconObjects2[gdjs.InicioCode.forEachIndex3];
gdjs.InicioCode.GDOppIconObjects3.push(gdjs.InicioCode.forEachTemporary3);
let isConditionTrue_0 = false;
if (true) {
{for(var i = 0, len = gdjs.InicioCode.GDOppIconObjects3.length ;i < len;++i) {
    gdjs.InicioCode.GDOppIconObjects3[i].deleteFromScene(runtimeScene);
}
}
}
}

}


{


let isConditionTrue_0 = false;
{
{gdjs.evtTools.camera.setCameraY(runtimeScene, 540, "", 0);
}
}

}


};gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects2Objects = Hashtable.newFrom({"begfont": gdjs.InicioCode.GDbegfontObjects2});
gdjs.InicioCode.eventsList13 = function(runtimeScene) {

};gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects2Objects = Hashtable.newFrom({"begfont": gdjs.InicioCode.GDbegfontObjects2});
gdjs.InicioCode.eventsList14 = function(runtimeScene) {

};gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDOppIconObjects2Objects = Hashtable.newFrom({"OppIcon": gdjs.InicioCode.GDOppIconObjects2});
gdjs.InicioCode.eventsList15 = function(runtimeScene) {

{

gdjs.copyArray(gdjs.InicioCode.GDOppIconObjects2, gdjs.InicioCode.GDOppIconObjects3);

gdjs.copyArray(gdjs.InicioCode.GDbegfontObjects2, gdjs.InicioCode.GDbegfontObjects3);


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDOppIconObjects3.length;i<l;++i) {
    if ( gdjs.InicioCode.GDOppIconObjects3[i].getCenterXInScene() != 100 + (( gdjs.InicioCode.GDbegfontObjects3.length === 0 ) ? 0 :gdjs.InicioCode.GDbegfontObjects3[0].getWidth()) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDOppIconObjects3[k] = gdjs.InicioCode.GDOppIconObjects3[i];
        ++k;
    }
}
gdjs.InicioCode.GDOppIconObjects3.length = k;
if (isConditionTrue_0) {
/* Reuse gdjs.InicioCode.GDOppIconObjects3 */
/* Reuse gdjs.InicioCode.GDbegfontObjects3 */
{for(var i = 0, len = gdjs.InicioCode.GDOppIconObjects3.length ;i < len;++i) {
    gdjs.InicioCode.GDOppIconObjects3[i].setCenterPositionInScene(100 + (( gdjs.InicioCode.GDbegfontObjects3.length === 0 ) ? 0 :gdjs.InicioCode.GDbegfontObjects3[0].getWidth()),(( gdjs.InicioCode.GDbegfontObjects3.length === 0 ) ? 0 :gdjs.InicioCode.GDbegfontObjects3[0].getCenterYInScene()));
}
}
}

}


{

gdjs.copyArray(gdjs.InicioCode.GDbegfontObjects2, gdjs.InicioCode.GDbegfontObjects3);


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDbegfontObjects3.length;i<l;++i) {
    if ( gdjs.InicioCode.GDbegfontObjects3[i].getBehavior("Text").getText() == "0" ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDbegfontObjects3[k] = gdjs.InicioCode.GDbegfontObjects3[i];
        ++k;
    }
}
gdjs.InicioCode.GDbegfontObjects3.length = k;
if (isConditionTrue_0) {
/* Reuse gdjs.InicioCode.GDbegfontObjects3 */
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects3.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects3[i].deleteFromScene(runtimeScene);
}
}
}

}


};gdjs.InicioCode.eventsList16 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.evtTools.sound.isSoundOnChannelPlaying(runtimeScene, 1));
if (isConditionTrue_0) {
{gdjs.evtTools.sound.playSoundOnChannel(runtimeScene, "freakyMenu.aac", 1, true, 80, 1);
}
}

}


};gdjs.InicioCode.eventsList17 = function(runtimeScene, asyncObjectsList) {

{


let isConditionTrue_0 = false;
{
{gdjs.evtTools.runtimeScene.replaceScene(runtimeScene, runtimeScene.getScene().getVariables().getFromIndex(0).getAsString(), false);
}
}

}


};gdjs.InicioCode.asyncCallback34913884 = function (runtimeScene, asyncObjectsList) {
asyncObjectsList.restoreLocalVariablesContainers(gdjs.InicioCode.localVariables);

{ //Subevents
gdjs.InicioCode.eventsList17(runtimeScene, asyncObjectsList);} //End of subevents
gdjs.InicioCode.localVariables.length = 0;
}
gdjs.InicioCode.idToCallbackMap.set(34913884, gdjs.InicioCode.asyncCallback34913884);
gdjs.InicioCode.eventsList18 = function(runtimeScene) {

{


{
{
const asyncObjectsList = new gdjs.LongLivedObjectsList();
asyncObjectsList.backupLocalVariablesContainers(gdjs.InicioCode.localVariables);
runtimeScene.getAsyncTasksManager().addTask(gdjs.evtTools.runtimeScene.wait(0.3), (runtimeScene) => (gdjs.InicioCode.asyncCallback34913884(runtimeScene, asyncObjectsList)), 34913884, asyncObjectsList);
}
}

}


};gdjs.InicioCode.asyncCallback34923388 = function (runtimeScene, asyncObjectsList) {
asyncObjectsList.restoreLocalVariablesContainers(gdjs.InicioCode.localVariables);
{runtimeScene.getScene().getVariables().getFromIndex(3).setBoolean(true);
}
gdjs.InicioCode.localVariables.length = 0;
}
gdjs.InicioCode.idToCallbackMap.set(34923388, gdjs.InicioCode.asyncCallback34923388);
gdjs.InicioCode.eventsList19 = function(runtimeScene) {

{


{
{
const asyncObjectsList = new gdjs.LongLivedObjectsList();
asyncObjectsList.backupLocalVariablesContainers(gdjs.InicioCode.localVariables);
runtimeScene.getAsyncTasksManager().addTask(gdjs.evtTools.runtimeScene.wait(0.5), (runtimeScene) => (gdjs.InicioCode.asyncCallback34923388(runtimeScene, asyncObjectsList)), 34923388, asyncObjectsList);
}
}

}


};gdjs.InicioCode.asyncCallback34928932 = function (runtimeScene, asyncObjectsList) {
asyncObjectsList.restoreLocalVariablesContainers(gdjs.InicioCode.localVariables);
gdjs.copyArray(asyncObjectsList.getObjects("PointsText"), gdjs.InicioCode.GDPointsTextObjects2);

{for(var i = 0, len = gdjs.InicioCode.GDPointsTextObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDPointsTextObjects2[i].getBehavior("Tween").addObjectOpacityTween2("OpaOutPT", 0, "easeInQuad", 2, false);
}
}
gdjs.InicioCode.localVariables.length = 0;
}
gdjs.InicioCode.idToCallbackMap.set(34928932, gdjs.InicioCode.asyncCallback34928932);
gdjs.InicioCode.eventsList20 = function(runtimeScene) {

{


{
{
const asyncObjectsList = new gdjs.LongLivedObjectsList();
asyncObjectsList.backupLocalVariablesContainers(gdjs.InicioCode.localVariables);
for (const obj of gdjs.InicioCode.GDPointsTextObjects1) asyncObjectsList.addObject("PointsText", obj);
runtimeScene.getAsyncTasksManager().addTask(gdjs.evtTools.runtimeScene.wait(3), (runtimeScene) => (gdjs.InicioCode.asyncCallback34928932(runtimeScene, asyncObjectsList)), 34928932, asyncObjectsList);
}
}

}


};gdjs.InicioCode.eventsList21 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(89).getChild("PointsMessage").getAsNumber() > 0);
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34926412);
}
}
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("PointsText"), gdjs.InicioCode.GDPointsTextObjects2);
{for(var i = 0, len = gdjs.InicioCode.GDPointsTextObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDPointsTextObjects2[i].getBehavior("Text").setText("+" + runtimeScene.getGame().getVariables().getFromIndex(89).getChild("PointsMessage").getAsString() + " points");
}
}
{runtimeScene.getGame().getVariables().getFromIndex(89).getChild("PointsMessage").setNumber(0);
}
{for(var i = 0, len = gdjs.InicioCode.GDPointsTextObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDPointsTextObjects2[i].getBehavior("Tween").addObjectOpacityTween2("OpaInPT", 255, "easeInQuad", 0.5, false);
}
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("PointsText"), gdjs.InicioCode.GDPointsTextObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDPointsTextObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDPointsTextObjects1[i].getBehavior("Tween").hasFinished("OpaInPT") ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDPointsTextObjects1[k] = gdjs.InicioCode.GDPointsTextObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDPointsTextObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34929012);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList20(runtimeScene);} //End of subevents
}

}


};gdjs.InicioCode.eventsList22 = function(runtimeScene) {

{


gdjs.InicioCode.eventsList0(runtimeScene);
}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
if (isConditionTrue_0) {
gdjs.InicioCode.GDbegfontObjects1.length = 0;

{gdjs.evtTools.object.createObjectOnScene(runtimeScene, gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects, 0, 0, "");
}
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects1[i].getBehavior("Text").setText("yes");
}
}
{gdjs.evtTools.object.createObjectOnScene(runtimeScene, gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects, 0, 300, "");
}
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects1[i].getBehavior("Text").setText("no");
}
}
{runtimeScene.getGame().getVariables().getFromIndex(81).setBoolean(false);
}
{gdjs.evtTools.sound.setGlobalVolume(runtimeScene, 100);
}
{runtimeScene.getGame().getVariables().getFromIndex(10).setNumber(1);
}
{runtimeScene.getGame().getVariables().getFromIndex(15).setNumber(0);
}
{runtimeScene.getGame().getVariables().getFromIndex(14).setNumber(0);
}
{gdjs.multiplayer.endLobbyGame();
}

{ //Subevents
gdjs.InicioCode.eventsList3(runtimeScene);} //End of subevents
}

}


{



}


{

gdjs.copyArray(runtimeScene.getObjects("NewText2"), gdjs.InicioCode.GDNewText2Objects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDNewText2Objects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDNewText2Objects1[i].getBehavior("ButtonFSM").IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDNewText2Objects1[k] = gdjs.InicioCode.GDNewText2Objects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDNewText2Objects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34899796);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList4(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Hard"), gdjs.InicioCode.GDHardObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDHardObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDHardObjects1[i].getBehavior("MultitouchButton").IsJustPressed(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDHardObjects1[k] = gdjs.InicioCode.GDHardObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDHardObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34901148);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList5(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Export"), gdjs.InicioCode.GDExportObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDExportObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDExportObjects1[i].getBehavior("MultitouchButton").IsJustPressed(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDExportObjects1[k] = gdjs.InicioCode.GDExportObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDExportObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34902476);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList6(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Import"), gdjs.InicioCode.GDImportObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDImportObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDImportObjects1[i].getBehavior("MultitouchButton").IsJustPressed(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDImportObjects1[k] = gdjs.InicioCode.GDImportObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDImportObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34903900);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList7(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(93).getAsNumber() == 1);
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34904836);
}
}
if (isConditionTrue_0) {
{gdjs.evtTools.storage.writeStringInJSONFile("Player" + runtimeScene.getGame().getVariables().getFromIndex(2).getAsString(), "BestScore", runtimeScene.getGame().getVariables().getFromIndex(89).getChild("BestScore").getAsString());
}
{gdjs.evtTools.storage.writeStringInJSONFile("Player" + runtimeScene.getGame().getVariables().getFromIndex(2).getAsString(), "Pfcs", runtimeScene.getGame().getVariables().getFromIndex(89).getChild("Encpt").getChild("Pfcs").getAsString());
}
{gdjs.evtTools.storage.writeStringInJSONFile("Player" + runtimeScene.getGame().getVariables().getFromIndex(2).getAsString(), "Points", runtimeScene.getGame().getVariables().getFromIndex(89).getChild("Encpt").getChild("Points").getAsString());
}
{runtimeScene.getGame().getVariables().getFromIndex(93).setNumber(0);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getScene().getVariables().getFromIndex(6).getAsBoolean();
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber() < gdjs.evtTools.variable.getVariableChildCount(runtimeScene.getGame().getVariables().getFromIndex(67)));
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(70).getAsNumber() == runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}
}
}
if (isConditionTrue_0) {
gdjs.InicioCode.GDbegfontObjects1.length = 0;

{runtimeScene.getScene().getVariables().getFromIndex(6).setBoolean(false);
}
{gdjs.evtTools.object.createObjectOnScene(runtimeScene, gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects1Objects, 20, runtimeScene.getScene().getVariables().getFromIndex(7).getAsNumber(), "");
}
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects1[i].returnVariable(gdjs.InicioCode.GDbegfontObjects1[i].getVariables().getFromIndex(0)).setString(runtimeScene.getGame().getVariables().getFromIndex(67).getChild(runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber()).getAsString());
}
}
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects1[i].returnVariable(gdjs.InicioCode.GDbegfontObjects1[i].getVariables().getFromIndex(1)).setString(runtimeScene.getGame().getVariables().getFromIndex(67).getChild(runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber() + 1).getAsString());
}
}
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects1[i].returnVariable(gdjs.InicioCode.GDbegfontObjects1[i].getVariables().getFromIndex(2)).setString(runtimeScene.getGame().getVariables().getFromIndex(67).getChild(runtimeScene.getGame().getVariables().getFromIndex(69).getAsNumber() + 2).getAsString());
}
}
{runtimeScene.getScene().getVariables().getFromIndex(7).add(180);
}
{runtimeScene.getGame().getVariables().getFromIndex(69).add(3);
}

{ //Subevents
gdjs.InicioCode.eventsList8(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(70).getAsNumber() == 0);
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34905420);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.InicioCode.eventsList9(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(70).getAsNumber() != runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(70).setNumber(runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}
{runtimeScene.getScene().getVariables().getFromIndex(7).setNumber(200);
}

{ //Subevents
gdjs.InicioCode.eventsList12(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("begfont"), gdjs.InicioCode.GDbegfontObjects1);

for (gdjs.InicioCode.forEachIndex2 = 0;gdjs.InicioCode.forEachIndex2 < gdjs.InicioCode.GDbegfontObjects1.length;++gdjs.InicioCode.forEachIndex2) {
gdjs.InicioCode.GDbegfontObjects2.length = 0;


gdjs.InicioCode.forEachTemporary2 = gdjs.InicioCode.GDbegfontObjects1[gdjs.InicioCode.forEachIndex2];
gdjs.InicioCode.GDbegfontObjects2.push(gdjs.InicioCode.forEachTemporary2);
let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.input.cursorOnObject(gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects2Objects, runtimeScene, true, true);
if (isConditionTrue_0) {
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects2[i].getBehavior("Opacity").setOpacity(255);
}
}
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("begfont"), gdjs.InicioCode.GDbegfontObjects1);

for (gdjs.InicioCode.forEachIndex2 = 0;gdjs.InicioCode.forEachIndex2 < gdjs.InicioCode.GDbegfontObjects1.length;++gdjs.InicioCode.forEachIndex2) {
gdjs.InicioCode.GDbegfontObjects2.length = 0;


gdjs.InicioCode.forEachTemporary2 = gdjs.InicioCode.GDbegfontObjects1[gdjs.InicioCode.forEachIndex2];
gdjs.InicioCode.GDbegfontObjects2.push(gdjs.InicioCode.forEachTemporary2);
let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.input.cursorOnObject(gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDbegfontObjects2Objects, runtimeScene, true, false);
if (isConditionTrue_0) {
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects2[i].getBehavior("Opacity").setOpacity(155);
}
}
}
}

}


{



}


{



}


{



}


{



}


{

gdjs.copyArray(runtimeScene.getObjects("begfont"), gdjs.InicioCode.GDbegfontObjects1);

for (gdjs.InicioCode.forEachIndex2 = 0;gdjs.InicioCode.forEachIndex2 < gdjs.InicioCode.GDbegfontObjects1.length;++gdjs.InicioCode.forEachIndex2) {
gdjs.InicioCode.GDOppIconObjects2.length = 0;

gdjs.InicioCode.GDbegfontObjects2.length = 0;


gdjs.InicioCode.forEachTemporary2 = gdjs.InicioCode.GDbegfontObjects1[gdjs.InicioCode.forEachIndex2];
gdjs.InicioCode.GDbegfontObjects2.push(gdjs.InicioCode.forEachTemporary2);
let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDbegfontObjects2.length;i<l;++i) {
    if ( gdjs.InicioCode.GDbegfontObjects2[i].getBehavior("Text").getText() != gdjs.InicioCode.GDbegfontObjects2[i].getVariables().getFromIndex(0).getAsString() ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDbegfontObjects2[k] = gdjs.InicioCode.GDbegfontObjects2[i];
        ++k;
    }
}
gdjs.InicioCode.GDbegfontObjects2.length = k;
if (isConditionTrue_0) {
{for(var i = 0, len = gdjs.InicioCode.GDbegfontObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDbegfontObjects2[i].getBehavior("Text").setText(gdjs.InicioCode.GDbegfontObjects2[i].getVariables().getFromIndex(0).getAsString());
}
}
{gdjs.evtTools.object.createObjectOnScene(runtimeScene, gdjs.InicioCode.mapOfGDgdjs_9546InicioCode_9546GDOppIconObjects2Objects, -(999), 0, "");
}
{for(var i = 0, len = gdjs.InicioCode.GDOppIconObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDOppIconObjects2[i].setCenterPositionInScene(100 + (( gdjs.InicioCode.GDbegfontObjects2.length === 0 ) ? 0 :gdjs.InicioCode.GDbegfontObjects2[0].getWidth()),(( gdjs.InicioCode.GDbegfontObjects2.length === 0 ) ? 0 :gdjs.InicioCode.GDbegfontObjects2[0].getCenterYInScene()));
}
}
{for(var i = 0, len = gdjs.InicioCode.GDOppIconObjects2.length ;i < len;++i) {
    gdjs.InicioCode.GDOppIconObjects2[i].getBehavior("Animation").setAnimationName(((gdjs.InicioCode.GDbegfontObjects2.length === 0 ) ? gdjs.VariablesContainer.badVariablesContainer : gdjs.InicioCode.GDbegfontObjects2[0].getVariables()).getFromIndex(2).getAsString());
}
}

{ //Subevents: 
gdjs.InicioCode.eventsList15(runtimeScene);} //Subevents end.
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("OppIcon"), gdjs.InicioCode.GDOppIconObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDOppIconObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDOppIconObjects1[i].getVariableString(gdjs.InicioCode.GDOppIconObjects1[i].getVariables().get("Name")) != (gdjs.InicioCode.GDOppIconObjects1[i].getBehavior("Animation").getAnimationName()) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDOppIconObjects1[k] = gdjs.InicioCode.GDOppIconObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDOppIconObjects1.length = k;
if (isConditionTrue_0) {
/* Reuse gdjs.InicioCode.GDOppIconObjects1 */
{for(var i = 0, len = gdjs.InicioCode.GDOppIconObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDOppIconObjects1[i].deleteFromScene(runtimeScene);
}
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("Back"), gdjs.InicioCode.GDBackObjects1);
gdjs.copyArray(runtimeScene.getObjects("EngineText"), gdjs.InicioCode.GDEngineTextObjects1);
gdjs.copyArray(runtimeScene.getObjects("PauseButton"), gdjs.InicioCode.GDPauseButtonObjects1);
gdjs.copyArray(runtimeScene.getObjects("SwipeText"), gdjs.InicioCode.GDSwipeTextObjects1);
{gdjs.evtTools.window.setGameResolutionSize(runtimeScene, 1920, 1080);
}
{gdjs.evtTools.camera.centerCamera(runtimeScene, (gdjs.InicioCode.GDBackObjects1.length !== 0 ? gdjs.InicioCode.GDBackObjects1[0] : null), true, "", 0);
}
{for(var i = 0, len = gdjs.InicioCode.GDEngineTextObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDEngineTextObjects1[i].getBehavior("Text").setText("GDev Engine V" + gdjs.evtsExt__GetPropertiesData__ReturnGameVersion.func(runtimeScene, null));
}
}
{gdjs.evtTools.window.setWindowTitle(runtimeScene, "Freeplay");
}
{for(var i = 0, len = gdjs.InicioCode.GDSwipeTextObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDSwipeTextObjects1[i].getBehavior("Opacity").setOpacity(100);
}
}
{runtimeScene.getGame().getVariables().getFromIndex(52).getChild(0).setString("BF");
}
{runtimeScene.getGame().getVariables().getFromIndex(52).getChild(1).setString("Dad");
}
{gdjs.evtTools.variable.variableClearChildren(runtimeScene.getGame().getVariables().getFromIndex(48));
}
{gdjs.evtTools.variable.variableClearChildren(runtimeScene.getGame().getVariables().getFromIndex(49));
}
{gdjs.evtTools.storage.readNumberFromJSONFile("CustomScrollSpeed", "CustomScrollSpeed", runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(58));
}
{for(var i = 0, len = gdjs.InicioCode.GDPauseButtonObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDPauseButtonObjects1[i].getBehavior("Opacity").setOpacity(155);
}
}
{gdjs.evtTools.input.showCursor(runtimeScene);
}

{ //Subevents
gdjs.InicioCode.eventsList16(runtimeScene);} //End of subevents
}

}


{

gdjs.InicioCode.GDPauseButtonObjects1.length = 0;


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{gdjs.InicioCode.GDPauseButtonObjects1_1final.length = 0;
let isConditionTrue_1 = false;
isConditionTrue_0 = false;
{
gdjs.copyArray(runtimeScene.getObjects("PauseButton"), gdjs.InicioCode.GDPauseButtonObjects2);
for (var i = 0, k = 0, l = gdjs.InicioCode.GDPauseButtonObjects2.length;i<l;++i) {
    if ( gdjs.InicioCode.GDPauseButtonObjects2[i].getBehavior("MultitouchButton").IsPressed(null) ) {
        isConditionTrue_1 = true;
        gdjs.InicioCode.GDPauseButtonObjects2[k] = gdjs.InicioCode.GDPauseButtonObjects2[i];
        ++k;
    }
}
gdjs.InicioCode.GDPauseButtonObjects2.length = k;
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
    for (let j = 0, jLen = gdjs.InicioCode.GDPauseButtonObjects2.length; j < jLen ; ++j) {
        if ( gdjs.InicioCode.GDPauseButtonObjects1_1final.indexOf(gdjs.InicioCode.GDPauseButtonObjects2[j]) === -1 )
            gdjs.InicioCode.GDPauseButtonObjects1_1final.push(gdjs.InicioCode.GDPauseButtonObjects2[j]);
    }
}
}
{
isConditionTrue_1 = gdjs.evtTools.input.wasKeyJustPressed(runtimeScene, "Escape");
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
isConditionTrue_1 = gdjs.evtTools.input.wasKeyJustPressed(runtimeScene, "Back");
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
gdjs.copyArray(gdjs.InicioCode.GDPauseButtonObjects1_1final, gdjs.InicioCode.GDPauseButtonObjects1);
}
}
if (isConditionTrue_0) {
{gdjs.evtTools.storage.writeNumberInJSONFile("Song", "Page", runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}
{gdjs.evtTools.runtimeScene.replaceScene(runtimeScene, "Menu", false);
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("begfont"), gdjs.InicioCode.GDbegfontObjects1);

for (gdjs.InicioCode.forEachIndex2 = 0;gdjs.InicioCode.forEachIndex2 < gdjs.InicioCode.GDbegfontObjects1.length;++gdjs.InicioCode.forEachIndex2) {
gdjs.InicioCode.GDbegfontObjects2.length = 0;


gdjs.InicioCode.forEachTemporary2 = gdjs.InicioCode.GDbegfontObjects1[gdjs.InicioCode.forEachIndex2];
gdjs.InicioCode.GDbegfontObjects2.push(gdjs.InicioCode.forEachTemporary2);
let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDbegfontObjects2.length;i<l;++i) {
    if ( gdjs.InicioCode.GDbegfontObjects2[i].getBehavior("ButtonFSM").IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDbegfontObjects2[k] = gdjs.InicioCode.GDbegfontObjects2[i];
        ++k;
    }
}
gdjs.InicioCode.GDbegfontObjects2.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getScene().getVariables().getFromIndex(3).getAsBoolean();
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34908068);
}
}
}
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(0).setString(((gdjs.InicioCode.GDbegfontObjects2.length === 0 ) ? gdjs.VariablesContainer.badVariablesContainer : gdjs.InicioCode.GDbegfontObjects2[0].getVariables()).getFromIndex(0).getAsString());
}
{runtimeScene.getScene().getVariables().getFromIndex(0).setString(((gdjs.InicioCode.GDbegfontObjects2.length === 0 ) ? gdjs.VariablesContainer.badVariablesContainer : gdjs.InicioCode.GDbegfontObjects2[0].getVariables()).getFromIndex(1).getAsString());
}
{gdjs.evtTools.runtimeScene.prioritizeLoadingOfScene(runtimeScene, runtimeScene.getScene().getVariables().getFromIndex(0).getAsString());
}
{gdjs.evtTools.storage.writeStringInJSONFile("Song", "Name", runtimeScene.getGame().getVariables().getFromIndex(0).getAsString());
}
{gdjs.evtTools.storage.writeNumberInJSONFile("Song", "Page", runtimeScene.getScene().getVariables().getFromIndex(8).getAsNumber());
}

{ //Subevents: 
gdjs.InicioCode.eventsList18(runtimeScene);} //Subevents end.
}
}

}


{



}


{



}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{let isConditionTrue_1 = false;
isConditionTrue_0 = false;
{
isConditionTrue_1 = gdjs.evtTools.runtimeScene.sceneJustResumed(runtimeScene);
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
isConditionTrue_1 = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
}
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34919660);
}
}
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("ChartDelayInput"), gdjs.InicioCode.GDChartDelayInputObjects1);
gdjs.copyArray(runtimeScene.getObjects("DownKeybind"), gdjs.InicioCode.GDDownKeybindObjects1);
gdjs.copyArray(runtimeScene.getObjects("LeftKeybind"), gdjs.InicioCode.GDLeftKeybindObjects1);
gdjs.copyArray(runtimeScene.getObjects("RightKeybind"), gdjs.InicioCode.GDRightKeybindObjects1);
gdjs.copyArray(runtimeScene.getObjects("UpKeybind"), gdjs.InicioCode.GDUpKeybindObjects1);
{gdjs.evtTools.storage.readStringFromJSONFile("Left", "Keybinds", runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(28));
}
{for(var i = 0, len = gdjs.InicioCode.GDLeftKeybindObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDLeftKeybindObjects1[i].getBehavior("Text").setText(runtimeScene.getGame().getVariables().getFromIndex(28).getAsString());
}
}
{gdjs.evtTools.storage.readStringFromJSONFile("Down", "Keybinds", runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(30));
}
{for(var i = 0, len = gdjs.InicioCode.GDDownKeybindObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDDownKeybindObjects1[i].getBehavior("Text").setText(runtimeScene.getGame().getVariables().getFromIndex(30).getAsString());
}
}
{gdjs.evtTools.storage.readStringFromJSONFile("Up", "Keybinds", runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(32));
}
{for(var i = 0, len = gdjs.InicioCode.GDUpKeybindObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDUpKeybindObjects1[i].getBehavior("Text").setText(runtimeScene.getGame().getVariables().getFromIndex(32).getAsString());
}
}
{gdjs.evtTools.storage.readStringFromJSONFile("Right", "Keybinds", runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(34));
}
{for(var i = 0, len = gdjs.InicioCode.GDRightKeybindObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDRightKeybindObjects1[i].getBehavior("Text").setText(runtimeScene.getGame().getVariables().getFromIndex(34).getAsString());
}
}
{for(var i = 0, len = gdjs.InicioCode.GDChartDelayInputObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDChartDelayInputObjects1[i].getBehavior("Text").setText(runtimeScene.getGame().getVariables().getFromIndex(36).getAsString());
}
}
{runtimeScene.getScene().getVariables().getFromIndex(3).setBoolean(false);
}

{ //Subevents
gdjs.InicioCode.eventsList19(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
{let isConditionTrue_1 = false;
isConditionTrue_0 = false;
{
isConditionTrue_1 = !(gdjs.evtTools.runtimeScene.sceneJustResumed(runtimeScene));
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
isConditionTrue_1 = !(gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene));
if(isConditionTrue_1) {
    isConditionTrue_0 = true;
}
}
{
}
}
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34924764);
}
}
if (isConditionTrue_0) {
{runtimeScene.getScene().getVariables().getFromIndex(1).setBoolean(false);
}
{runtimeScene.getScene().getVariables().getFromIndex(2).setBoolean(false);
}
}

}


{


gdjs.InicioCode.eventsList21(runtimeScene);
}


{



}


{



}


{

gdjs.copyArray(runtimeScene.getObjects("CustomScroll"), gdjs.InicioCode.GDCustomScrollObjects1);
gdjs.copyArray(runtimeScene.getObjects("ScrollSlider"), gdjs.InicioCode.GDScrollSliderObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDCustomScrollObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDCustomScrollObjects1[i].getBehavior("Text").getText() != "Custom ScrollSpeed" + gdjs.evtTools.string.newLine() + gdjs.evtTools.common.toString((( gdjs.InicioCode.GDScrollSliderObjects1.length === 0 ) ? 0 :gdjs.InicioCode.GDScrollSliderObjects1[0].Value(null))) + gdjs.evtTools.string.newLine() + "(Default: 0)" ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDCustomScrollObjects1[k] = gdjs.InicioCode.GDCustomScrollObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDCustomScrollObjects1.length = k;
if (isConditionTrue_0) {
/* Reuse gdjs.InicioCode.GDCustomScrollObjects1 */
/* Reuse gdjs.InicioCode.GDScrollSliderObjects1 */
{for(var i = 0, len = gdjs.InicioCode.GDCustomScrollObjects1.length ;i < len;++i) {
    gdjs.InicioCode.GDCustomScrollObjects1[i].getBehavior("Text").setText("Custom ScrollSpeed" + gdjs.evtTools.string.newLine() + gdjs.evtTools.common.toString((( gdjs.InicioCode.GDScrollSliderObjects1.length === 0 ) ? 0 :gdjs.InicioCode.GDScrollSliderObjects1[0].Value(null))) + gdjs.evtTools.string.newLine() + "(Default: 0)");
}
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("UpscrollText"), gdjs.InicioCode.GDUpscrollTextObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.InicioCode.GDUpscrollTextObjects1.length;i<l;++i) {
    if ( gdjs.InicioCode.GDUpscrollTextObjects1[i].getBehavior("MultitouchButton").IsPressed(null) ) {
        isConditionTrue_0 = true;
        gdjs.InicioCode.GDUpscrollTextObjects1[k] = gdjs.InicioCode.GDUpscrollTextObjects1[i];
        ++k;
    }
}
gdjs.InicioCode.GDUpscrollTextObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(34939556);
}
}
if (isConditionTrue_0) {
{gdjs.evtTools.runtimeScene.replaceScene(runtimeScene, "Gameplay Modifiers", false);
}
}

}


};

gdjs.InicioCode.func = function(runtimeScene) {
runtimeScene.getOnceTriggers().startNewFrame();

gdjs.InicioCode.GDBackObjects1.length = 0;
gdjs.InicioCode.GDBackObjects2.length = 0;
gdjs.InicioCode.GDBackObjects3.length = 0;
gdjs.InicioCode.GDBackObjects4.length = 0;
gdjs.InicioCode.GDBackObjects5.length = 0;
gdjs.InicioCode.GDNewTextObjects1.length = 0;
gdjs.InicioCode.GDNewTextObjects2.length = 0;
gdjs.InicioCode.GDNewTextObjects3.length = 0;
gdjs.InicioCode.GDNewTextObjects4.length = 0;
gdjs.InicioCode.GDNewTextObjects5.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects1.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects2.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects3.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects4.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects5.length = 0;
gdjs.InicioCode.GDDownKeybindObjects1.length = 0;
gdjs.InicioCode.GDDownKeybindObjects2.length = 0;
gdjs.InicioCode.GDDownKeybindObjects3.length = 0;
gdjs.InicioCode.GDDownKeybindObjects4.length = 0;
gdjs.InicioCode.GDDownKeybindObjects5.length = 0;
gdjs.InicioCode.GDUpKeybindObjects1.length = 0;
gdjs.InicioCode.GDUpKeybindObjects2.length = 0;
gdjs.InicioCode.GDUpKeybindObjects3.length = 0;
gdjs.InicioCode.GDUpKeybindObjects4.length = 0;
gdjs.InicioCode.GDUpKeybindObjects5.length = 0;
gdjs.InicioCode.GDRightKeybindObjects1.length = 0;
gdjs.InicioCode.GDRightKeybindObjects2.length = 0;
gdjs.InicioCode.GDRightKeybindObjects3.length = 0;
gdjs.InicioCode.GDRightKeybindObjects4.length = 0;
gdjs.InicioCode.GDRightKeybindObjects5.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects1.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects2.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects3.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects4.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects5.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects1.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects2.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects3.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects4.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects5.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects1.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects2.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects3.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects4.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects5.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects1.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects2.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects3.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects4.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects5.length = 0;
gdjs.InicioCode.GDHardObjects1.length = 0;
gdjs.InicioCode.GDHardObjects2.length = 0;
gdjs.InicioCode.GDHardObjects3.length = 0;
gdjs.InicioCode.GDHardObjects4.length = 0;
gdjs.InicioCode.GDHardObjects5.length = 0;
gdjs.InicioCode.GDSwipeTextObjects1.length = 0;
gdjs.InicioCode.GDSwipeTextObjects2.length = 0;
gdjs.InicioCode.GDSwipeTextObjects3.length = 0;
gdjs.InicioCode.GDSwipeTextObjects4.length = 0;
gdjs.InicioCode.GDSwipeTextObjects5.length = 0;
gdjs.InicioCode.GDNew_9595Objects1.length = 0;
gdjs.InicioCode.GDNew_9595Objects2.length = 0;
gdjs.InicioCode.GDNew_9595Objects3.length = 0;
gdjs.InicioCode.GDNew_9595Objects4.length = 0;
gdjs.InicioCode.GDNew_9595Objects5.length = 0;
gdjs.InicioCode.GDCustomScrollObjects1.length = 0;
gdjs.InicioCode.GDCustomScrollObjects2.length = 0;
gdjs.InicioCode.GDCustomScrollObjects3.length = 0;
gdjs.InicioCode.GDCustomScrollObjects4.length = 0;
gdjs.InicioCode.GDCustomScrollObjects5.length = 0;
gdjs.InicioCode.GDScrollSliderObjects1.length = 0;
gdjs.InicioCode.GDScrollSliderObjects2.length = 0;
gdjs.InicioCode.GDScrollSliderObjects3.length = 0;
gdjs.InicioCode.GDScrollSliderObjects4.length = 0;
gdjs.InicioCode.GDScrollSliderObjects5.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects1.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects2.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects3.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects4.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects5.length = 0;
gdjs.InicioCode.GDOptionsTextObjects1.length = 0;
gdjs.InicioCode.GDOptionsTextObjects2.length = 0;
gdjs.InicioCode.GDOptionsTextObjects3.length = 0;
gdjs.InicioCode.GDOptionsTextObjects4.length = 0;
gdjs.InicioCode.GDOptionsTextObjects5.length = 0;
gdjs.InicioCode.GDbegfontObjects1.length = 0;
gdjs.InicioCode.GDbegfontObjects2.length = 0;
gdjs.InicioCode.GDbegfontObjects3.length = 0;
gdjs.InicioCode.GDbegfontObjects4.length = 0;
gdjs.InicioCode.GDbegfontObjects5.length = 0;
gdjs.InicioCode.GDnextbuttonObjects1.length = 0;
gdjs.InicioCode.GDnextbuttonObjects2.length = 0;
gdjs.InicioCode.GDnextbuttonObjects3.length = 0;
gdjs.InicioCode.GDnextbuttonObjects4.length = 0;
gdjs.InicioCode.GDnextbuttonObjects5.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects1.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects2.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects3.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects4.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects5.length = 0;
gdjs.InicioCode.GDPointsTextObjects1.length = 0;
gdjs.InicioCode.GDPointsTextObjects2.length = 0;
gdjs.InicioCode.GDPointsTextObjects3.length = 0;
gdjs.InicioCode.GDPointsTextObjects4.length = 0;
gdjs.InicioCode.GDPointsTextObjects5.length = 0;
gdjs.InicioCode.GDNewText2Objects1.length = 0;
gdjs.InicioCode.GDNewText2Objects2.length = 0;
gdjs.InicioCode.GDNewText2Objects3.length = 0;
gdjs.InicioCode.GDNewText2Objects4.length = 0;
gdjs.InicioCode.GDNewText2Objects5.length = 0;
gdjs.InicioCode.GDExportObjects1.length = 0;
gdjs.InicioCode.GDExportObjects2.length = 0;
gdjs.InicioCode.GDExportObjects3.length = 0;
gdjs.InicioCode.GDExportObjects4.length = 0;
gdjs.InicioCode.GDExportObjects5.length = 0;
gdjs.InicioCode.GDImportObjects1.length = 0;
gdjs.InicioCode.GDImportObjects2.length = 0;
gdjs.InicioCode.GDImportObjects3.length = 0;
gdjs.InicioCode.GDImportObjects4.length = 0;
gdjs.InicioCode.GDImportObjects5.length = 0;
gdjs.InicioCode.GDStatisticsObjects1.length = 0;
gdjs.InicioCode.GDStatisticsObjects2.length = 0;
gdjs.InicioCode.GDStatisticsObjects3.length = 0;
gdjs.InicioCode.GDStatisticsObjects4.length = 0;
gdjs.InicioCode.GDStatisticsObjects5.length = 0;
gdjs.InicioCode.GDComboNumbersObjects1.length = 0;
gdjs.InicioCode.GDComboNumbersObjects2.length = 0;
gdjs.InicioCode.GDComboNumbersObjects3.length = 0;
gdjs.InicioCode.GDComboNumbersObjects4.length = 0;
gdjs.InicioCode.GDComboNumbersObjects5.length = 0;
gdjs.InicioCode.GDNotesSplashObjects1.length = 0;
gdjs.InicioCode.GDNotesSplashObjects2.length = 0;
gdjs.InicioCode.GDNotesSplashObjects3.length = 0;
gdjs.InicioCode.GDNotesSplashObjects4.length = 0;
gdjs.InicioCode.GDNotesSplashObjects5.length = 0;
gdjs.InicioCode.GDfpsObjects1.length = 0;
gdjs.InicioCode.GDfpsObjects2.length = 0;
gdjs.InicioCode.GDfpsObjects3.length = 0;
gdjs.InicioCode.GDfpsObjects4.length = 0;
gdjs.InicioCode.GDfpsObjects5.length = 0;
gdjs.InicioCode.GDEngineTextObjects1.length = 0;
gdjs.InicioCode.GDEngineTextObjects2.length = 0;
gdjs.InicioCode.GDEngineTextObjects3.length = 0;
gdjs.InicioCode.GDEngineTextObjects4.length = 0;
gdjs.InicioCode.GDEngineTextObjects5.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects1.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects2.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects3.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects4.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects5.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects1.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects2.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects3.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects4.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects5.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects1.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects2.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects3.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects4.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects5.length = 0;
gdjs.InicioCode.GDHitboxDownObjects1.length = 0;
gdjs.InicioCode.GDHitboxDownObjects2.length = 0;
gdjs.InicioCode.GDHitboxDownObjects3.length = 0;
gdjs.InicioCode.GDHitboxDownObjects4.length = 0;
gdjs.InicioCode.GDHitboxDownObjects5.length = 0;
gdjs.InicioCode.GDHitboxUpObjects1.length = 0;
gdjs.InicioCode.GDHitboxUpObjects2.length = 0;
gdjs.InicioCode.GDHitboxUpObjects3.length = 0;
gdjs.InicioCode.GDHitboxUpObjects4.length = 0;
gdjs.InicioCode.GDHitboxUpObjects5.length = 0;
gdjs.InicioCode.GDhitrightObjects1.length = 0;
gdjs.InicioCode.GDhitrightObjects2.length = 0;
gdjs.InicioCode.GDhitrightObjects3.length = 0;
gdjs.InicioCode.GDhitrightObjects4.length = 0;
gdjs.InicioCode.GDhitrightObjects5.length = 0;
gdjs.InicioCode.GDBFIconObjects1.length = 0;
gdjs.InicioCode.GDBFIconObjects2.length = 0;
gdjs.InicioCode.GDBFIconObjects3.length = 0;
gdjs.InicioCode.GDBFIconObjects4.length = 0;
gdjs.InicioCode.GDBFIconObjects5.length = 0;
gdjs.InicioCode.GDPauseButtonObjects1.length = 0;
gdjs.InicioCode.GDPauseButtonObjects2.length = 0;
gdjs.InicioCode.GDPauseButtonObjects3.length = 0;
gdjs.InicioCode.GDPauseButtonObjects4.length = 0;
gdjs.InicioCode.GDPauseButtonObjects5.length = 0;
gdjs.InicioCode.GDPauseButton2Objects1.length = 0;
gdjs.InicioCode.GDPauseButton2Objects2.length = 0;
gdjs.InicioCode.GDPauseButton2Objects3.length = 0;
gdjs.InicioCode.GDPauseButton2Objects4.length = 0;
gdjs.InicioCode.GDPauseButton2Objects5.length = 0;
gdjs.InicioCode.GDBlackScreenObjects1.length = 0;
gdjs.InicioCode.GDBlackScreenObjects2.length = 0;
gdjs.InicioCode.GDBlackScreenObjects3.length = 0;
gdjs.InicioCode.GDBlackScreenObjects4.length = 0;
gdjs.InicioCode.GDBlackScreenObjects5.length = 0;
gdjs.InicioCode.GDPauseTextObjects1.length = 0;
gdjs.InicioCode.GDPauseTextObjects2.length = 0;
gdjs.InicioCode.GDPauseTextObjects3.length = 0;
gdjs.InicioCode.GDPauseTextObjects4.length = 0;
gdjs.InicioCode.GDPauseTextObjects5.length = 0;
gdjs.InicioCode.GDExitTextObjects1.length = 0;
gdjs.InicioCode.GDExitTextObjects2.length = 0;
gdjs.InicioCode.GDExitTextObjects3.length = 0;
gdjs.InicioCode.GDExitTextObjects4.length = 0;
gdjs.InicioCode.GDExitTextObjects5.length = 0;
gdjs.InicioCode.GDRestartTextObjects1.length = 0;
gdjs.InicioCode.GDRestartTextObjects2.length = 0;
gdjs.InicioCode.GDRestartTextObjects3.length = 0;
gdjs.InicioCode.GDRestartTextObjects4.length = 0;
gdjs.InicioCode.GDRestartTextObjects5.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects1.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects2.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects3.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects4.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects5.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects1.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects2.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects3.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects4.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects5.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects1.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects2.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects3.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects4.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects5.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects1.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects2.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects3.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects4.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects5.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects1.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects2.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects3.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects4.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects5.length = 0;
gdjs.InicioCode.GDOppIconObjects1.length = 0;
gdjs.InicioCode.GDOppIconObjects2.length = 0;
gdjs.InicioCode.GDOppIconObjects3.length = 0;
gdjs.InicioCode.GDOppIconObjects4.length = 0;
gdjs.InicioCode.GDOppIconObjects5.length = 0;
gdjs.InicioCode.GDtimerBarObjects1.length = 0;
gdjs.InicioCode.GDtimerBarObjects2.length = 0;
gdjs.InicioCode.GDtimerBarObjects3.length = 0;
gdjs.InicioCode.GDtimerBarObjects4.length = 0;
gdjs.InicioCode.GDtimerBarObjects5.length = 0;
gdjs.InicioCode.GDtimeObjects1.length = 0;
gdjs.InicioCode.GDtimeObjects2.length = 0;
gdjs.InicioCode.GDtimeObjects3.length = 0;
gdjs.InicioCode.GDtimeObjects4.length = 0;
gdjs.InicioCode.GDtimeObjects5.length = 0;
gdjs.InicioCode.GDtimerBar2Objects1.length = 0;
gdjs.InicioCode.GDtimerBar2Objects2.length = 0;
gdjs.InicioCode.GDtimerBar2Objects3.length = 0;
gdjs.InicioCode.GDtimerBar2Objects4.length = 0;
gdjs.InicioCode.GDtimerBar2Objects5.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects1.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects2.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects3.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects4.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects5.length = 0;
gdjs.InicioCode.GDLongNoteObjects1.length = 0;
gdjs.InicioCode.GDLongNoteObjects2.length = 0;
gdjs.InicioCode.GDLongNoteObjects3.length = 0;
gdjs.InicioCode.GDLongNoteObjects4.length = 0;
gdjs.InicioCode.GDLongNoteObjects5.length = 0;
gdjs.InicioCode.GDnotesObjects1.length = 0;
gdjs.InicioCode.GDnotesObjects2.length = 0;
gdjs.InicioCode.GDnotesObjects3.length = 0;
gdjs.InicioCode.GDnotesObjects4.length = 0;
gdjs.InicioCode.GDnotesObjects5.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects1.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects2.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects3.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects4.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects5.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects1.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects2.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects3.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects4.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects5.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects1.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects2.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects3.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects4.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects5.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects1.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects2.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects3.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects4.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects5.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects1.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects2.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects3.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects4.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects5.length = 0;
gdjs.InicioCode.GDStatistics2Objects1.length = 0;
gdjs.InicioCode.GDStatistics2Objects2.length = 0;
gdjs.InicioCode.GDStatistics2Objects3.length = 0;
gdjs.InicioCode.GDStatistics2Objects4.length = 0;
gdjs.InicioCode.GDStatistics2Objects5.length = 0;

gdjs.InicioCode.eventsList22(runtimeScene);
gdjs.InicioCode.GDBackObjects1.length = 0;
gdjs.InicioCode.GDBackObjects2.length = 0;
gdjs.InicioCode.GDBackObjects3.length = 0;
gdjs.InicioCode.GDBackObjects4.length = 0;
gdjs.InicioCode.GDBackObjects5.length = 0;
gdjs.InicioCode.GDNewTextObjects1.length = 0;
gdjs.InicioCode.GDNewTextObjects2.length = 0;
gdjs.InicioCode.GDNewTextObjects3.length = 0;
gdjs.InicioCode.GDNewTextObjects4.length = 0;
gdjs.InicioCode.GDNewTextObjects5.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects1.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects2.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects3.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects4.length = 0;
gdjs.InicioCode.GDLeftKeybindObjects5.length = 0;
gdjs.InicioCode.GDDownKeybindObjects1.length = 0;
gdjs.InicioCode.GDDownKeybindObjects2.length = 0;
gdjs.InicioCode.GDDownKeybindObjects3.length = 0;
gdjs.InicioCode.GDDownKeybindObjects4.length = 0;
gdjs.InicioCode.GDDownKeybindObjects5.length = 0;
gdjs.InicioCode.GDUpKeybindObjects1.length = 0;
gdjs.InicioCode.GDUpKeybindObjects2.length = 0;
gdjs.InicioCode.GDUpKeybindObjects3.length = 0;
gdjs.InicioCode.GDUpKeybindObjects4.length = 0;
gdjs.InicioCode.GDUpKeybindObjects5.length = 0;
gdjs.InicioCode.GDRightKeybindObjects1.length = 0;
gdjs.InicioCode.GDRightKeybindObjects2.length = 0;
gdjs.InicioCode.GDRightKeybindObjects3.length = 0;
gdjs.InicioCode.GDRightKeybindObjects4.length = 0;
gdjs.InicioCode.GDRightKeybindObjects5.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects1.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects2.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects3.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects4.length = 0;
gdjs.InicioCode.GDChartDelayInputObjects5.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects1.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects2.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects3.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects4.length = 0;
gdjs.InicioCode.GDChartDelayTextObjects5.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects1.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects2.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects3.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects4.length = 0;
gdjs.InicioCode.GDUpscrollIndicatorObjects5.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects1.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects2.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects3.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects4.length = 0;
gdjs.InicioCode.GDUpscrollTextObjects5.length = 0;
gdjs.InicioCode.GDHardObjects1.length = 0;
gdjs.InicioCode.GDHardObjects2.length = 0;
gdjs.InicioCode.GDHardObjects3.length = 0;
gdjs.InicioCode.GDHardObjects4.length = 0;
gdjs.InicioCode.GDHardObjects5.length = 0;
gdjs.InicioCode.GDSwipeTextObjects1.length = 0;
gdjs.InicioCode.GDSwipeTextObjects2.length = 0;
gdjs.InicioCode.GDSwipeTextObjects3.length = 0;
gdjs.InicioCode.GDSwipeTextObjects4.length = 0;
gdjs.InicioCode.GDSwipeTextObjects5.length = 0;
gdjs.InicioCode.GDNew_9595Objects1.length = 0;
gdjs.InicioCode.GDNew_9595Objects2.length = 0;
gdjs.InicioCode.GDNew_9595Objects3.length = 0;
gdjs.InicioCode.GDNew_9595Objects4.length = 0;
gdjs.InicioCode.GDNew_9595Objects5.length = 0;
gdjs.InicioCode.GDCustomScrollObjects1.length = 0;
gdjs.InicioCode.GDCustomScrollObjects2.length = 0;
gdjs.InicioCode.GDCustomScrollObjects3.length = 0;
gdjs.InicioCode.GDCustomScrollObjects4.length = 0;
gdjs.InicioCode.GDCustomScrollObjects5.length = 0;
gdjs.InicioCode.GDScrollSliderObjects1.length = 0;
gdjs.InicioCode.GDScrollSliderObjects2.length = 0;
gdjs.InicioCode.GDScrollSliderObjects3.length = 0;
gdjs.InicioCode.GDScrollSliderObjects4.length = 0;
gdjs.InicioCode.GDScrollSliderObjects5.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects1.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects2.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects3.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects4.length = 0;
gdjs.InicioCode.GDSongsNumbersObjects5.length = 0;
gdjs.InicioCode.GDOptionsTextObjects1.length = 0;
gdjs.InicioCode.GDOptionsTextObjects2.length = 0;
gdjs.InicioCode.GDOptionsTextObjects3.length = 0;
gdjs.InicioCode.GDOptionsTextObjects4.length = 0;
gdjs.InicioCode.GDOptionsTextObjects5.length = 0;
gdjs.InicioCode.GDbegfontObjects1.length = 0;
gdjs.InicioCode.GDbegfontObjects2.length = 0;
gdjs.InicioCode.GDbegfontObjects3.length = 0;
gdjs.InicioCode.GDbegfontObjects4.length = 0;
gdjs.InicioCode.GDbegfontObjects5.length = 0;
gdjs.InicioCode.GDnextbuttonObjects1.length = 0;
gdjs.InicioCode.GDnextbuttonObjects2.length = 0;
gdjs.InicioCode.GDnextbuttonObjects3.length = 0;
gdjs.InicioCode.GDnextbuttonObjects4.length = 0;
gdjs.InicioCode.GDnextbuttonObjects5.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects1.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects2.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects3.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects4.length = 0;
gdjs.InicioCode.GDlevelnumbertextObjects5.length = 0;
gdjs.InicioCode.GDPointsTextObjects1.length = 0;
gdjs.InicioCode.GDPointsTextObjects2.length = 0;
gdjs.InicioCode.GDPointsTextObjects3.length = 0;
gdjs.InicioCode.GDPointsTextObjects4.length = 0;
gdjs.InicioCode.GDPointsTextObjects5.length = 0;
gdjs.InicioCode.GDNewText2Objects1.length = 0;
gdjs.InicioCode.GDNewText2Objects2.length = 0;
gdjs.InicioCode.GDNewText2Objects3.length = 0;
gdjs.InicioCode.GDNewText2Objects4.length = 0;
gdjs.InicioCode.GDNewText2Objects5.length = 0;
gdjs.InicioCode.GDExportObjects1.length = 0;
gdjs.InicioCode.GDExportObjects2.length = 0;
gdjs.InicioCode.GDExportObjects3.length = 0;
gdjs.InicioCode.GDExportObjects4.length = 0;
gdjs.InicioCode.GDExportObjects5.length = 0;
gdjs.InicioCode.GDImportObjects1.length = 0;
gdjs.InicioCode.GDImportObjects2.length = 0;
gdjs.InicioCode.GDImportObjects3.length = 0;
gdjs.InicioCode.GDImportObjects4.length = 0;
gdjs.InicioCode.GDImportObjects5.length = 0;
gdjs.InicioCode.GDStatisticsObjects1.length = 0;
gdjs.InicioCode.GDStatisticsObjects2.length = 0;
gdjs.InicioCode.GDStatisticsObjects3.length = 0;
gdjs.InicioCode.GDStatisticsObjects4.length = 0;
gdjs.InicioCode.GDStatisticsObjects5.length = 0;
gdjs.InicioCode.GDComboNumbersObjects1.length = 0;
gdjs.InicioCode.GDComboNumbersObjects2.length = 0;
gdjs.InicioCode.GDComboNumbersObjects3.length = 0;
gdjs.InicioCode.GDComboNumbersObjects4.length = 0;
gdjs.InicioCode.GDComboNumbersObjects5.length = 0;
gdjs.InicioCode.GDNotesSplashObjects1.length = 0;
gdjs.InicioCode.GDNotesSplashObjects2.length = 0;
gdjs.InicioCode.GDNotesSplashObjects3.length = 0;
gdjs.InicioCode.GDNotesSplashObjects4.length = 0;
gdjs.InicioCode.GDNotesSplashObjects5.length = 0;
gdjs.InicioCode.GDfpsObjects1.length = 0;
gdjs.InicioCode.GDfpsObjects2.length = 0;
gdjs.InicioCode.GDfpsObjects3.length = 0;
gdjs.InicioCode.GDfpsObjects4.length = 0;
gdjs.InicioCode.GDfpsObjects5.length = 0;
gdjs.InicioCode.GDEngineTextObjects1.length = 0;
gdjs.InicioCode.GDEngineTextObjects2.length = 0;
gdjs.InicioCode.GDEngineTextObjects3.length = 0;
gdjs.InicioCode.GDEngineTextObjects4.length = 0;
gdjs.InicioCode.GDEngineTextObjects5.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects1.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects2.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects3.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects4.length = 0;
gdjs.InicioCode.GDLongUpscrollBFObjects5.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects1.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects2.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects3.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects4.length = 0;
gdjs.InicioCode.GDLongUpscrollOPPObjects5.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects1.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects2.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects3.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects4.length = 0;
gdjs.InicioCode.GDHitboxLeftObjects5.length = 0;
gdjs.InicioCode.GDHitboxDownObjects1.length = 0;
gdjs.InicioCode.GDHitboxDownObjects2.length = 0;
gdjs.InicioCode.GDHitboxDownObjects3.length = 0;
gdjs.InicioCode.GDHitboxDownObjects4.length = 0;
gdjs.InicioCode.GDHitboxDownObjects5.length = 0;
gdjs.InicioCode.GDHitboxUpObjects1.length = 0;
gdjs.InicioCode.GDHitboxUpObjects2.length = 0;
gdjs.InicioCode.GDHitboxUpObjects3.length = 0;
gdjs.InicioCode.GDHitboxUpObjects4.length = 0;
gdjs.InicioCode.GDHitboxUpObjects5.length = 0;
gdjs.InicioCode.GDhitrightObjects1.length = 0;
gdjs.InicioCode.GDhitrightObjects2.length = 0;
gdjs.InicioCode.GDhitrightObjects3.length = 0;
gdjs.InicioCode.GDhitrightObjects4.length = 0;
gdjs.InicioCode.GDhitrightObjects5.length = 0;
gdjs.InicioCode.GDBFIconObjects1.length = 0;
gdjs.InicioCode.GDBFIconObjects2.length = 0;
gdjs.InicioCode.GDBFIconObjects3.length = 0;
gdjs.InicioCode.GDBFIconObjects4.length = 0;
gdjs.InicioCode.GDBFIconObjects5.length = 0;
gdjs.InicioCode.GDPauseButtonObjects1.length = 0;
gdjs.InicioCode.GDPauseButtonObjects2.length = 0;
gdjs.InicioCode.GDPauseButtonObjects3.length = 0;
gdjs.InicioCode.GDPauseButtonObjects4.length = 0;
gdjs.InicioCode.GDPauseButtonObjects5.length = 0;
gdjs.InicioCode.GDPauseButton2Objects1.length = 0;
gdjs.InicioCode.GDPauseButton2Objects2.length = 0;
gdjs.InicioCode.GDPauseButton2Objects3.length = 0;
gdjs.InicioCode.GDPauseButton2Objects4.length = 0;
gdjs.InicioCode.GDPauseButton2Objects5.length = 0;
gdjs.InicioCode.GDBlackScreenObjects1.length = 0;
gdjs.InicioCode.GDBlackScreenObjects2.length = 0;
gdjs.InicioCode.GDBlackScreenObjects3.length = 0;
gdjs.InicioCode.GDBlackScreenObjects4.length = 0;
gdjs.InicioCode.GDBlackScreenObjects5.length = 0;
gdjs.InicioCode.GDPauseTextObjects1.length = 0;
gdjs.InicioCode.GDPauseTextObjects2.length = 0;
gdjs.InicioCode.GDPauseTextObjects3.length = 0;
gdjs.InicioCode.GDPauseTextObjects4.length = 0;
gdjs.InicioCode.GDPauseTextObjects5.length = 0;
gdjs.InicioCode.GDExitTextObjects1.length = 0;
gdjs.InicioCode.GDExitTextObjects2.length = 0;
gdjs.InicioCode.GDExitTextObjects3.length = 0;
gdjs.InicioCode.GDExitTextObjects4.length = 0;
gdjs.InicioCode.GDExitTextObjects5.length = 0;
gdjs.InicioCode.GDRestartTextObjects1.length = 0;
gdjs.InicioCode.GDRestartTextObjects2.length = 0;
gdjs.InicioCode.GDRestartTextObjects3.length = 0;
gdjs.InicioCode.GDRestartTextObjects4.length = 0;
gdjs.InicioCode.GDRestartTextObjects5.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects1.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects2.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects3.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects4.length = 0;
gdjs.InicioCode.GDmisses_9595challenge_9595textObjects5.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects1.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects2.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects3.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects4.length = 0;
gdjs.InicioCode.GDBfUpNoteObjects5.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects1.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects2.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects3.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects4.length = 0;
gdjs.InicioCode.GDBfDownNoteObjects5.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects1.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects2.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects3.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects4.length = 0;
gdjs.InicioCode.GDBfLeftNoteObjects5.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects1.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects2.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects3.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects4.length = 0;
gdjs.InicioCode.GDBfRightNoteObjects5.length = 0;
gdjs.InicioCode.GDOppIconObjects1.length = 0;
gdjs.InicioCode.GDOppIconObjects2.length = 0;
gdjs.InicioCode.GDOppIconObjects3.length = 0;
gdjs.InicioCode.GDOppIconObjects4.length = 0;
gdjs.InicioCode.GDOppIconObjects5.length = 0;
gdjs.InicioCode.GDtimerBarObjects1.length = 0;
gdjs.InicioCode.GDtimerBarObjects2.length = 0;
gdjs.InicioCode.GDtimerBarObjects3.length = 0;
gdjs.InicioCode.GDtimerBarObjects4.length = 0;
gdjs.InicioCode.GDtimerBarObjects5.length = 0;
gdjs.InicioCode.GDtimeObjects1.length = 0;
gdjs.InicioCode.GDtimeObjects2.length = 0;
gdjs.InicioCode.GDtimeObjects3.length = 0;
gdjs.InicioCode.GDtimeObjects4.length = 0;
gdjs.InicioCode.GDtimeObjects5.length = 0;
gdjs.InicioCode.GDtimerBar2Objects1.length = 0;
gdjs.InicioCode.GDtimerBar2Objects2.length = 0;
gdjs.InicioCode.GDtimerBar2Objects3.length = 0;
gdjs.InicioCode.GDtimerBar2Objects4.length = 0;
gdjs.InicioCode.GDtimerBar2Objects5.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects1.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects2.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects3.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects4.length = 0;
gdjs.InicioCode.GDRatinsPopUpObjects5.length = 0;
gdjs.InicioCode.GDLongNoteObjects1.length = 0;
gdjs.InicioCode.GDLongNoteObjects2.length = 0;
gdjs.InicioCode.GDLongNoteObjects3.length = 0;
gdjs.InicioCode.GDLongNoteObjects4.length = 0;
gdjs.InicioCode.GDLongNoteObjects5.length = 0;
gdjs.InicioCode.GDnotesObjects1.length = 0;
gdjs.InicioCode.GDnotesObjects2.length = 0;
gdjs.InicioCode.GDnotesObjects3.length = 0;
gdjs.InicioCode.GDnotesObjects4.length = 0;
gdjs.InicioCode.GDnotesObjects5.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects1.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects2.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects3.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects4.length = 0;
gdjs.InicioCode.GDOppLeftNoteObjects5.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects1.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects2.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects3.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects4.length = 0;
gdjs.InicioCode.GDOppDownNoteObjects5.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects1.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects2.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects3.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects4.length = 0;
gdjs.InicioCode.GDOppUpNoteObjects5.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects1.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects2.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects3.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects4.length = 0;
gdjs.InicioCode.GDOppRightNoteObjects5.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects1.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects2.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects3.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects4.length = 0;
gdjs.InicioCode.GDLongNoteOppObjects5.length = 0;
gdjs.InicioCode.GDStatistics2Objects1.length = 0;
gdjs.InicioCode.GDStatistics2Objects2.length = 0;
gdjs.InicioCode.GDStatistics2Objects3.length = 0;
gdjs.InicioCode.GDStatistics2Objects4.length = 0;
gdjs.InicioCode.GDStatistics2Objects5.length = 0;


return;

}

gdjs['InicioCode'] = gdjs.InicioCode;
