gdjs.PlayonlineCode = {};
gdjs.PlayonlineCode.localVariables = [];
gdjs.PlayonlineCode.idToCallbackMap = new Map();
gdjs.PlayonlineCode.GDJoinObjects1= [];
gdjs.PlayonlineCode.GDJoinObjects2= [];
gdjs.PlayonlineCode.GDJoinObjects3= [];
gdjs.PlayonlineCode.GDbackObjects1= [];
gdjs.PlayonlineCode.GDbackObjects2= [];
gdjs.PlayonlineCode.GDbackObjects3= [];
gdjs.PlayonlineCode.GDBFObjects1= [];
gdjs.PlayonlineCode.GDBFObjects2= [];
gdjs.PlayonlineCode.GDBFObjects3= [];
gdjs.PlayonlineCode.GDPlayer2textObjects1= [];
gdjs.PlayonlineCode.GDPlayer2textObjects2= [];
gdjs.PlayonlineCode.GDPlayer2textObjects3= [];
gdjs.PlayonlineCode.GDPlayer1textObjects1= [];
gdjs.PlayonlineCode.GDPlayer1textObjects2= [];
gdjs.PlayonlineCode.GDPlayer1textObjects3= [];
gdjs.PlayonlineCode.GDselesongtextObjects1= [];
gdjs.PlayonlineCode.GDselesongtextObjects2= [];
gdjs.PlayonlineCode.GDselesongtextObjects3= [];
gdjs.PlayonlineCode.GDsongselectedtextObjects1= [];
gdjs.PlayonlineCode.GDsongselectedtextObjects2= [];
gdjs.PlayonlineCode.GDsongselectedtextObjects3= [];
gdjs.PlayonlineCode.GDStartObjects1= [];
gdjs.PlayonlineCode.GDStartObjects2= [];
gdjs.PlayonlineCode.GDStartObjects3= [];
gdjs.PlayonlineCode.GDBFPixelObjects1= [];
gdjs.PlayonlineCode.GDBFPixelObjects2= [];
gdjs.PlayonlineCode.GDBFPixelObjects3= [];
gdjs.PlayonlineCode.GDHardObjects1= [];
gdjs.PlayonlineCode.GDHardObjects2= [];
gdjs.PlayonlineCode.GDHardObjects3= [];
gdjs.PlayonlineCode.GDBackObjects1= [];
gdjs.PlayonlineCode.GDBackObjects2= [];
gdjs.PlayonlineCode.GDBackObjects3= [];
gdjs.PlayonlineCode.GDJoin2Objects1= [];
gdjs.PlayonlineCode.GDJoin2Objects2= [];
gdjs.PlayonlineCode.GDJoin2Objects3= [];
gdjs.PlayonlineCode.GDStatisticsObjects1= [];
gdjs.PlayonlineCode.GDStatisticsObjects2= [];
gdjs.PlayonlineCode.GDStatisticsObjects3= [];
gdjs.PlayonlineCode.GDComboNumbersObjects1= [];
gdjs.PlayonlineCode.GDComboNumbersObjects2= [];
gdjs.PlayonlineCode.GDComboNumbersObjects3= [];
gdjs.PlayonlineCode.GDNotesSplashObjects1= [];
gdjs.PlayonlineCode.GDNotesSplashObjects2= [];
gdjs.PlayonlineCode.GDNotesSplashObjects3= [];
gdjs.PlayonlineCode.GDfpsObjects1= [];
gdjs.PlayonlineCode.GDfpsObjects2= [];
gdjs.PlayonlineCode.GDfpsObjects3= [];
gdjs.PlayonlineCode.GDEngineTextObjects1= [];
gdjs.PlayonlineCode.GDEngineTextObjects2= [];
gdjs.PlayonlineCode.GDEngineTextObjects3= [];
gdjs.PlayonlineCode.GDLongUpscrollBFObjects1= [];
gdjs.PlayonlineCode.GDLongUpscrollBFObjects2= [];
gdjs.PlayonlineCode.GDLongUpscrollBFObjects3= [];
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects1= [];
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects2= [];
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects3= [];
gdjs.PlayonlineCode.GDHitboxLeftObjects1= [];
gdjs.PlayonlineCode.GDHitboxLeftObjects2= [];
gdjs.PlayonlineCode.GDHitboxLeftObjects3= [];
gdjs.PlayonlineCode.GDHitboxDownObjects1= [];
gdjs.PlayonlineCode.GDHitboxDownObjects2= [];
gdjs.PlayonlineCode.GDHitboxDownObjects3= [];
gdjs.PlayonlineCode.GDHitboxUpObjects1= [];
gdjs.PlayonlineCode.GDHitboxUpObjects2= [];
gdjs.PlayonlineCode.GDHitboxUpObjects3= [];
gdjs.PlayonlineCode.GDhitrightObjects1= [];
gdjs.PlayonlineCode.GDhitrightObjects2= [];
gdjs.PlayonlineCode.GDhitrightObjects3= [];
gdjs.PlayonlineCode.GDBFIconObjects1= [];
gdjs.PlayonlineCode.GDBFIconObjects2= [];
gdjs.PlayonlineCode.GDBFIconObjects3= [];
gdjs.PlayonlineCode.GDPauseButtonObjects1= [];
gdjs.PlayonlineCode.GDPauseButtonObjects2= [];
gdjs.PlayonlineCode.GDPauseButtonObjects3= [];
gdjs.PlayonlineCode.GDPauseButton2Objects1= [];
gdjs.PlayonlineCode.GDPauseButton2Objects2= [];
gdjs.PlayonlineCode.GDPauseButton2Objects3= [];
gdjs.PlayonlineCode.GDBlackScreenObjects1= [];
gdjs.PlayonlineCode.GDBlackScreenObjects2= [];
gdjs.PlayonlineCode.GDBlackScreenObjects3= [];
gdjs.PlayonlineCode.GDPauseTextObjects1= [];
gdjs.PlayonlineCode.GDPauseTextObjects2= [];
gdjs.PlayonlineCode.GDPauseTextObjects3= [];
gdjs.PlayonlineCode.GDExitTextObjects1= [];
gdjs.PlayonlineCode.GDExitTextObjects2= [];
gdjs.PlayonlineCode.GDExitTextObjects3= [];
gdjs.PlayonlineCode.GDRestartTextObjects1= [];
gdjs.PlayonlineCode.GDRestartTextObjects2= [];
gdjs.PlayonlineCode.GDRestartTextObjects3= [];
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects1= [];
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects2= [];
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects3= [];
gdjs.PlayonlineCode.GDBfUpNoteObjects1= [];
gdjs.PlayonlineCode.GDBfUpNoteObjects2= [];
gdjs.PlayonlineCode.GDBfUpNoteObjects3= [];
gdjs.PlayonlineCode.GDBfDownNoteObjects1= [];
gdjs.PlayonlineCode.GDBfDownNoteObjects2= [];
gdjs.PlayonlineCode.GDBfDownNoteObjects3= [];
gdjs.PlayonlineCode.GDBfLeftNoteObjects1= [];
gdjs.PlayonlineCode.GDBfLeftNoteObjects2= [];
gdjs.PlayonlineCode.GDBfLeftNoteObjects3= [];
gdjs.PlayonlineCode.GDBfRightNoteObjects1= [];
gdjs.PlayonlineCode.GDBfRightNoteObjects2= [];
gdjs.PlayonlineCode.GDBfRightNoteObjects3= [];
gdjs.PlayonlineCode.GDOppIconObjects1= [];
gdjs.PlayonlineCode.GDOppIconObjects2= [];
gdjs.PlayonlineCode.GDOppIconObjects3= [];
gdjs.PlayonlineCode.GDtimerBarObjects1= [];
gdjs.PlayonlineCode.GDtimerBarObjects2= [];
gdjs.PlayonlineCode.GDtimerBarObjects3= [];
gdjs.PlayonlineCode.GDtimeObjects1= [];
gdjs.PlayonlineCode.GDtimeObjects2= [];
gdjs.PlayonlineCode.GDtimeObjects3= [];
gdjs.PlayonlineCode.GDtimerBar2Objects1= [];
gdjs.PlayonlineCode.GDtimerBar2Objects2= [];
gdjs.PlayonlineCode.GDtimerBar2Objects3= [];
gdjs.PlayonlineCode.GDRatinsPopUpObjects1= [];
gdjs.PlayonlineCode.GDRatinsPopUpObjects2= [];
gdjs.PlayonlineCode.GDRatinsPopUpObjects3= [];
gdjs.PlayonlineCode.GDLongNoteObjects1= [];
gdjs.PlayonlineCode.GDLongNoteObjects2= [];
gdjs.PlayonlineCode.GDLongNoteObjects3= [];
gdjs.PlayonlineCode.GDnotesObjects1= [];
gdjs.PlayonlineCode.GDnotesObjects2= [];
gdjs.PlayonlineCode.GDnotesObjects3= [];
gdjs.PlayonlineCode.GDOppLeftNoteObjects1= [];
gdjs.PlayonlineCode.GDOppLeftNoteObjects2= [];
gdjs.PlayonlineCode.GDOppLeftNoteObjects3= [];
gdjs.PlayonlineCode.GDOppDownNoteObjects1= [];
gdjs.PlayonlineCode.GDOppDownNoteObjects2= [];
gdjs.PlayonlineCode.GDOppDownNoteObjects3= [];
gdjs.PlayonlineCode.GDOppUpNoteObjects1= [];
gdjs.PlayonlineCode.GDOppUpNoteObjects2= [];
gdjs.PlayonlineCode.GDOppUpNoteObjects3= [];
gdjs.PlayonlineCode.GDOppRightNoteObjects1= [];
gdjs.PlayonlineCode.GDOppRightNoteObjects2= [];
gdjs.PlayonlineCode.GDOppRightNoteObjects3= [];
gdjs.PlayonlineCode.GDLongNoteOppObjects1= [];
gdjs.PlayonlineCode.GDLongNoteOppObjects2= [];
gdjs.PlayonlineCode.GDLongNoteOppObjects3= [];
gdjs.PlayonlineCode.GDStatistics2Objects1= [];
gdjs.PlayonlineCode.GDStatistics2Objects2= [];
gdjs.PlayonlineCode.GDStatistics2Objects3= [];


gdjs.PlayonlineCode.userFunc0xb4e488 = function GDJSInlineCode(runtimeScene) {
"use strict";
// WATCHER AUTOSSUFICIENTE (Skins + Música + UI Própria)
(async function(runtimeScene){
  "use strict";

  // --- 1. SINGLETON & AUTO-CLEANUP SETUP ---
  const originSceneName = runtimeScene.getName();
  if (window.GDJS_MULTIPLAYER_WATCHER_ACTIVE) return;
  window.GDJS_MULTIPLAYER_WATCHER_ACTIVE = true;

  // --- 2. CONFIG & ESTADO ---
  const CONFIG = {
      watchInterval: 500,
      repoStorageKey: "gdjs_repo_list_v1",
      activeRepoKey: "gdjs_active_repo_id_v1"
  };

  let lastState = { skinBF: null, skinDad: null, trackKey: null };
  let isDownloading = false;

  // --- 3. HELPERS DE REPOSITÓRIO (Copiados para independência) ---
  
  function defaultRepo() { return { owner: "LucyYuih", repo: "gdev-custom-charts", branch: "main" }; }
  
  function getActiveRepo() {
      try {
          const id = localStorage.getItem(CONFIG.activeRepoKey);
          const raw = localStorage.getItem(CONFIG.repoStorageKey);
          if (raw) {
              const list = JSON.parse(raw);
              const pick = list.find(r => r.id === id && r.enabled) || list.find(r => r.enabled) || list[0];
              if(pick) return pick;
          }
      } catch(e){}
      return defaultRepo();
  }

  function buildManifestRawUrl(entry) {
      if (entry.manifestUrl) return entry.manifestUrl; 
      return `https://raw.githubusercontent.com/${entry.owner}/${entry.repo}/${entry.branch || "main"}/manifest.json`;
  }

  function getBaseUrl(manifest, activeRepo) {
      if (manifest && manifest._base) return `https://cdn.jsdelivr.net/gh/${manifest._base}/`;
      return `https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch || "main"}/`;
  }

  // --- 4. HELPERS DE FETCH E ARQUIVOS ---
  function isAudio(n){ return /\.(mp3|ogg|wav|aac)$/i.test(n); }
  function isJson(n){ return /\.json$/i.test(n); }
  function basename(p){ return p.split("/").pop().replace(/\.[^.]+$/, ""); }
  const sleep = (ms) => new Promise(r=>setTimeout(r,ms));

  async function fetchBlob(url){ const r=await fetch(url); if(!r.ok) throw new Error(r.status); return await r.blob(); }
  async function fetchText(url){ const r=await fetch(url); if(!r.ok) throw new Error(r.status); return await r.text(); }

  // --- 5. LÓGICA DE MANIFESTO ---
  async function loadManifest(entry) {
      try {
          // Tenta Raw primeiro (mais atualizado)
          const url = buildManifestRawUrl(entry);
          const r = await fetch(url + "?t=" + Date.now());
          if(r.ok) return await r.json();
      } catch(e){}
      return null;
  }

  // Parser simplificado e robusto
  function getFilesFromManifest(manifest, path, baseUrl) {
      if(!manifest || !manifest[path]) return null;
      const entry = manifest[path];
      
      // Formato Array ["arquivo.json", "subpasta"]
      if(Array.isArray(entry)) {
          return entry.filter(x => x.includes('.')).map(f => ({
              name: f.split('/').pop(),
              url: baseUrl + (path ? path + "/" + f : f)
          }));
      }
      // Formato Objeto { files: [...], subdirs: [...] }
      if(entry.files && Array.isArray(entry.files)) {
          return entry.files.map(f => ({
              name: f.split('/').pop(),
              url: baseUrl + (path ? path + "/" + f : f)
          }));
      }
      return null;
  }

  // Fallback API GitHub
  async function ghList(entry, path) {
      try {
          const url = `https://api.github.com/repos/${entry.owner}/${entry.repo}/contents/${encodeURIComponent(path)}?ref=${entry.branch||'main'}`;
          const r = await fetch(url);
          if(!r.ok) return [];
          const json = await r.json();
          return json.map(i => ({
              name: i.name,
              url: i.download_url,
              type: i.type
          })).filter(i => i.type === 'file');
      } catch(e){ return []; }
  }

  // --- 6. INTERFACE DE DOWNLOAD (OVERLAY) ---
  const OVERLAY_ID = "gdjs-watcher-overlay";
  function showOverlay(msg) {
      let el = document.getElementById(OVERLAY_ID);
      if(!el) {
          el = document.createElement("div");
          el.id = OVERLAY_ID;
          Object.assign(el.style, {
              position: "fixed", inset: "0", background: "rgba(0,0,0,0.7)", 
              display: "flex", alignItems: "center", justifyContent: "center", 
              zIndex: "9999999", color: "#fff", flexDirection: "column", gap: "10px",
              fontFamily: "Arial, sans-serif"
          });
          el.innerHTML = `<div style="width:40px;height:40px;border:4px solid #333;border-top:4px solid #09f;border-radius:50%;animation:spin 1s linear infinite"></div><div id="gd-watcher-msg"></div><style>@keyframes spin{to{transform:rotate(360deg)}}</style>`;
          document.body.appendChild(el);
      }
      const txt = el.querySelector("#gd-watcher-msg");
      if(txt) txt.textContent = msg;
  }
  function hideOverlay() { const el = document.getElementById(OVERLAY_ID); if(el) el.remove(); }

  // --- 7. CLEANUP DE ÁUDIO ---
  function cleanupAudio(){
      try {
          if(window.gdjsChannels) {
              Object.values(window.gdjsChannels).forEach(a => {
                  try{ a.pause(); a.currentTime=0; }catch(e){}
                  if(a.src && a.src.startsWith('blob:')) URL.revokeObjectURL(a.src);
              });
          }
          if(window.gdjsCustomAudio) {
              Object.values(window.gdjsCustomAudio).forEach(f => {
                  if(f.audios) Object.values(f.audios).forEach(a => { if(a.blobUrl) URL.revokeObjectURL(a.blobUrl); });
              });
          }
      } catch(e){}
      window.gdjsChannels = {};
      window.gdjsCustomAudio = {};
  }

  // --- 8. LÓGICA CORE: BAIXAR MÚSICA & CHARTS ---
  async function downloadCompleteSong(folderPath) {
      if(isDownloading) return;
      isDownloading = true;
      showOverlay("Sincronizando: " + folderPath);
      
      try {
          cleanupAudio(); // Limpa a anterior
          
          const repo = getActiveRepo();
          const manifest = await loadManifest(repo);
          const baseUrl = getBaseUrl(manifest, repo);

          // 1. Encontrar Arquivos (Manifesto ou GitHub)
          let files = getFilesFromManifest(manifest, folderPath, baseUrl);
          if(!files || files.length === 0) {
              showOverlay("Buscando no GitHub...");
              files = await ghList(repo, folderPath);
          }

          if(!files || files.length === 0) throw new Error("Pasta vazia ou não encontrada.");

          // Configura Globais
          window.gdjsCustomAudio = {};
          window.gdjsCustomAudio[folderPath] = { audios: {}, rawFiles: {} };
          const dest = window.gdjsCustomAudio[folderPath];

          // Variaveis GDevelop
          const gg = runtimeScene.getGame().getVariables();
          if(gg.has("selectedTrackKey")) gg.get("selectedTrackKey").setString(folderPath);
          if(gg.has("SongName")) gg.get("SongName").setString(basename(folderPath));
          if(gg.has("AllLoaded")) gg.get("AllLoaded").setNumber(0);

          let channelIdx = 0;

          // 2. Baixar Arquivos
          for(const f of files) {
              // Áudios
              if(isAudio(f.name)) {
                  showOverlay("Baixando: " + f.name);
                  const blob = await fetchBlob(f.url);
                  const blobUrl = URL.createObjectURL(blob);
                  const audioEl = new Audio(blobUrl);
                  audioEl.preload = "auto"; audioEl.loop = false;
                  dest.audios[f.name] = { blobUrl, audioEl };
                  window.gdjsChannels[channelIdx++] = audioEl;
              }
              // Charts (JSON)
              else if(isJson(f.name)) {
                  showOverlay("Baixando chart: " + f.name);
                  const txt = await fetchText(f.url);
                  dest.rawFiles[f.name] = txt;
                  
                  // Injeta nas variáveis globais
                  const ln = f.name.toLowerCase();
                  if(ln.includes("meta")) { if(gg.has("metadatajson")) gg.get("metadatajson").setString(txt); }
                  else if(ln.includes("bf")) { if(gg.has("BfChartJsonLoader")) gg.get("BfChartJsonLoader").setString(txt); }
                  else if(ln.includes("dad")||ln.includes("opp")) { if(gg.has("OppChartJsonLoader")) gg.get("OppChartJsonLoader").setString(txt); }
                  else {
                      // Tenta adivinhar se é chart genérico
                      try {
                          const p = JSON.parse(txt);
                          if(p.song && p.notes) {
                              if(gg.has("BfChartJsonLoader") && !gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt);
                          }
                      } catch(e){}
                  }
              }
          }

          // Finaliza
          if(gg.has("AllLoaded")) gg.get("AllLoaded").setNumber(1);
          console.log("[Watcher] Download completo para: " + folderPath);

      } catch(e) {
          console.error(e);
          alert("Erro no download multiplayer: " + e.message);
      } finally {
          hideOverlay();
          isDownloading = false;
      }
  }

  // --- 9. LÓGICA DE SKINS (Modificada para Resize) ---
  async function applySkin(selStr, targetOpts){
      if(!selStr) return;
      try {
          const parsed = JSON.parse(selStr);
          const url = parsed.zip_cdn || parsed.zip;
          if(!url) return;
          
          // --- CAPTURA A ESCALA DO JSON (MULTIPLAYER) ---
          const scaleVal = (typeof parsed.scale === "number") ? parsed.scale : 1.0;
          // ----------------------------------------------

          let buf = null;
          if(window.GD_SKIN_CACHE && window.GD_SKIN_CACHE.zips[url]) buf = window.GD_SKIN_CACHE.zips[url];
          else { const r = await fetch(url); if(r.ok) buf = await r.arrayBuffer(); }
          
          if(window.GD_SKIN_PLAYER && buf) {
              // Passa a escala para o Load (Resize)
              const pkg = await window.GD_SKIN_PLAYER.loadFromArrayBuffer(runtimeScene, buf, { scale: scaleVal });
              // Passa a escala para o Apply (Compensação Visual)
              await window.GD_SKIN_PLAYER.applyPackageToScene(runtimeScene, pkg, { ...targetOpts, scale: scaleVal });
          }
      } catch(e){}
  }

  // --- 10. LOOP PRINCIPAL ---
  const watcherInterval = setInterval(async () => {
      // Auto-Cleanup
      let currentSceneName = "";
      try { currentSceneName = runtimeScene.getGame().getSceneStack().getCurrentScene().getName(); } catch(e) {}
      if (currentSceneName && originSceneName && currentSceneName !== originSceneName) {
          window.GDJS_MULTIPLAYER_WATCHER_ACTIVE = false;
          clearInterval(watcherInterval);
          hideOverlay();
          return;
      }

      if(isDownloading) return; // Não interrompe download

      // Monitoramento
      try {
          const gv = runtimeScene.getGame().getVariables();
          
          // Detectar Player Number
          let playerOnline = 0;
          if(gv.has("PlayerOnline")) playerOnline = gv.get("PlayerOnline").getAsNumber();
          else if(gdjs && gdjs.multiplayer) {
              const n = gdjs.multiplayer.getCurrentPlayerNumber();
              if(n) playerOnline = (n===1)?1:2;
          }

          // Variáveis
          const curSkinBF = gv.has("SelectedSkin") ? gv.get("SelectedSkin").getAsString() : "";
          const curSkinDad = gv.has("SelectedDadSkin") ? gv.get("SelectedDadSkin").getAsString() : "";
          const curTrack = gv.has("selectedTrackKey") ? gv.get("selectedTrackKey").getAsString() : "";
          
          // Sync Skins
          if (playerOnline !== 1 && curSkinBF !== lastState.skinBF) {
              if(curSkinBF) await applySkin(curSkinBF, { targetName: "BF", targetAnimVar: "BFAnim" });
              lastState.skinBF = curSkinBF;
          }
          if (playerOnline !== 2 && curSkinDad !== lastState.skinDad) {
              if(curSkinDad) await applySkin(curSkinDad, { targetName: "BFPixel", targetAnimVar: "OPPAnim" });
              lastState.skinDad = curSkinDad;
          }

          // Sync Música
          if (curTrack && curTrack !== lastState.trackKey) {
              if(curTrack.trim() !== "") {
                  await downloadCompleteSong(curTrack);
              }
              lastState.trackKey = curTrack;
          }

      } catch(e){}

  }, CONFIG.watchInterval);
  
  // Inicializar estados para evitar re-download no boot se já estiver definido
  try {
      const gv = runtimeScene.getGame().getVariables();
      if(gv.has("SelectedSkin")) lastState.skinBF = gv.get("SelectedSkin").getAsString();
      if(gv.has("SelectedDadSkin")) lastState.skinDad = gv.get("SelectedDadSkin").getAsString();
      if(gv.has("selectedTrackKey")) lastState.trackKey = gv.get("selectedTrackKey").getAsString();
  } catch(e){}

  console.log("[Multi-Watcher] Iniciado (Modo Autossuficiente).");

})(runtimeScene);
};
gdjs.PlayonlineCode.eventsList0 = function(runtimeScene) {

{


gdjs.PlayonlineCode.userFunc0xb4e488(runtimeScene);

}


{



}


};gdjs.PlayonlineCode.eventsList1 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.multiplayer.isCurrentPlayerHost());
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("Start"), gdjs.PlayonlineCode.GDStartObjects1);
{for(var i = 0, len = gdjs.PlayonlineCode.GDStartObjects1.length ;i < len;++i) {
    gdjs.PlayonlineCode.GDStartObjects1[i].deleteFromScene(runtimeScene);
}
}

{ //Subevents
gdjs.PlayonlineCode.eventsList0(runtimeScene);} //End of subevents
}

}


};gdjs.PlayonlineCode.eventsList2 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.playerAuthentication.isAuthenticated();
if (isConditionTrue_0) {
{gdjs.multiplayer.openLobbiesWindow(runtimeScene);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.playerAuthentication.isAuthenticated());
if (isConditionTrue_0) {
{gdjs.playerAuthentication.openAuthenticationWindow(runtimeScene);
}
}

}


};gdjs.PlayonlineCode.eventsList3 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.playerAuthentication.isAuthenticated();
if (isConditionTrue_0) {
{gdjs.multiplayer.authenticateAndQuickJoinLobby(runtimeScene, true, true);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.playerAuthentication.isAuthenticated());
if (isConditionTrue_0) {
{gdjs.playerAuthentication.openAuthenticationWindow(runtimeScene);
}
}

}


};gdjs.PlayonlineCode.eventsList4 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isCurrentPlayerHost();
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(17).setNumber(1);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.multiplayer.isCurrentPlayerHost());
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("selesongtext"), gdjs.PlayonlineCode.GDselesongtextObjects2);
{for(var i = 0, len = gdjs.PlayonlineCode.GDselesongtextObjects2.length ;i < len;++i) {
    gdjs.PlayonlineCode.GDselesongtextObjects2[i].deleteFromScene(runtimeScene);
}
}
{runtimeScene.getGame().getVariables().getFromIndex(17).setNumber(2);
}
}

}


{


let isConditionTrue_0 = false;
{
{gdjs.evtTools.camera.setCameraX(runtimeScene, gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) + (2220), "", 0);
}
{runtimeScene.getGame().getVariables().getFromIndex(63).getChild(2).setString("NoBotplay");
}
{gdjs.evtTools.storage.writeStringInJSONFile("Modifiers", "Botplay", "NoBotplay");
}
{runtimeScene.getGame().getVariables().getFromIndex(63).getChild(3).setString("NoMissesChallenge");
}
{gdjs.evtTools.storage.writeStringInJSONFile("Modifiers", "MissChallenge", "NoMissChallenge");
}
}

}


};gdjs.PlayonlineCode.eventsList5 = function(runtimeScene) {

{



}


};gdjs.PlayonlineCode.userFunc0x13fed08 = function GDJSInlineCode(runtimeScene) {
"use strict";
(async function(runtimeScene) {
  // --- 1. CONFIGURAÇÃO DE CLEANUP ---
  const originSceneName = runtimeScene.getName();
  
  if (document.querySelector(".skin-modal")) {
    document.querySelector(".skin-modal").style.display = "flex";
    return;
  }

  // --- 2. CONSTANTES E HELPERS ---
  const MANIFEST_NAME = "manifestskins.json";
  const JSDELIVR_PREFIX = "https://cdn.jsdelivr.net/gh";
  const GITHUB_RAW_URL = `https://raw.githubusercontent.com/LucyYuih/gdev-custom-skins/main/${MANIFEST_NAME}`;
  const LOCAL_STORAGE_KEY = "skin_loader_manifest";

  function clearPixiTextureCache(skinName) {
    if (!window.PIXI) return;
    try {
        for (const key in PIXI.utils.TextureCache) { if (key.includes(skinName)) { try { PIXI.utils.TextureCache[key].destroy(true); delete PIXI.utils.TextureCache[key]; } catch(e) 
        {} } }
        for (const key in PIXI.utils.BaseTextureCache) { if (key.includes(skinName)) { try { delete PIXI.utils.BaseTextureCache[key]; } catch(e) {} } }
    } catch (e) {}
  }

  function encodePathForCdn(p){ return String(p).replace(/^\.\//,'').replace(/\\/g,'/').replace(/ /g,'%20');
  }
  function buildCdnUrl(owner, repo, branch, path){ if (!owner || !repo) return null; const br = branch || "main";
  return `${JSDELIVR_PREFIX}/${owner}/${repo}@${br}/${encodePathForCdn(path)}`; }

  async function fetchCdnFirst(pathOrUrl, as="json", cdnBase=null){
    const isAbs = typeof pathOrUrl === "string" && (pathOrUrl.startsWith("http://") || pathOrUrl.startsWith("https://"));
    const tries = []; if (isAbs) tries.push(pathOrUrl);
    if (!isAbs && cdnBase && cdnBase.owner) { const c = buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, pathOrUrl);
    if (c) tries.push(c); }
    tries.push(pathOrUrl); tries.push("resources/" + pathOrUrl);
    for (const u of tries) { try { const r = await fetch(u); if (!r.ok) continue;
    if (as==="json") return await r.json(); if (as==="arraybuffer") return await r.arrayBuffer(); if (as==="blob") return await r.blob(); return await r.text();
    } catch (e) {} }
    throw new Error("Fetch failed");
  }

  function getSkinName(sk) { if (sk.name) return sk.name; if (sk.path) return sk.path.split('/').pop(); return "";
  }
  function buildFilePathFromSkin(sk, field) { const v = sk[field] || ""; if (!v) return ""; if (v.startsWith("http")) return v;
  if (sk.path) return sk.path.replace(/\\/g,'/') + "/" + v; return v;
  }

  // --- 3. UI LOADING ---
  function showLoadingModal() {
    const existing = document.getElementById("skin-download-loading");
    if (existing) return existing;
    const modal = document.createElement("div"); modal.id = "skin-download-loading";
    modal.style.cssText = `position: fixed; inset: 0; background: rgba(0,0,0,0.85);
    display: flex; align-items: center; justify-content: center; z-index: 100000; color: white; font-family: Arial, sans-serif; flex-direction: column; gap: 16px;`;
    modal.innerHTML = `<div style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #1976d2; animation: spin 1s linear infinite;"></div><div>Baixando...</div><style>@keyframes spin{to{transform:rotate(360deg)}}</style>`;
    document.body.appendChild(modal); return modal;
  }
  function hideLoadingModal() { const m = document.getElementById("skin-download-loading"); if (m) m.remove();
  }

  // --- 4. MULTIPLAYER HELPERS ---
  function getPlayerOnlineValue(rs){
    try { const gv = rs.getGame().getVariables();
    if (gv.has("PlayerOnline")) return gv.get("PlayerOnline").getAsNumber(); } catch(e){}
    try { if (typeof gdjs !== 'undefined' && gdjs.multiplayer) { const pn = gdjs.multiplayer.getCurrentPlayerNumber();
    if (typeof pn === 'number') return pn===1?1:2; } } catch(e){}
    return 0;
  }

  // --- 5. LOGIC ---
  let modalOwner = null, modalRepo = null, modalBranch = null;
  let globalManifest = null;

  async function applyNow(modName, skinObj, target){
    if (applyNow._busy) return; applyNow._busy = true;
    let zipPath = buildFilePathFromSkin(skinObj, "zip");
    if (!zipPath) return; showLoadingModal();
    try {
      const cdnBase = { owner: modalOwner, repo: modalRepo, branch: modalBranch };
      const cdnCandidate = (zipPath.startsWith("http")) ? zipPath : buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, zipPath);
      
      const arrbuf = await fetchCdnFirst(cdnCandidate || zipPath, "arraybuffer", cdnBase);
      
      // --- CAPTURA A ESCALA DO SELECT UI ---
      const scaleEl = document.getElementById("skin-quality-select");
      const scaleVal = scaleEl ? parseFloat(scaleEl.value) : 1.0;
      if(scaleEl) localStorage.setItem("gd_skin_last_scale", scaleVal.toString());
      // -------------------------------------

      // Salva a escala no JSON para Multiplayer
      const sel = { mod: modName, name: getSkinName(skinObj), zip: zipPath, zip_cdn: cdnCandidate, scale: scaleVal };
      
      clearPixiTextureCache(getSkinName(skinObj));
      const varName = target === "BF" ? "SelectedSkin" : "SelectedDadSkin";
      const storageKey = target === "BF" ? "gd_selected_skin" : "gd_selected_dad_skin";
      const gv = runtimeScene.getGame().getVariables();
      if (gv.has(varName)) gv.get(varName).setString(JSON.stringify(sel)); else gv.pushNew(varName).setString(JSON.stringify(sel));
      localStorage.setItem(storageKey, JSON.stringify(sel));
      
      if (window.GD_SKIN_PLAYER) {
          // Passa a escala para redimensionar (Load) e compensar (Apply)
          const pkg = await window.GD_SKIN_PLAYER.loadFromArrayBuffer(runtimeScene, arrbuf, { targetName: target === "BF" ? "BF" : "BFPixel", scale: scaleVal });
          await window.GD_SKIN_PLAYER.applyPackageToScene(runtimeScene, pkg, { targetName: target === "BF" ? "BF" : "BFPixel", targetAnimVar: target === "BF" ? "BFAnim" : "OPPAnim", scale: scaleVal });
      }
    } catch(e){ console.error(e); } finally { hideLoadingModal(); applyNow._busy = false;
    }
  }

  async function resetAndRedownload(modName, skinObj, auto=false){
    if (resetAndRedownload._busy) return; resetAndRedownload._busy = true;
    if(!auto && !confirm("Resetar?")) { resetAndRedownload._busy = false; return; }
    const skinName = typeof skinObj === "object" ?
    getSkinName(skinObj) : skinObj; showLoadingModal();
    try {
        const gv = runtimeScene.getGame().getVariables();
        if (gv.has("SelectedSkin")) gv.get("SelectedSkin").setString("");
        if (gv.has("SelectedDadSkin")) gv.get("SelectedDadSkin").setString("");
        localStorage.removeItem("gd_selected_skin"); localStorage.removeItem("gd_selected_dad_skin");
        if (window.GD_SKIN_PLAYER) await window.GD_SKIN_PLAYER.clearCache();
        clearPixiTextureCache(skinName);
        if(!auto) alert("Resetado.");
    } catch(e){} finally { hideLoadingModal(); resetAndRedownload._busy = false;
    }
  }

  // --- 6. UI ---
  function createModal(defaultOwner, defaultRepo, defaultBranch) {
    const css = `
      :root { --modal-gap:12px;
      --panel-bg:#0f0f11; --panel-radius:12px; --accent:#1976d2; }
      .skin-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center;
      z-index:99999; padding:20px; }
      .skin-panel { width: min(1100px,98%); max-width:1100px; height: min(86vh,820px); background:var(--panel-bg); color:#eee; border-radius:var(--panel-radius); display:grid;
      grid-template-columns:300px 1fr; gap:var(--modal-gap); overflow:hidden; font-family:Arial, sans-serif; box-shadow: 0 12px 32px rgba(0,0,0,0.6);
      }
      @media (max-width:720px){ .skin-panel{ grid-template-columns:1fr; height:calc(100vh-36px); width:100%; } .skin-left{ order:0; max-height:160px; overflow:auto; } .skin-right{ order:1;
      } }
      .skin-left{ padding:14px; border-right:1px solid rgba(255,255,255,0.05); overflow:auto; min-width:180px;
      }
      .skin-right{ padding:14px; display:flex; flex-direction:column; overflow:auto; }
      .skin-mod{ padding:8px;
      margin:6px 0; background:rgba(255,255,255,0.02); border-radius:8px; cursor:pointer; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
      .skin-mod:hover { background: rgba(255,255,255,0.03);
      }
      .skin-btn{ padding:8px 10px; border-radius:8px; background: var(--accent); color:white; border:none; cursor:pointer; font-size:13px;
      }
      .skin-btn.opponent{ background:#d32f2f; } .skin-btn.bf{ background:#1976d2; }
      .skin-list{ display:flex; flex-wrap:wrap;
      gap:10px; overflow:auto; padding:6px; align-content:flex-start; }
      .skin-card{ width: clamp(110px,22%,160px); min-width:110px; background: rgba(255,255,255,0.02); border-radius:8px; padding:8px; text-align:center; cursor:pointer;
      display:flex; flex-direction:column; gap:8px; }
      .skin-card img{ width:100%; height:90px; object-fit:contain; background:#222; border-radius:6px; transition: opacity 0.3s;
      opacity: 0; }
      .skin-card img.loaded { opacity: 1;
      }
      .skin-card button.skin-btn{ padding:6px 8px; font-size:12px; border-radius:6px; width:100%; }
    `;
    const style = document.createElement("style"); style.textContent = css; document.head.appendChild(style);
    const modal = document.createElement("div"); modal.className = "skin-modal";
    const panel = document.createElement("div");
    panel.className = "skin-panel";
    const left = document.createElement("div"); left.className = "skin-left";
    const leftList = document.createElement("div"); left.appendChild(leftList);
    const right = document.createElement("div");
    right.className = "skin-right";
    const top = document.createElement("div"); 
    
    // --- NOVO: SELECT DE QUALIDADE ---
    const qualitySel = document.createElement("select");
    qualitySel.id = "skin-quality-select";
    qualitySel.style.cssText = "background: #222; color: #ddd; border: 1px solid rgba(255,255,255,0.1); padding: 7px; border-radius: 6px; font-size: 13px; margin-right: 8px;";
    const opts = [
        {txt: "100% (Original)", val: "1.0"},
        {txt: "75% (Leve)", val: "0.75"},
        {txt: "50% (Rápido)", val: "0.5"},
        {txt: "25% (Batata)", val: "0.25"}
    ];
    opts.forEach(o => { const op = document.createElement("option"); op.value = o.val; op.textContent = o.txt; qualitySel.appendChild(op); });
    try { const ls = localStorage.getItem("gd_skin_last_scale"); if(ls) qualitySel.value = ls; } catch(e){}
    // ---------------------------------

    const closeBtn = document.createElement("button"); closeBtn.className = "skin-btn"; closeBtn.textContent = "Fechar";
    
    top.appendChild(qualitySel); // Adiciona na barra
    top.appendChild(closeBtn); 
    
    right.appendChild(top);
    const skinListWrap = document.createElement("div"); skinListWrap.style.flex="1"; skinListWrap.style.overflow="auto";
    right.appendChild(skinListWrap); panel.append(left, right); modal.appendChild(panel); document.body.appendChild(modal);
    return { modal, leftList, closeBtn, skinListWrap };
  }

  // --- 7. MAIN ---
  async function openSkinSelector(manifest){
    globalManifest = manifest ||
    { "": [] };
    let baseOwner="LucyYuih", baseRepo="gdev-custom-skins", baseBranch="main";
    if (manifest && manifest._base) { const [or, br] = manifest._base.split("@");
    const [o, r] = or.split("/"); baseOwner=o; baseRepo=r; baseBranch=br; }
    
    const { modal, leftList, closeBtn, skinListWrap } = createModal(baseOwner, baseRepo, baseBranch);
    modalOwner = baseOwner; modalRepo = baseRepo; modalBranch = baseBranch;
    
    // LAZY LOAD
    const lazyObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => { if (entry.isIntersecting) {
            const img = entry.target; const src = img.dataset.src;
            if (src) { const cdnBase = JSON.parse(img.dataset.cdnBase); fetchCdnFirst(src, "blob", cdnBase).then(blob => { img.src = URL.createObjectURL(blob); img.classList.add("loaded"); }).catch(()=>{}); }
            lazyObserver.unobserve(img);
      
        }});
    }, { root: skinListWrap, rootMargin: "100px" });
    // MODS
    const mods = manifest[""] || [];
    for (const m of mods) { const el=document.createElement("div"); el.className="skin-mod";
    el.textContent=m; el.onclick=()=>selectMod(m); leftList.appendChild(el); }
    closeBtn.onclick = () => { modal.style.display = 'none'; };
    async function selectMod(modName){
      skinListWrap.innerHTML=""; const list=document.createElement("div"); list.className="skin-list"; skinListWrap.appendChild(list);
      const skins = manifest[modName] || [];
      const cdnBase={ owner: modalOwner, repo: modalRepo, branch: modalBranch };
      const playerOnline = getPlayerOnlineValue(runtimeScene);
      const showBF = (playerOnline === 0 || playerOnline === 1);
      const showOpp = (playerOnline === 0 || playerOnline === 2);
      for (const sk of skins){
        const card=document.createElement("div"); card.className="skin-card";
        const img=document.createElement("img"); img.alt=getSkinName(sk);
        let thumbPath = buildFilePathFromSkin(sk, "thumb");
        if(thumbPath) { const cand = (thumbPath.startsWith("http")) ? thumbPath : buildCdnUrl(cdnBase.owner, cdnBase.repo, cdnBase.branch, thumbPath);
        img.dataset.src = cand; img.dataset.cdnBase = JSON.stringify(cdnBase); lazyObserver.observe(img); }
        else img.style.background="#333";
        const lbl=document.createElement("div"); lbl.textContent=getSkinName(sk);
        if(showBF){ const btn = document.createElement("button"); btn.className = "skin-btn bf"; btn.textContent = "BF"; btn.onclick = (e)=>{ e.stopPropagation(); applyNow(modName, sk, "BF"); };
        card.appendChild(btn); }
        if(showOpp){ const btn = document.createElement("button"); btn.className = "skin-btn opponent";
        btn.textContent = "Opp"; btn.onclick = (e)=>{ e.stopPropagation(); applyNow(modName, sk, "Opponent"); }; card.appendChild(btn);
        }
        const rst = document.createElement("button"); rst.className="skin-btn"; rst.textContent="Rst"; rst.onclick=(e)=>{ e.stopPropagation(); resetAndRedownload(modName, sk, false); };
        card.appendChild(rst);
        
        card.insertBefore(lbl, card.firstChild); card.insertBefore(img, lbl); list.appendChild(card);
      }
    }
  }

  // --- 8. WATCHER (Sincronia Multiplayer) ---
  let _skinWatcherInterval = null;
  let _skinWatcherLast = { SelectedSkin: null, SelectedDadSkin: null };

  async function applySelectionString(rs, selStr, opts = {}){ 
    if (!selStr) return;
    const parsed = JSON.parse(selStr);
    const zipUrl = parsed.zip_cdn || parsed.zip; if(!zipUrl) return;
    
    // --- EXTRAIR ESCALA DA STRING SINCRONIZADA ---
    const remoteScale = (typeof parsed.scale === 'number') ? parsed.scale : 1.0;
    
    try {
        let arr = null;
        if(window.GD_SKIN_CACHE && window.GD_SKIN_CACHE.zips[zipUrl]) arr = window.GD_SKIN_CACHE.zips[zipUrl];
        else { const r = await fetch(zipUrl); if(r.ok) arr = await r.arrayBuffer();
        }
        if(arr && window.GD_SKIN_PLAYER) {
            // Passa escala para Load (resize) e Apply (compensação)
            const pkg = await window.GD_SKIN_PLAYER.loadFromArrayBuffer(rs, arr, { scale: remoteScale });
            return window.GD_SKIN_PLAYER.applyPackageToScene(rs, pkg, { ...opts, scale: remoteScale });
        }
    } catch(e){}
  }

  function startSkinWatcher(rs){
    if (_skinWatcherInterval) return;
    _skinWatcherInterval = setInterval(async ()=> {
      try{
        const gv = rs.getGame().getVariables();
        const cur = { SelectedSkin: gv.get('SelectedSkin').getAsString(), SelectedDadSkin: gv.get('SelectedDadSkin').getAsString() };
        const playerOnline = getPlayerOnlineValue(rs);
        if ((cur.SelectedSkin||'') !== (_skinWatcherLast.SelectedSkin||'')){ if (playerOnline !== 1 && cur.SelectedSkin) await applySelectionString(rs, cur.SelectedSkin, { targetName: "BF", targetAnimVar: "BFAnim" }); }
        if ((cur.SelectedDadSkin||'') !== (_skinWatcherLast.SelectedDadSkin||'')){ if (playerOnline !== 2 && cur.SelectedDadSkin) await applySelectionString(rs, cur.SelectedDadSkin, { targetName: "BFPixel", targetAnimVar: 
        "OPPAnim" }); }
        _skinWatcherLast = cur;
      } catch(e){}
    }, 700);
  }

  // --- 9. BOOTSTRAP + AUTO CLEANUP ---
  try {
    let manifest = null;
    try { const r = await fetch(GITHUB_RAW_URL); if(r.ok) { manifest = await r.json(); localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(manifest));
    } } catch(e){}
    if(!manifest) try { manifest = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY));
    } catch(e){}
    if(!manifest) try { manifest = await fetchCdnFirst(MANIFEST_NAME, "json");
    } catch(e){}
    
    await openSkinSelector(manifest);
    startSkinWatcher(runtimeScene);
    // VIGILANTE DA CENA (CLEANUP)
    const watcher = setInterval(() => {
        let currentSceneName = "";
        try { currentSceneName = runtimeScene.getGame().getSceneStack().getCurrentScene().getName(); } catch(e) {}
        
        if (currentSceneName && originSceneName && currentSceneName !== originSceneName) {
            // Cena mudou: destruir UI e parar Watcher
            const m = document.querySelector(".skin-modal");
            if (m) m.remove();
            
            if (_skinWatcherInterval) { clearInterval(_skinWatcherInterval); _skinWatcherInterval = null; }
            
            clearInterval(watcher);
        }
    }, 1000);
  } catch(e){}

})(runtimeScene);
};
gdjs.PlayonlineCode.eventsList6 = function(runtimeScene) {

{


gdjs.PlayonlineCode.userFunc0x13fed08(runtimeScene);

}


};gdjs.PlayonlineCode.userFunc0x8f4d28 = function GDJSInlineCode(runtimeScene) {
"use strict";
// SCRIPT A (MULTIPLAYER) — OTIMIZADO + AUTO-CLEANUP (Scene Watcher)
(function () {
  const UI_ID = "gdjs-mod-list-ui-final";

  if (document.getElementById(UI_ID)) {
    const existing = document.getElementById(UI_ID);
    existing.style.display = "flex";
    return;
  }

  // Captura cena de origem
  let originSceneName = "";
  try { if (typeof runtimeScene !== "undefined") originSceneName = runtimeScene.getName(); } catch(e) {}

  // --- REPO STORAGE / HELPERS ---
  const REPO_STORAGE_KEY = "gdjs_repo_list_v1";
  const ACTIVE_REPO_KEY = "gdjs_active_repo_id_v1";
  const FAVORITES_STORAGE_KEY = "gdjs_fav_songs_v1";
  const MANIFEST_CACHE_PREFIX = "gdjs_manifest_cache_";

  function defaultRepoEntry() { return { id: "official", name: "oficial (LucyYuih/gdev-custom-charts)", owner: "LucyYuih", repo: "gdev-custom-charts", branch: "main", enabled: true }; }
  function loadRepoList() { try { const raw = localStorage.getItem(REPO_STORAGE_KEY); if (!raw) { const list = [defaultRepoEntry()]; localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list)); return list; } return JSON.parse(raw); } catch (e) { const list = [defaultRepoEntry()]; localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list)); return list; } }
  function saveRepoList(list) { try { localStorage.setItem(REPO_STORAGE_KEY, JSON.stringify(list || [])); } catch(e){} }
  function getActiveRepo() { try { const id = localStorage.getItem(ACTIVE_REPO_KEY); const list = loadRepoList(); let pick = list.find(r => r.id === id && r.enabled); if (!pick) pick = list.find(r => r.enabled) || list[0]; return pick || defaultRepoEntry(); } catch(e){ return defaultRepoEntry(); } }
  function setActiveRepoById(id) { try { localStorage.setItem(ACTIVE_REPO_KEY, String(id)); } catch(e){} }
  function makeRepoId() { return "r_" + Math.random().toString(36).slice(2,10); }
  function parseRepoInput(input) { if (!input) return null; input = input.trim(); if (/manifest\.json/.test(input) || /^https?:\/\//.test(input)) { const m = input.match(/cdn\.jsdelivr\.net\/gh\/([^\/]+)\/([^@\/]+)@([^\/]+)\/.*manifest\.json/i); if (m) return { owner: m[1], repo: m[2], branch: m[3], manifestUrl: input }; return { owner: "", repo: "", branch: "", manifestUrl: input }; } const m2 = input.match(/^([^\/\s]+)\/([^@\/\s]+)(?:@(.+))?$/); if (m2) { return { owner: m2[1], repo: m2[2], branch: m2[3] || "main" }; } return null; }
  function buildManifestCdnUrl(entry) { if (!entry) return null; if (entry.manifestUrl) return entry.manifestUrl; if (entry.owner && entry.repo) return `https://cdn.jsdelivr.net/gh/${entry.owner}/${entry.repo}@${entry.branch}/manifest.json`; return null; }
  function buildManifestRawUrl(entry) { if (!entry) return null; if (entry.manifestUrl) return entry.manifestUrl; if (entry.owner && entry.repo) return `https://raw.githubusercontent.com/${entry.owner}/${entry.repo}/${entry.branch || "main"}/manifest.json`; return null; }
  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
  function isAudioFile(name){ return /\.(mp3|ogg|wav|aac|m4a)$/i.test(name); }
  function isJsonFile(name){ return /\.json$/i.test(name); }
  function basenameNoExt(p){ if(!p) return ""; const s = p.split("/").pop(); return s.replace(/\.[^.]+$/, ""); }

  // --- MANIFEST LOGIC ---
  function getBaseUrl(manifest) { if (manifest && manifest._base) return `https://cdn.jsdelivr.net/gh/${manifest._base}/`; const activeRepo = getActiveRepo(); return `https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/`; }
  function buildFileUrl(baseUrl, folderPath, filePath) { if (!filePath) return null; if (filePath.startsWith("http://") || filePath.startsWith("https://")) return filePath; if (filePath.indexOf('/') !== -1) return baseUrl + filePath.replace(/^\/+/,''); if (folderPath && folderPath !== "") return baseUrl + folderPath.replace(/^\/+|\/+$/g,'') + "/" + filePath; return baseUrl + filePath; }
  function parseManifestEntry(entry, baseUrl = "", folderPath = "") { if (!entry) return null; if (Array.isArray(entry) && entry.length > 0 && typeof entry[0] === "string") { const firstItem = entry[0]; if (firstItem.includes('.') || firstItem.includes('/')) return { type: 'files', value: entry.map(filePath => { const fileName = filePath.split('/').pop(); const url = buildFileUrl(baseUrl, folderPath, filePath); return { name: fileName, type: "file", url: url }; }) }; else return { type: 'subdirs', value: entry.slice() }; } if (typeof entry === 'object' && entry !== null && !Array.isArray(entry)) { if (entry.subdirs && entry.files) return { type: 'folder', subdirs: entry.subdirs, files: entry.files.map(filePath => { const fileName = filePath.split('/').pop(); const url = buildFileUrl(baseUrl, folderPath, filePath); return { name: fileName, type: "file", url: url }; }) }; } if (Array.isArray(entry) && entry.length > 0 && typeof entry[0] === "object") return { type: 'files', value: entry.map(item => { const name = item.n || item.name; const urlRaw = item.u || item.url || ""; let url; if (!urlRaw) url = buildFileUrl(baseUrl, folderPath, name); else if (urlRaw.startsWith("http://") || urlRaw.startsWith("https://") || urlRaw.indexOf('/') !== -1) url = urlRaw.startsWith("http") ? urlRaw : baseUrl + urlRaw.replace(/^\/+/,''); else url = buildFileUrl(baseUrl, folderPath, urlRaw); return { name: name, type: "file", url: url }; }) }; return null; }

  async function tryManifestFromGameVar(runtimeScene) { try { if (typeof runtimeScene !== "undefined" && runtimeScene.getGame) { const gg = runtimeScene.getGame().getVariables(); if (gg.has("manifestjson")) { const s = gg.get("manifestjson").getAsString(); if (s && s.trim()) { try { return JSON.parse(s); } catch(e) { return null; } } } } } catch(e){} return null; }
  async function tryManifestFromProjectResource() { try { const tries = ["manifest.json","resources/manifest.json","res/manifest.json","./manifest.json"]; for (const p of tries) { try { const r = await fetch(p, {cache:"no-cache"}); if (r.ok) { try { return await r.json(); } catch(e){} } } catch(e){} } } catch(e){} return null; }
  async function tryManifestFromCdnOf(entry) { try { const url = buildManifestCdnUrl(entry); if (!url) return null; const r = await fetch(url, {cache:"no-cache"}); if (r.ok) return await r.json(); } catch(e){} return null; }
  async function tryManifestFromRawNetwork(entry) { try { const url = buildManifestRawUrl(entry); if(!url) return null; const r = await fetch(url + "?t=" + Date.now()); if(r.ok) return await r.json(); } catch(e){} return null; }
  async function tryManifestFromGithubApiFor(entry, path="") { if (!entry || (!entry.owner || !entry.repo)) throw new Error("Invalid repo entry"); const apiUrl = `https://api.github.com/repos/${entry.owner}/${entry.repo}/contents/${encodeURIComponent(path)}?ref=${entry.branch || "main"}`; let token = ""; try { token = localStorage.getItem("gdjs_github_token") || ""; } catch(e){} const headers = token ? { "Authorization": "token " + token } : {}; const r = await fetch(apiUrl, { headers }); if (!r.ok) throw new Error(`GitHub API: ${r.status}`); const json = await r.json(); return json.map(item => ({ name: item.name, path: item.path, type: item.type, download_url: item.download_url || null })); }

  const _manifest_cache_by_repo = {};
  async function loadManifestPreferLocalFor(entry, runtimeScene) { const repoId = (entry && entry.id) ? entry.id : "__default__"; if (typeof _manifest_cache_by_repo[repoId] !== "undefined" && _manifest_cache_by_repo[repoId] !== null) return _manifest_cache_by_repo[repoId]; const storageKey = MANIFEST_CACHE_PREFIX + repoId; const fromNetwork = await tryManifestFromRawNetwork(entry); if (fromNetwork) { try { localStorage.setItem(storageKey, JSON.stringify(fromNetwork)); } catch(e) {} _manifest_cache_by_repo[repoId] = fromNetwork; return fromNetwork; } try { const localRaw = localStorage.getItem(storageKey); if (localRaw) { const parsed = JSON.parse(localRaw); if (parsed) { _manifest_cache_by_repo[repoId] = parsed; return parsed; } } } catch(e) {} const fromVar = await tryManifestFromGameVar(runtimeScene); if (fromVar) { _manifest_cache_by_repo[repoId] = fromVar; return fromVar; } const fromRes = await tryManifestFromProjectResource(); if (fromRes) { _manifest_cache_by_repo[repoId] = fromRes; return fromRes; } const fromCdn = await tryManifestFromCdnOf(entry); if (fromCdn) { _manifest_cache_by_repo[repoId] = fromCdn; return fromCdn; } _manifest_cache_by_repo[repoId] = null; return null; }
  async function ghListForFolderUsingEntry(entry, path="") { if (!entry || (!entry.owner || !entry.repo)) throw new Error("No GitHub owner/repo specified for ghList"); return await tryManifestFromGithubApiFor(entry, path); }

  // --- UI CREATION ---
  const container = document.createElement("div"); container.id = UI_ID; Object.assign(container.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", zIndex: 9999999, fontFamily: "Inter, system-ui, Arial", color: "#eee", overflow: "hidden", display: "flex", flexDirection: "column", background: "linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.95))" });
  const header = document.createElement("div"); Object.assign(header.style, { padding: "10px", display: "flex", gap: "8px", alignItems: "center", borderBottom: "1px solid rgba(255,255,255,0.04)", flex: "0 0 auto" }); header.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">Mods</div><select id="gdjs-repo-select" style="padding:6px;border-radius:6px;background:#0b0b0b;color:#eee;border:1px solid rgba(255,255,255,0.06)"></select><button id="gdjs-repo-manage" style="padding:6px;border-radius:6px">Gerenciar Repos</button><button id="gdjs-repo-refresh" style="padding:6px;border-radius:6px">Atualizar</button><button id="gdjs-repo-cache" style="padding:6px;border-radius:6px">Ver Cache</button></div><input id="gdjs-final-search" placeholder="Pesquisar mods / músicas..." style="margin-left:8px;flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b0b0b;color:#eee" /><button id="gdjs-final-close" style="margin-left:8px;padding:6px;border-radius:6px">Fechar</button>`;
  const main = document.createElement("div"); Object.assign(main.style, { display: "flex", gap: "10px", padding: "10px", flex: "1 1 auto", minHeight: 0, overflow: "hidden" });
  const leftPane = document.createElement("div"); Object.assign(leftPane.style, { width: "38%", minWidth: "260px", maxWidth: "640px", overflowY: "auto", borderRight: "1px solid rgba(255,255,255,0.03)", paddingRight: "8px" });
  const rightPane = document.createElement("div"); Object.assign(rightPane.style, { flex: "1 1 auto", overflowY: "auto", paddingLeft: "8px" });
  const footer = document.createElement("div"); Object.assign(footer.style, { padding: "10px", borderTop: "1px solid rgba(255,255,255,0.04)", display: "flex", gap: "12px", alignItems: "center", flex: "0 0 auto" }); footer.innerHTML = `<div id="gdjs-final-status" style="font-size:13px;opacity:0.9"></div><div id="gdjs-final-last" style="margin-left:auto;font-size:13px;opacity:0.85"></div>`;
  container.appendChild(header); main.appendChild(leftPane); main.appendChild(rightPane); container.appendChild(main); container.appendChild(footer); document.body.appendChild(container);

  // --- REFS ---
  const repoSelect = document.getElementById("gdjs-repo-select"); const btnManage = document.getElementById("gdjs-repo-manage"); const btnRefresh = document.getElementById("gdjs-repo-refresh"); const btnCache = document.getElementById("gdjs-repo-cache"); const btnClose = document.getElementById("gdjs-final-close"); const searchInput = document.getElementById("gdjs-final-search"); const statusEl = document.getElementById("gdjs-final-status"); const lastEl = document.getElementById("gdjs-final-last");
  function setStatus(s){ statusEl.textContent = s || ""; } function setLast(s){ lastEl.textContent = s || ""; }

  // --- STATE ---
  let currentModPath = ""; let modsList = []; let songsList = []; let modElementMap = {}; let songElementMap = {}; let favorites = loadFavorites();

  // --- FAVORITES ---
  function loadFavorites() { try { const raw = localStorage.getItem(FAVORITES_STORAGE_KEY); if (!raw) return []; return JSON.parse(raw) || []; } catch(e){ return []; } }
  function saveFavorites() { try { localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(favorites || [])); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){} }
  function isFavorite(path) { if (!path) return false; return favorites.some(f => f.path === path); }
  function addFavorite(path, name) { if (!path) return; if (isFavorite(path)) return; const entry = { path: path, name: name || basenameNoExt(path.split("/").pop()||path), repoId: getActiveRepo().id || null }; favorites.push(entry); saveFavorites(); }
  function removeFavorite(path) { if (!path) return; favorites = (favorites || []).filter(f => f.path !== path); saveFavorites(); }
  function toggleFavorite(path, name) { if (isFavorite(path)) removeFavorite(path); else addFavorite(path, name); if (songElementMap[path] && songElementMap[path].favIcon) { try { songElementMap[path].favIcon.textContent = isFavorite(path) ? "★" : "☆"; } catch(e){} } if (currentModPath === "__favorites__") openMod("__favorites__"); }

  // --- REPO UI ---
  function renderRepoSelect() { const list = loadRepoList(); repoSelect.innerHTML = ""; for (const r of list) { const opt = document.createElement("option"); opt.value = r.id; opt.textContent = (r.enabled ? "● " : "○ ") + (r.name || (r.owner? (r.owner + "/" + r.repo + (r.branch? "@" + r.branch : "")) : r.manifestUrl || "custom")); repoSelect.appendChild(opt); } const active = getActiveRepo(); setActiveRepoById(active.id); try { repoSelect.value = active.id; } catch(e){} }
  function showRepoManagerModal() { const overlay = document.createElement("div"); Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000000, display: "flex", alignItems: "center", justifyContent: "center" }); const box = document.createElement("div"); Object.assign(box.style, { width: "720px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" }); box.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">Gerenciar Repositórios</div><div style="margin-left:auto;font-size:13px;opacity:0.85">Formato: owner/repo@branch ou URL do manifest</div></div><div style="margin-top:10px" id="gdjs-repo-list-area"></div><div style="margin-top:10px;display:flex;gap:8px"><input id="gdjs-repo-input" placeholder="ex: LucyYuih/gdev-custom-charts@main" style="flex:1;padding:8px;border-radius:6px;background:#0b0b0b;color:#eee;border:1px solid rgba(255,255,255,0.06)"/><button id="gdjs-repo-add" style="padding:8px;border-radius:6px">Adicionar</button></div><div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="gdjs-repo-close" style="padding:8px;border-radius:6px">Fechar</button></div>`; overlay.appendChild(box); document.body.appendChild(overlay); const listArea = box.querySelector("#gdjs-repo-list-area"); function renderListArea() { const lst = loadRepoList(); listArea.innerHTML = ""; for (const r of lst) { const row = document.createElement("div"); Object.assign(row.style, { display: "flex", gap: "8px", alignItems: "center", padding: "6px", borderRadius: "6px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))", marginBottom: "6px" }); const label = document.createElement("div"); label.style.flex = "1"; label.innerHTML = `<div style="font-weight:600">${r.name || (r.owner? (r.owner + "/" + r.repo) : r.manifestUrl)}</div><div style="font-size:12px;opacity:0.8">${r.owner? (r.owner + "/" + r.repo + (r.branch? "@" + r.branch : "")) : r.manifestUrl}</div>`; const controls = document.createElement("div"); controls.style.display = "flex"; controls.style.gap = "6px"; const toggle = document.createElement("button"); toggle.textContent = r.enabled ? "Ativo" : "Desativar"; toggle.style.padding = "6px"; toggle.style.borderRadius = "6px"; toggle.onclick = () => { r.enabled = !r.enabled; saveRepoList(lst); renderListArea(); renderRepoSelect(); }; const setActiveBtn = document.createElement("button"); setActiveBtn.textContent = "Selecionar"; setActiveBtn.style.padding = "6px"; setActiveBtn.style.borderRadius = "6px"; setActiveBtn.onclick = () => { setActiveRepoById(r.id); renderRepoSelect(); loadFolder(""); overlay.remove(); }; const del = document.createElement("button"); del.textContent = "Excluir"; del.style.padding = "6px"; del.style.borderRadius = "6px"; del.onclick = () => { const idx = lst.findIndex(x=>x.id===r.id); if (idx>=0) { lst.splice(idx,1); saveRepoList(lst); renderListArea(); renderRepoSelect(); } }; controls.appendChild(toggle); controls.appendChild(setActiveBtn); controls.appendChild(del); row.appendChild(label); row.appendChild(controls); listArea.appendChild(row); } if ((lst||[]).length === 0) listArea.innerHTML = "<div style='opacity:0.8'>Nenhum repositório adicionado.</div>"; } renderListArea(); const input = box.querySelector("#gdjs-repo-input"); box.querySelector("#gdjs-repo-add").onclick = () => { const v = input.value.trim(); if (!v) return; const parsed = parseRepoInput(v); if (!parsed) { alert("Formato inválido"); return; } const list = loadRepoList(); const entry = { id: makeRepoId(), name: parsed.owner? (parsed.owner + "/" + parsed.repo + (parsed.branch? "@" + parsed.branch : "")) : (parsed.manifestUrl || v), owner: parsed.owner||"", repo: parsed.repo||"", branch: parsed.branch||"main", manifestUrl: parsed.manifestUrl||null, enabled: true }; list.push(entry); saveRepoList(list); input.value = ""; renderListArea(); renderRepoSelect(); }; box.querySelector("#gdjs-repo-close").onclick = () => overlay.remove(); }

  // --- CACHE MANAGER ---
  function showCacheManager() { const overlay = document.createElement("div"); Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000000, display: "flex", alignItems: "center", justifyContent: "center" }); const box = document.createElement("div"); Object.assign(box.style, { width: "760px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" }); box.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">Cache de Músicas</div><div style="margin-left:auto;font-size:13px;opacity:0.85">Gerencie músicas baixadas</div></div><div id="gdjs-cache-list" style="margin-top:10px"></div><div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end"><button id="gdjs-cache-clear" style="padding:8px;border-radius:6px">Limpar Tudo</button><button id="gdjs-cache-close" style="padding:8px;border-radius:6px">Fechar</button></div>`; overlay.appendChild(box); document.body.appendChild(overlay); const listArea = box.querySelector("#gdjs-cache-list"); function renderCache() { const keys = Object.keys(window.gdjsCustomAudio || {}); listArea.innerHTML = ""; if (!keys || keys.length === 0) { listArea.innerHTML = "<div style='opacity:0.8'>Nenhuma música em cache.</div>"; return; } for (const k of keys) { const row = document.createElement("div"); Object.assign(row.style, { display: "flex", gap: "8px", alignItems: "center", padding: "8px", borderRadius: "6px", marginBottom: "6px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" }); const label = document.createElement("div"); label.style.flex = "1"; label.innerHTML = `<div style="font-weight:600">${k}</div><div style="font-size:12px;opacity:0.8">${Object.keys((window.gdjsCustomAudio[k] && window.gdjsCustomAudio[k].audios) || {}).length} audios • ${Object.keys((window.gdjsCustomAudio[k] && window.gdjsCustomAudio[k].rawFiles) || {}).length} jsons</div>`; const btns = document.createElement("div"); btns.style.display = "flex"; btns.style.gap = "6px"; const del = document.createElement("button"); del.textContent = "Deletar"; del.style.padding = "6px"; del.style.borderRadius = "6px"; del.onclick = () => { try { const data = window.gdjsCustomAudio[k]; if (data && data.audios) Object.values(data.audios).forEach(a => { if (a.blobUrl) URL.revokeObjectURL(a.blobUrl); }); } catch(e){} delete window.gdjsCustomAudio[k]; renderCache(); }; const openBtn = document.createElement("button"); openBtn.textContent = "Abrir pasta"; openBtn.style.padding = "6px"; openBtn.style.borderRadius = "6px"; openBtn.onclick = () => { showCacheDetails(k); }; btns.appendChild(openBtn); btns.appendChild(del); row.appendChild(label); row.appendChild(btns); listArea.appendChild(row); } } function showCacheDetails(key) { const data = window.gdjsCustomAudio && window.gdjsCustomAudio[key]; const modal = document.createElement("div"); Object.assign(modal.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000001, display: "flex", alignItems: "center", justifyContent: "center" }); const b = document.createElement("div"); Object.assign(b.style, { width: "720px", maxHeight: "80vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", color: "#eee" }); b.innerHTML = `<div style="font-weight:700;margin-bottom:8px">${key}</div><div id="gdjs-cache-detail-list" style="display:flex;flex-direction:column;gap:6px"></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px"><button id="gdjs-cache-detail-close" style="padding:8px;border-radius:6px">Fechar</button></div>`; modal.appendChild(b); document.body.appendChild(modal); const listEl = b.querySelector("#gdjs-cache-detail-list"); const audios = (data && data.audios) ? Object.keys(data.audios) : []; const raws = (data && data.rawFiles) ? Object.keys(data.rawFiles) : []; if (audios.length === 0 && raws.length === 0) listEl.innerHTML = "<div style='opacity:0.8'>Vazio</div>"; for (const a of audios) { const row = document.createElement("div"); row.style.display = "flex"; row.style.justifyContent = "space-between"; row.style.alignItems = "center"; row.innerHTML = `<div>${a}</div>`; const btn = document.createElement("button"); btn.textContent = "Deletar"; btn.style.padding = "6px"; btn.style.borderRadius = "6px"; btn.onclick = () => { try { if(data.audios[a] && data.audios[a].blobUrl) URL.revokeObjectURL(data.audios[a].blobUrl); delete data.audios[a]; } catch(e){} row.remove(); }; row.appendChild(btn); listEl.appendChild(row); } for (const r of raws) { const row = document.createElement("div"); row.style.display = "flex"; row.style.justifyContent = "space-between"; row.style.alignItems = "center"; row.innerHTML = `<div>${r}</div>`; const btn = document.createElement("button"); btn.textContent = "Deletar"; btn.style.padding = "6px"; btn.style.borderRadius = "6px"; btn.onclick = () => { try { delete data.rawFiles[r]; } catch(e){} row.remove(); }; row.appendChild(btn); listEl.appendChild(row); } b.querySelector("#gdjs-cache-detail-close").onclick = () => modal.remove(); } box.querySelector("#gdjs-cache-clear").onclick = () => { if (!confirm("Deletar todo o cache de músicas?")) return; try { if (window.gdjsCustomAudio) Object.values(window.gdjsCustomAudio).forEach(folder => { if(folder.audios) Object.values(folder.audios).forEach(a => { if(a.blobUrl) URL.revokeObjectURL(a.blobUrl); }); }); } catch(e){} try { window.gdjsCustomAudio = {}; } catch(e){} renderCache(); }; box.querySelector("#gdjs-cache-close").onclick = () => overlay.remove(); renderCache(); }

  // --- LIST RENDERING ---
  function renderModsList(items) {
    leftPane.innerHTML = "";
    modElementMap = {};
    const favCount = (favorites || []).length;
    const favRow = document.createElement("div"); Object.assign(favRow.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", cursor: "pointer", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" });
    const leftFav = document.createElement("div"); leftFav.style.display = "flex"; leftFav.style.flexDirection = "column"; leftFav.innerHTML = `<div style="font-weight:600">Favorites</div><div style="font-size:12px;opacity:0.8">${favCount} músicas</div>`; favRow.appendChild(leftFav); favRow.onclick = ()=> openMod("__favorites__"); leftPane.appendChild(favRow); modElementMap["__favorites__"] = { element: favRow, data: { name: "Favorites", path: "__favorites__" } };
    if (!items || items.length === 0) { const e = document.createElement("div"); e.textContent = "Nenhum mod encontrado."; e.style.opacity = "0.8"; leftPane.appendChild(e); return; }
    for (const item of items) { const row = document.createElement("div"); Object.assign(row.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", cursor: "pointer", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))", transition: "transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease" }); row.addEventListener('mouseenter', ()=> { try { row.style.transform = "translateY(-4px) scale(1.02)"; row.style.boxShadow = "0 10px 30px rgba(0,0,0,0.45)"; row.style.background = "linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008))"; } catch(e){} }); row.addEventListener('mouseleave', ()=> { try { row.style.transform = "translateY(0) scale(1)"; row.style.boxShadow = "none"; row.style.background = "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))"; } catch(e){} }); const left = document.createElement("div"); left.style.display = "flex"; left.style.flexDirection = "column"; left.innerHTML = `<div style="font-weight:600">${item.name}</div>`; row.appendChild(left); row.onclick = ()=> openMod(item.path); leftPane.appendChild(row); modElementMap[item.path] = { element: row, data: item }; }
  }
  function renderSongsList(items) {
    rightPane.innerHTML = ""; songElementMap = {}; if (!items || items.length === 0) { const e = document.createElement("div"); e.textContent = "Selecione um mod à esquerda."; e.style.opacity = "0.8"; rightPane.appendChild(e); return; }
    for (const item of items) { const row = document.createElement("div"); Object.assign(row.style, { padding: "10px", borderRadius: "8px", display: "flex", justifyContent: "space-between", alignItems: "center", gap: "8px", marginBottom: "8px", background: "linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005))" }); const left = document.createElement("div"); left.style.display = "flex"; left.style.flexDirection = "column"; left.innerHTML = `<div style="font-weight:600">${item.name}</div>`; const right = document.createElement("div"); right.style.display = "flex"; right.style.gap = "8px"; right.style.alignItems = "center"; const favIcon = document.createElement("div"); favIcon.textContent = isFavorite(item.path) ? "★" : "☆"; Object.assign(favIcon.style, { cursor: "pointer", fontSize: "18px", userSelect: "none" }); favIcon.onclick = (ev) => { ev.stopPropagation(); toggleFavorite(item.path, item.name); }; const checkBtn = document.createElement("button"); checkBtn.textContent = "Checando..."; checkBtn.disabled = true; checkBtn.style.padding="6px"; checkBtn.style.borderRadius="6px"; right.appendChild(favIcon); right.appendChild(checkBtn); row.appendChild(left); row.appendChild(right); rightPane.appendChild(row); songElementMap[item.path] = { element: row, data: item, rightContainer: right, placeholderBtn: checkBtn, name: item.name, favIcon: favIcon }; }
    startBackgroundCheckOnSongs(items);
  }

  // --- BACKGROUND CHECK ---
  let bgController = null; const hasSubCache = {};
  function startBackgroundCheckOnSongs(items) { if (bgController && typeof bgController.abort === "function") try { bgController.abort(); } catch(e){} bgController = { aborted:false, abort(){ this.aborted=true; } }; const list = items || []; const concurrency = 3; let idx = 0; const activeRepo = getActiveRepo(); async function worker() { while(!bgController.aborted) { if (idx >= list.length) break; const p = list[idx++].path; try { if (typeof hasSubCache[p] !== "undefined") { updateButtonsForDecisionFromCache(p, hasSubCache[p]); await sleep(0); continue; } const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined); let hasSubdirs = false; if (manifest && manifest.hasOwnProperty(p)) { const baseUrl = getBaseUrl(manifest); const parsed = parseManifestEntry(manifest[p], baseUrl, p); if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs && parsed.subdirs.length > 0))) hasSubdirs = true; else hasSubdirs = false; } else { try { const api = await ghListForFolderUsingEntry(activeRepo, p).catch(()=>[]); hasSubdirs = Array.isArray(api) && api.some(x=>x.type==="dir"); } catch(e) { hasSubdirs = false; } } hasSubCache[p] = hasSubdirs; updateButtonsForDecisionFromCache(p, hasSubdirs); } catch(e){} await sleep(40); } } for (let i=0;i<concurrency;i++) worker(); }
  function updateButtonsForDecisionFromCache(path, hasSubdirs) { const el = songElementMap[path]; if (!el) return; const right = el.rightContainer; right.innerHTML = ""; const itemName = el.name || path.split("/").pop(); const favIcon = document.createElement("div"); favIcon.textContent = isFavorite(path) ? "★" : "☆"; Object.assign(favIcon.style, { cursor: "pointer", fontSize: "18px", userSelect: "none" }); favIcon.onclick = (ev) => { ev.stopPropagation(); toggleFavorite(path, itemName); }; if (hasSubdirs) { const pickBtn = document.createElement("button"); pickBtn.textContent = "Selecionar difficulty"; pickBtn.style.padding="6px"; pickBtn.style.borderRadius="6px"; pickBtn.onclick = async ()=>{ try { setStatus("Carregando difficulties de " + itemName + "..."); const activeRepo = getActiveRepo(); const subdirs = await fetchSubdirsUsingEntry(activeRepo, path); if (!subdirs || subdirs.length === 0) { setStatus("Nenhuma difficulty encontrada."); return; } showDifficultyChooser(path, subdirs); setStatus(""); } catch(e){ setStatus("Erro listando difficulties."); } }; right.appendChild(favIcon); right.appendChild(pickBtn); } else { const dlBtn = document.createElement("button"); dlBtn.textContent = "Selecionar e baixar"; dlBtn.style.padding="6px"; dlBtn.style.borderRadius="6px"; dlBtn.onclick = ()=> downloadSongFolder(path); right.appendChild(favIcon); right.appendChild(dlBtn); } if (songElementMap[path]) songElementMap[path].favIcon = favIcon; }
  async function fetchSubdirsUsingEntry(entry, folderPath) { try { const manifest = await loadManifestPreferLocalFor(entry, window.runtimeScene || undefined); if (manifest && manifest.hasOwnProperty(folderPath)) { const baseUrl = getBaseUrl(manifest); const parsed = parseManifestEntry(manifest[folderPath], baseUrl, folderPath); if (parsed && parsed.type === 'subdirs') return parsed.value.slice(); else if (parsed && parsed.type === 'folder' && parsed.subdirs) return parsed.subdirs.slice(); } } catch(e){} try { const api = await ghListForFolderUsingEntry(entry, folderPath); return (api || []).filter(i=> i.type === "dir").map(i=> i.name); } catch(e){ return []; } }
  async function loadFolder(path="") { try { setStatus("Carregando pasta..."); const activeRepo = getActiveRepo(); for (const d of (modsList||[])) delete hasSubCache[d.path]; const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined); let items = []; if (manifest && manifest.hasOwnProperty(path)) { const baseUrl = getBaseUrl(manifest); const parsed = parseManifestEntry(manifest[path], baseUrl, path); if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs))) { const subdirs = parsed.type === 'subdirs' ? parsed.value : parsed.subdirs; items = subdirs.map(name => ({ name, path: (path? path + "/" + name : name), type: "dir" })); } } else { try { const api = await ghListForFolderUsingEntry(activeRepo, path); items = (api || []).filter(it => it.type === "dir").map(it => ({ name: it.name, path: it.path, type: "dir" })); } catch(e){ items = []; } } modsList = items || []; currentModPath = ""; renderModsList(modsList); renderSongsList([]); setStatus(((path||"Mods")) + ` — ${modsList.length} mods`); setTimeout(()=> startBackgroundCheckOnSongs(modsList), 10); try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){} } catch (err) { modsList = []; renderModsList(modsList); setStatus("Erro carregando pasta."); } }
  async function openMod(path) { try { setStatus("Abrindo " + path + "..."); currentModPath = path; if (path === "__favorites__") { const items = (favorites || []).map(f => ({ name: f.name || basenameNoExt(f.path.split("/").pop()||f.path), path: f.path })); songsList = items; renderSongsList(songsList); setStatus(`Favorites — ${songsList.length} músicas`); return; } const activeRepo = getActiveRepo(); const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined); let items = []; if (manifest && manifest.hasOwnProperty(path)) { const baseUrl = getBaseUrl(manifest); const parsed = parseManifestEntry(manifest[path], baseUrl, path); if (parsed && (parsed.type === 'subdirs' || (parsed.type === 'folder' && parsed.subdirs))) { const subdirs = parsed.type === 'subdirs' ? parsed.value : parsed.subdirs; items = subdirs.map(name => ({ name, path: (path? path + "/" + name : name), type: "dir" })); } else if (parsed && parsed.type === 'files') { items = (parsed.value || []).map(f => ({ name: f.name, path: (path? path + "/" + f.name : f.name) })); } } else { try { const api = await ghListForFolderUsingEntry(activeRepo, path); items = (api || []).filter(it => it.type === "dir").map(it => ({ name: it.name, path: it.path, type: "dir" })); } catch(e){ items = []; } } songsList = items || []; renderSongsList(songsList); setStatus(`${path} — ${songsList.length} músicas`); } catch(e){ setStatus("Erro ao abrir mod."); } }

  // --- DOWNLOADERS ---
  async function getFilesFromManifest(path) { try { const activeRepo = getActiveRepo(); const manifest = await loadManifestPreferLocalFor(activeRepo, window.runtimeScene || undefined); if (!manifest || !manifest.hasOwnProperty(path)) return null; const baseUrl = getBaseUrl(manifest); const parsed = parseManifestEntry(manifest[path], baseUrl, path); if (!parsed) return null; if (parsed.type === 'files') return parsed.value; else if (parsed.type === 'folder' && parsed.files) return parsed.files; return null; } catch(e){} return null; }
  function stopAndCleanupPrevious(options){ options = options || {}; const revokeBlobUrls = options.revokeBlobUrls === true; try { if (window.gdjsChannels) Object.keys(window.gdjsChannels).forEach(k=>{ try { const a = window.gdjsChannels[k]; if (a) { try { a.pause(); a.currentTime = 0; } catch(e){} if (a._gdjs_ended_handler) { try { a.removeEventListener('ended', a._gdjs_ended_handler); } catch(e){} a._gdjs_ended_handler = null; } if (revokeBlobUrls && a.src && a.src.startsWith('blob:')) URL.revokeObjectURL(a.src); } } catch(e){} }); if (window.gdjsCustomAudio) Object.keys(window.gdjsCustomAudio).forEach(folder=>{ try { const entry = window.gdjsCustomAudio[folder] || {}; Object.keys(entry.audios||{}).forEach(name=>{ try { const info = entry.audios[name]; if (info && info.blobUrl && revokeBlobUrls) URL.revokeObjectURL(info.blobUrl); } catch(e){} }); try { delete window.gdjsCustomAudio[folder]; } catch(e){} } catch(e){} }); window.gdjsChannels = {}; } catch(e){} }
  async function findAudioFilesWithFallback(rootFolder, difficultyPath) { const activeRepo = getActiveRepo(); async function audioListFromManifestPathLocal(p) { try { const files = await getFilesFromManifest(p); if (!files) return []; return files.filter(e => isAudioFile(e.name)).map(e => ({ name: e.name, url: e.url })); } catch(e){} return []; } async function audioListFromGithubPath(p) { try { const api = await ghListForFolderUsingEntry(activeRepo, p).catch(()=>[]); return (api || []).filter(i => i.type !== "dir" && isAudioFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){} return []; } try { let list = await audioListFromManifestPathLocal(difficultyPath); if (list && list.length>0) return list; list = await audioListFromGithubPath(difficultyPath); if (list && list.length>0) return list; } catch(e){} try { let list = await audioListFromManifestPathLocal(rootFolder); if (list && list.length>0) return list; list = await audioListFromGithubPath(rootFolder); if (list && list.length>0) return list; } catch(e){} try { const parts = (rootFolder || "").split("/").filter(Boolean); if (parts.length >= 2) { const modFolder = parts.slice(0, parts.length - 1).join("/"); if (modFolder) { let list = await audioListFromManifestPathLocal(modFolder); if (list && list.length>0) return list; list = await audioListFromGithubPath(modFolder); if (list && list.length>0) return list; } } } catch(e){} return []; }

  async function downloadDifficultyKeepAudioRoot(rootFolder, difficultyName) { const difficultyPath = (rootFolder? rootFolder + "/" + difficultyName : difficultyName); try { btnClose.disabled = true; } catch(e){} try { stopAndCleanupPrevious({ revokeBlobUrls: true }); try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("selectedTrackKey").setString(rootFolder); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongName").setString(basenameNoExt(rootFolder.split("/").pop()||rootFolder)); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongDifficulty").setString(difficultyName); } catch(e){} setStatus("Listando arquivos..."); const audioFiles = await findAudioFilesWithFallback(rootFolder, difficultyPath); let chartFiles = []; const activeRepo = getActiveRepo(); const files = await getFilesFromManifest(difficultyPath); if (files) chartFiles = files.filter(e => isJsonFile(e.name)).map(e => ({ name: e.name, url: e.url }) ); else try { const api = await ghListForFolderUsingEntry(activeRepo, difficultyPath); chartFiles = (api || []).filter(i => i.type !== "dir" && isJsonFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){} let rootJsons = []; const rootFiles = await getFilesFromManifest(rootFolder); if (rootFiles) rootJsons = rootFiles.filter(e => isJsonFile(e.name)).map(e => ({ name: e.name, url: e.url }) ); else try { const api = await ghListForFolderUsingEntry(activeRepo, rootFolder); rootJsons = (api || []).filter(i => i.type !== "dir" && isJsonFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){} const allJsonsMap = {}; rootJsons.forEach(j => { allJsonsMap[j.name] = j; }); chartFiles.forEach(j => { allJsonsMap[j.name] = j; }); window.gdjsCustomAudio = window.gdjsCustomAudio || {}; window.gdjsCustomAudio[rootFolder] = window.gdjsCustomAudio[rootFolder] || { audios: {}, rawFiles: {} }; const dest = window.gdjsCustomAudio[rootFolder]; let nextChannelIndex = 0; const unlockQueue = []; for (const f of (audioFiles || [])) { try { setStatus("Baixando áudio: " + f.name + "..."); const resp = await fetch(f.url); if (!resp.ok) continue; const blob = await resp.blob(); const blobUrl = URL.createObjectURL(blob); const audioEl = new Audio(blobUrl); audioEl.preload = "auto"; audioEl.crossOrigin = "anonymous"; audioEl.loop = false; dest.audios[f.name] = { blobUrl, audioEl }; window.gdjsChannels[nextChannelIndex] = audioEl; nextChannelIndex++; try { const p = audioEl.play(); if (p && typeof p.then === "function") p.then(()=>{ try{ audioEl.pause(); audioEl.currentTime = 0; }catch(e){} }).catch(()=>{ unlockQueue.push({audioEl, name: f.name}); }); else try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} } catch(e){ unlockQueue.push({audioEl, name: f.name}); } } catch(e){} await sleep(0); } for (const name in allJsonsMap) { try { const j = allJsonsMap[name]; setStatus("Baixando chart: " + name + "..."); const r = await fetch(j.url); if (!r.ok) continue; const txt = await r.text(); const key = difficultyName + "/" + name; dest.rawFiles[key] = txt; const lname = name.toLowerCase(); const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg) { if (/metadata|meta/.test(lname)) gg.get("metadatajson").setString(txt); else if (/(bf|chartbf|chart_bf)/.test(lname)) gg.get("BfChartJsonLoader").setString(txt); else if (/(dad|opp|opponent)/.test(lname)) gg.get("OppChartJsonLoader").setString(txt); else { try { const parsed = JSON.parse(txt); if (parsed && parsed.notes) { if (!gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt); else if (!gg.get("OppChartJsonLoader").getAsString()) gg.get("OppChartJsonLoader").setString(txt); else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } catch(e){ if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } } } } catch(e){} await sleep(0); } if (unlockQueue.length > 0) { const unlock = async () => { for (const it of unlockQueue) { try { await it.audioEl.play(); it.audioEl.pause(); it.audioEl.currentTime = 0; } catch(e){} } window.removeEventListener('pointerdown', unlock); }; window.addEventListener('pointerdown', unlock, { once: true }); } setStatus('Download concluído.'); } catch(e){ setStatus("Erro ao baixar: " + e); } finally { try { btnClose.disabled = false; } catch(e){} } }
  async function downloadAllDifficulties(rootFolder, subdirs) { try { btnClose.disabled = true; } catch(e){} try { stopAndCleanupPrevious({ revokeBlobUrls: true }); try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("selectedTrackKey").setString(rootFolder); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongName").setString(basenameNoExt(rootFolder.split("/").pop()||rootFolder)); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongDifficulty").setString(difficultyName); } catch(e){} setStatus("Procurando áudios..."); const hintDifficulty = (subdirs && subdirs.length>0) ? (rootFolder + "/" + subdirs[0]) : rootFolder; const audioFiles = await findAudioFilesWithFallback(rootFolder, hintDifficulty); window.gdjsCustomAudio = window.gdjsCustomAudio || {}; window.gdjsCustomAudio[rootFolder] = window.gdjsCustomAudio[rootFolder] || { audios: {}, rawFiles: {} }; const dest = window.gdjsCustomAudio[rootFolder]; let nextChannelIndex = 0; const unlockQueue = []; for (const f of (audioFiles || [])) { try { setStatus("Baixando áudio: " + f.name + "..."); const resp = await fetch(f.url); if (!resp.ok) continue; const blob = await resp.blob(); const blobUrl = URL.createObjectURL(blob); const audioEl = new Audio(blobUrl); audioEl.preload = "auto"; audioEl.crossOrigin = "anonymous"; audioEl.loop = false; dest.audios[f.name] = { blobUrl, audioEl }; window.gdjsChannels[nextChannelIndex] = audioEl; nextChannelIndex++; try { const p = audioEl.play(); if (p && typeof p.then === "function") p.then(()=>{ try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} }).catch(()=>{ unlockQueue.push({audioEl, name: f.name}); }); else try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} } catch(e){ unlockQueue.push({audioEl, name: f.name}); } } catch(e){} await sleep(0); } const activeRepo = getActiveRepo(); for (const d of subdirs) { try { setStatus("Baixando charts: " + d + " ..."); let chartFiles = []; const difficultyPath = (rootFolder? rootFolder + "/" + d : d); const files = await getFilesFromManifest(difficultyPath); if (files) chartFiles = files.filter(e => isJsonFile(e.name)).map(e => ({ name: e.name, url: e.url }) ); else try { const api = await ghListForFolderUsingEntry(activeRepo, difficultyPath); chartFiles = (api || []).filter(i => i.type !== "dir" && isJsonFile(i.name)).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`) })); } catch(e){} for (const j of chartFiles) { try { const r = await fetch(j.url); if (!r.ok) continue; const txt = await r.text(); const key = d + "/" + j.name; dest.rawFiles[key] = txt; const lname = j.name.toLowerCase(); const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg) { if (/metadata|meta/.test(lname)) gg.get("metadatajson").setString(txt); else if (/(bf|chartbf|chart_bf)/.test(lname)) gg.get("BfChartJsonLoader").setString(txt); else if (/(dad|opp|opponent)/.test(lname)) gg.get("OppChartJsonLoader").setString(txt); else { try { const parsed = JSON.parse(txt); if (parsed && parsed.notes) { if (!gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt); else if (!gg.get("OppChartJsonLoader").getAsString()) gg.get("OppChartJsonLoader").setString(txt); else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } catch(e){ if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } } } } catch(e){} await sleep(0); } } catch(e){} } if (unlockQueue.length > 0) { const unlock = async () => { for (const it of unlockQueue) { try { await it.audioEl.play(); it.audioEl.pause(); it.audioEl.currentTime = 0; } catch(e){} } window.removeEventListener('pointerdown', unlock); }; window.addEventListener('pointerdown', unlock, { once: true }); } setStatus('Download concluído.'); } catch(e){ setStatus("Erro ao baixar: " + e); } finally { try { btnClose.disabled = false; } catch(e){} } }
  async function downloadSongFolder(folderPath) { try { btnClose.disabled = true; } catch(e){} try { stopAndCleanupPrevious({ revokeBlobUrls: true }); setStatus("Listando arquivos..."); let files = await getFilesFromManifest(folderPath); if (!files) { const activeRepo = getActiveRepo(); try { const apiList = await ghListForFolderUsingEntry(activeRepo, folderPath); files = (apiList || []).map(i => ({ name: i.name, url: i.download_url || (`https://cdn.jsdelivr.net/gh/${activeRepo.owner}/${activeRepo.repo}@${activeRepo.branch}/${i.path}`), type: i.type })); files = files.filter(x => x.type !== "dir"); } catch(e){ files = []; } } if (!Array.isArray(files) || files.length === 0) { setStatus("Pasta vazia."); return; } window.gdjsCustomAudio = window.gdjsCustomAudio || {}; window.gdjsCustomAudio[folderPath] = window.gdjsCustomAudio[folderPath] || {audios:{}, rawFiles:{}}; const dest = window.gdjsCustomAudio[folderPath]; try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("selectedTrackKey").setString(folderPath); } catch(e){} try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("SongName").setString(basenameNoExt(folderPath.split("/").pop()||folderPath)); } catch(e){} let nextChannelIndex = (window.gdjsChannels) ? Object.keys(window.gdjsChannels).length : 0; const unlockQueue = []; for (const f of files) { const fname = f.name; const url = f.url; if (!url) continue; if (isJsonFile(fname)) { try { const txtResp = await fetch(url); if (txtResp.ok) { const txt = await txtResp.text(); dest.rawFiles[fname] = txt; const lname = fname.toLowerCase(); const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg) { if (/metadata|meta/.test(lname)) gg.get("metadatajson").setString(txt); else if (/(bf|chartbf|chart_bf)/.test(lname)) gg.get("BfChartJsonLoader").setString(txt); else if (/(dad|opp|opponent)/.test(lname)) gg.get("OppChartJsonLoader").setString(txt); else { try { const parsed = JSON.parse(txt); if (parsed && parsed.notes) { if (!gg.get("BfChartJsonLoader").getAsString()) gg.get("BfChartJsonLoader").setString(txt); else if (!gg.get("OppChartJsonLoader").getAsString()) gg.get("OppChartJsonLoader").setString(txt); else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } else if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } catch(e) { if (!gg.get("metadatajson").getAsString()) gg.get("metadatajson").setString(txt); } } } } } catch(e){} } else if (isAudioFile(fname)) { try { setStatus("Baixando áudio: " + fname + "..."); const resp = await fetch(url); if (!resp.ok) continue; const blob = await resp.blob(); const blobUrl = URL.createObjectURL(blob); const audioEl = new Audio(blobUrl); audioEl.preload = "auto"; audioEl.crossOrigin = "anonymous"; audioEl.loop = false; dest.audios[fname] = { blobUrl, audioEl, audioElRef: audioEl }; window.gdjsChannels = window.gdjsChannels || {}; window.gdjsChannels[nextChannelIndex] = audioEl; nextChannelIndex++; try { const p = audioEl.play(); if (p && typeof p.then === "function") p.then(()=>{ try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} }).catch(()=>{ unlockQueue.push({audioEl, name: fname}); }); else try{ audioEl.pause(); audioEl.currentTime = 0; } catch(e){} } catch(e){ unlockQueue.push({audioEl, name: fname}); } try { const gg = (window.runtimeScene && window.runtimeScene.getGame) ? runtimeScene.getGame().getVariables() : null; if (gg && !gg.get("SongName").getAsString()) gg.get("SongName").setString(basenameNoExt(fname)); } catch(e){} } catch(e){} } await sleep(0); } if (unlockQueue.length > 0) { const unlock = async () => { for (const it of unlockQueue) { try { await it.audioEl.play(); it.audioEl.pause(); it.audioEl.currentTime = 0; } catch(e){} } window.removeEventListener('pointerdown', unlock); }; window.addEventListener('pointerdown', unlock, { once: true }); } setStatus('Download concluído.'); } catch(e){ setStatus("Erro ao baixar: " + e); } finally { try { btnClose.disabled = false; } catch(e){} } }
  function showDifficultyChooser(rootFolder, subdirs) { const overlay = document.createElement("div"); Object.assign(overlay.style, { position: "fixed", left: "0", top: "0", right: "0", bottom: "0", background: "rgba(0,0,0,0.6)", zIndex: 10000010, display: "flex", alignItems: "center", justifyContent: "center", pointerEvents: "auto" }); const box = document.createElement("div"); Object.assign(box.style, { width: "420px", maxHeight: "70vh", overflowY: "auto", background: "#0f0f10", borderRadius: "8px", padding: "12px", boxShadow: "0 12px 40px rgba(0,0,0,0.6)", color: "#eee" }); box.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Escolha uma difficulty para:</div><div style="margin-bottom:8px;color:#bbb">${rootFolder}</div>`; const list = document.createElement("div"); list.style.display = "flex"; list.style.flexDirection = "column"; list.style.gap = "6px"; for (const d of subdirs) { const b = document.createElement("button"); b.textContent = d; b.style.padding="8px"; b.style.borderRadius="6px"; b.onclick = ()=> { overlay.remove(); downloadDifficultyKeepAudioRoot(rootFolder, d); }; list.appendChild(b); } const cancel = document.createElement("button"); cancel.textContent = "Cancelar"; cancel.style.marginTop="10px"; cancel.style.padding="8px"; cancel.style.borderRadius="6px"; cancel.onclick = ()=> overlay.remove(); box.appendChild(list); box.appendChild(cancel); overlay.appendChild(box); document.body.appendChild(overlay); setTimeout(()=> { try { overlay.focus(); } catch(e){} }, 0); }

  btnClose.onclick = ()=> container.remove(); btnManage.onclick = ()=> showRepoManagerModal(); btnCache.onclick = ()=> showCacheManager();
  btnRefresh.onclick = async ()=> { try { setStatus("Atualizando..."); } catch(e){} try { for (const it of modsList) delete hasSubCache[it.path]; } catch(e){} try { Object.keys(_manifest_cache_by_repo).forEach(k=> delete _manifest_cache_by_repo[k]); } catch(e){} try { const active = getActiveRepo(); if(active && active.id) localStorage.removeItem(MANIFEST_CACHE_PREFIX + active.id); } catch(e){} const prevOpen = currentModPath; await loadFolder(""); try { if (prevOpen && prevOpen === "__favorites__") openMod("__favorites__"); else if (prevOpen) setTimeout(()=>{ try { const found = modsList.find(m => m.path === prevOpen); if (found) openMod(prevOpen); } catch(e){} }, 60); } catch(e){} };
  repoSelect.onchange = ()=> { try { setActiveRepoById(repoSelect.value); } catch(e){} try { Object.keys(_manifest_cache_by_repo).forEach(k=> delete _manifest_cache_by_repo[k]); } catch(e){} const prevOpen = currentModPath; loadFolder("").then(()=>{ try { if (prevOpen && prevOpen === "__favorites__") openMod("__favorites__"); else if (prevOpen) { const found = modsList.find(m => m.path === prevOpen); if (found) openMod(prevOpen); } } catch(e){} }).catch(()=>{}); };
  searchInput.addEventListener("input", ()=> { const q = searchInput.value.trim().toLowerCase(); if (!q) { renderModsList(modsList); setStatus((currentModPath||"Mods")+` — ${modsList.length}`); if (currentModPath) { if (currentModPath === "__favorites__") openMod("__favorites__"); else openMod(currentModPath); } else { renderSongsList([]); } setTimeout(()=> startBackgroundCheckOnSongs(modsList), 10); return; } const filteredMods = modsList.filter(it => (it.name || "").toLowerCase().includes(q)); renderModsList(filteredMods); if (currentModPath === "__favorites__") { const favItems = (favorites || []).map(f => ({ name: f.name || basenameNoExt(f.path.split("/").pop()||f.path), path: f.path })); const filteredSongs = favItems.filter(s => (s.name || "").toLowerCase().includes(q)); renderSongsList(filteredSongs); setStatus(`Resultado: ${filteredSongs.length} / ${favItems.length} (favorites)`); } else if (currentModPath) { const filteredSongs = (songsList || []).filter(s => (s.name || "").toLowerCase().includes(q)); renderSongsList(filteredSongs); setStatus(`Resultado: ${filteredSongs.length} / ${songsList.length}`); setTimeout(()=> startBackgroundCheckOnSongs(filteredSongs), 10); } else { setStatus(`Resultado: ${filteredMods.length} / ${modsList.length}`); } });

  (function init() {
    const list = loadRepoList();
    if (!list || list.length === 0) { saveRepoList([defaultRepoEntry()]); }
    renderRepoSelect();
    loadFolder("");
    try { if (typeof runtimeScene !== "undefined") window.runtimeScene = runtimeScene; } catch(e){}
    try { if (window.runtimeScene && window.runtimeScene.getGame) runtimeScene.getGame().getVariables().get("FavoriteSongs").setString(JSON.stringify(favorites || [])); } catch(e){}
    
    // --- AUTO CLEANUP ---
    const watcher = setInterval(() => {
        let currentSceneName = "";
        try { currentSceneName = runtimeScene.getGame().getSceneStack().getCurrentScene().getName(); } catch(e) {}
        if (!document.getElementById(UI_ID)) {
            clearInterval(watcher);
        } else if (currentSceneName && originSceneName && currentSceneName !== originSceneName) {
            try { document.getElementById(UI_ID).remove(); } catch(e){}
            clearInterval(watcher);
        }
    }, 1000);
  })();
})();
};
gdjs.PlayonlineCode.eventsList7 = function(runtimeScene) {

{


gdjs.PlayonlineCode.userFunc0x8f4d28(runtimeScene);

}


};gdjs.PlayonlineCode.mapOfGDgdjs_9546PlayonlineCode_9546GDStartObjects1Objects = Hashtable.newFrom({"Start": gdjs.PlayonlineCode.GDStartObjects1});
gdjs.PlayonlineCode.eventsList8 = function(runtimeScene) {

{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
if (isConditionTrue_0) {
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(28));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(29));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(30));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(31));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(32));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(33));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(34));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(35));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(26));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(60));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(58));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(89).getChild("BestScore"));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(89).getChild("SongsBestScore"));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(89).getChild("Points"));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(89).getChild("PointsMessage"));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(89).getChild("Pfcs"));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(62).getChild(4));
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(58));
}
{gdjs.evtTools.runtimeScene.prioritizeLoadingOfScene(runtimeScene, "Play");
}
{runtimeScene.getGame().getVariables().getFromIndex(10).setNumber(1);
}
{gdjs.multiplayerVariablesManager.disableVariableSynchronization(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(15));
}
{gdjs.multiplayerVariablesManager.setPlayerVariableOwnership(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(8), 2);
}
{gdjs.multiplayerVariablesManager.setPlayerVariableOwnership(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(9), 2);
}
{gdjs.multiplayerVariablesManager.setPlayerVariableOwnership(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(6), 1);
}
{gdjs.multiplayerVariablesManager.setPlayerVariableOwnership(runtimeScene, runtimeScene.getGame().getVariables().getFromIndex(7), 1);
}

{ //Subevents
gdjs.PlayonlineCode.eventsList1(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Join"), gdjs.PlayonlineCode.GDJoinObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDJoinObjects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDJoinObjects1[i].IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDJoinObjects1[k] = gdjs.PlayonlineCode.GDJoinObjects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDJoinObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40848300);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.PlayonlineCode.eventsList2(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Join2"), gdjs.PlayonlineCode.GDJoin2Objects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDJoin2Objects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDJoin2Objects1[i].IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDJoin2Objects1[k] = gdjs.PlayonlineCode.GDJoin2Objects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDJoin2Objects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40850764);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.PlayonlineCode.eventsList3(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isLobbyGameRunning();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isPlayerConnected(2);
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40843596);
}
}
}
if (isConditionTrue_0) {
gdjs.copyArray(runtimeScene.getObjects("Player1text"), gdjs.PlayonlineCode.GDPlayer1textObjects1);
gdjs.copyArray(runtimeScene.getObjects("Player2text"), gdjs.PlayonlineCode.GDPlayer2textObjects1);
{for(var i = 0, len = gdjs.PlayonlineCode.GDPlayer1textObjects1.length ;i < len;++i) {
    gdjs.PlayonlineCode.GDPlayer1textObjects1[i].getBehavior("Text").setText(gdjs.multiplayer.getPlayerUsername(1) + gdjs.evtTools.string.newLine() + "v");
}
}
{for(var i = 0, len = gdjs.PlayonlineCode.GDPlayer2textObjects1.length ;i < len;++i) {
    gdjs.PlayonlineCode.GDPlayer2textObjects1[i].getBehavior("Text").setText(gdjs.multiplayer.getPlayerUsername(2) + gdjs.evtTools.string.newLine() + "v");
}
}

{ //Subevents
gdjs.PlayonlineCode.eventsList4(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
{
{runtimeScene.getGame().getVariables().getFromIndex(9).setString(runtimeScene.getGame().getVariables().getFromIndex(8).getAsString());
}
{runtimeScene.getGame().getVariables().getFromIndex(7).setString(runtimeScene.getGame().getVariables().getFromIndex(6).getAsString());
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isLobbyGameRunning();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isPlayerConnected(2);
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isCurrentPlayerHost();
}
}
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(17).setNumber(1);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isLobbyGameRunning();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isPlayerConnected(2);
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.multiplayer.isCurrentPlayerHost());
}
}
if (isConditionTrue_0) {
{runtimeScene.getGame().getVariables().getFromIndex(17).setNumber(2);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
if (isConditionTrue_0) {

{ //Subevents
gdjs.PlayonlineCode.eventsList5(runtimeScene);} //End of subevents
}

}


{

gdjs.copyArray(runtimeScene.getObjects("Hard"), gdjs.PlayonlineCode.GDHardObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDHardObjects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDHardObjects1[i].getBehavior("MultitouchButton").IsJustPressed(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDHardObjects1[k] = gdjs.PlayonlineCode.GDHardObjects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDHardObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40859588);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.PlayonlineCode.eventsList6(runtimeScene);} //End of subevents
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isLobbyGameRunning();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = !(gdjs.multiplayer.isPlayerConnected(2));
}
if (isConditionTrue_0) {
{gdjs.multiplayer.endLobbyGame();
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("selesongtext"), gdjs.PlayonlineCode.GDselesongtextObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDselesongtextObjects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDselesongtextObjects1[i].getBehavior("ButtonFSM").IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDselesongtextObjects1[k] = gdjs.PlayonlineCode.GDselesongtextObjects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDselesongtextObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40861724);
}
}
if (isConditionTrue_0) {

{ //Subevents
gdjs.PlayonlineCode.eventsList7(runtimeScene);} //End of subevents
}

}


{



}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayer.isCurrentPlayerHost();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = runtimeScene.getOnceTriggers().triggerOnce(40863484);
}
}
if (isConditionTrue_0) {
gdjs.PlayonlineCode.GDStartObjects1.length = 0;

{gdjs.evtTools.object.createObjectOnScene(runtimeScene, gdjs.PlayonlineCode.mapOfGDgdjs_9546PlayonlineCode_9546GDStartObjects1Objects, 3058, 651, "");
}
}

}


{


let isConditionTrue_0 = false;
{
gdjs.copyArray(runtimeScene.getObjects("songselectedtext"), gdjs.PlayonlineCode.GDsongselectedtextObjects1);
{for(var i = 0, len = gdjs.PlayonlineCode.GDsongselectedtextObjects1.length ;i < len;++i) {
    gdjs.PlayonlineCode.GDsongselectedtextObjects1[i].getBehavior("Text").setText("Song Selected: " + runtimeScene.getGame().getVariables().getFromIndex(5).getAsString());
}
}
}

}


{



}


{

gdjs.copyArray(runtimeScene.getObjects("Start"), gdjs.PlayonlineCode.GDStartObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDStartObjects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDStartObjects1[i].IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDStartObjects1[k] = gdjs.PlayonlineCode.GDStartObjects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDStartObjects1.length = k;
if (isConditionTrue_0) {
isConditionTrue_0 = false;
{isConditionTrue_0 = (runtimeScene.getGame().getVariables().getFromIndex(5).getAsString() != "None");
}
}
if (isConditionTrue_0) {
{gdjs.evtTools.runtimeScene.replaceScene(runtimeScene, "Play", false);
}
}

}


{


let isConditionTrue_0 = false;
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.multiplayerMessageManager.hasAnyPlayerJustLeft();
if (isConditionTrue_0) {
isConditionTrue_0 = false;
isConditionTrue_0 = gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) == 2220 + 960;
}
if (isConditionTrue_0) {
{gdjs.evtTools.camera.setCameraX(runtimeScene, 960, "", 0);
}
}

}


{

gdjs.copyArray(runtimeScene.getObjects("PauseButton"), gdjs.PlayonlineCode.GDPauseButtonObjects1);

let isConditionTrue_0 = false;
isConditionTrue_0 = false;
for (var i = 0, k = 0, l = gdjs.PlayonlineCode.GDPauseButtonObjects1.length;i<l;++i) {
    if ( gdjs.PlayonlineCode.GDPauseButtonObjects1[i].getBehavior("ButtonFSM").IsClicked(null) ) {
        isConditionTrue_0 = true;
        gdjs.PlayonlineCode.GDPauseButtonObjects1[k] = gdjs.PlayonlineCode.GDPauseButtonObjects1[i];
        ++k;
    }
}
gdjs.PlayonlineCode.GDPauseButtonObjects1.length = k;
if (isConditionTrue_0) {
{gdjs.evtTools.runtimeScene.replaceScene(runtimeScene, "Inicio", false);
}
}

}


};

gdjs.PlayonlineCode.func = function(runtimeScene) {
runtimeScene.getOnceTriggers().startNewFrame();

gdjs.PlayonlineCode.GDJoinObjects1.length = 0;
gdjs.PlayonlineCode.GDJoinObjects2.length = 0;
gdjs.PlayonlineCode.GDJoinObjects3.length = 0;
gdjs.PlayonlineCode.GDbackObjects1.length = 0;
gdjs.PlayonlineCode.GDbackObjects2.length = 0;
gdjs.PlayonlineCode.GDbackObjects3.length = 0;
gdjs.PlayonlineCode.GDBFObjects1.length = 0;
gdjs.PlayonlineCode.GDBFObjects2.length = 0;
gdjs.PlayonlineCode.GDBFObjects3.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects1.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects2.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects3.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects1.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects2.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects3.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects1.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects2.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects3.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects1.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects2.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects3.length = 0;
gdjs.PlayonlineCode.GDStartObjects1.length = 0;
gdjs.PlayonlineCode.GDStartObjects2.length = 0;
gdjs.PlayonlineCode.GDStartObjects3.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects1.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects2.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects3.length = 0;
gdjs.PlayonlineCode.GDHardObjects1.length = 0;
gdjs.PlayonlineCode.GDHardObjects2.length = 0;
gdjs.PlayonlineCode.GDHardObjects3.length = 0;
gdjs.PlayonlineCode.GDBackObjects1.length = 0;
gdjs.PlayonlineCode.GDBackObjects2.length = 0;
gdjs.PlayonlineCode.GDBackObjects3.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects1.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects2.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects3.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects1.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects2.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects3.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects1.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects2.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects3.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects1.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects2.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects3.length = 0;
gdjs.PlayonlineCode.GDfpsObjects1.length = 0;
gdjs.PlayonlineCode.GDfpsObjects2.length = 0;
gdjs.PlayonlineCode.GDfpsObjects3.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects1.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects2.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects3.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects1.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects2.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects3.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects1.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects2.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects3.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects1.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects2.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects3.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects1.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects2.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects1.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects2.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects1.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects2.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects3.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects1.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects2.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects1.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects2.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects3.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects1.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects2.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects3.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects1.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects2.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects3.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects1.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects2.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects3.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects1.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects2.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects3.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects1.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects2.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects3.length = 0;
gdjs.PlayonlineCode.GDtimeObjects1.length = 0;
gdjs.PlayonlineCode.GDtimeObjects2.length = 0;
gdjs.PlayonlineCode.GDtimeObjects3.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects1.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects2.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects3.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects1.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects2.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects3.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDnotesObjects1.length = 0;
gdjs.PlayonlineCode.GDnotesObjects2.length = 0;
gdjs.PlayonlineCode.GDnotesObjects3.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects1.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects2.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects3.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects1.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects2.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects3.length = 0;

gdjs.PlayonlineCode.eventsList8(runtimeScene);
gdjs.PlayonlineCode.GDJoinObjects1.length = 0;
gdjs.PlayonlineCode.GDJoinObjects2.length = 0;
gdjs.PlayonlineCode.GDJoinObjects3.length = 0;
gdjs.PlayonlineCode.GDbackObjects1.length = 0;
gdjs.PlayonlineCode.GDbackObjects2.length = 0;
gdjs.PlayonlineCode.GDbackObjects3.length = 0;
gdjs.PlayonlineCode.GDBFObjects1.length = 0;
gdjs.PlayonlineCode.GDBFObjects2.length = 0;
gdjs.PlayonlineCode.GDBFObjects3.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects1.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects2.length = 0;
gdjs.PlayonlineCode.GDPlayer2textObjects3.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects1.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects2.length = 0;
gdjs.PlayonlineCode.GDPlayer1textObjects3.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects1.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects2.length = 0;
gdjs.PlayonlineCode.GDselesongtextObjects3.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects1.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects2.length = 0;
gdjs.PlayonlineCode.GDsongselectedtextObjects3.length = 0;
gdjs.PlayonlineCode.GDStartObjects1.length = 0;
gdjs.PlayonlineCode.GDStartObjects2.length = 0;
gdjs.PlayonlineCode.GDStartObjects3.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects1.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects2.length = 0;
gdjs.PlayonlineCode.GDBFPixelObjects3.length = 0;
gdjs.PlayonlineCode.GDHardObjects1.length = 0;
gdjs.PlayonlineCode.GDHardObjects2.length = 0;
gdjs.PlayonlineCode.GDHardObjects3.length = 0;
gdjs.PlayonlineCode.GDBackObjects1.length = 0;
gdjs.PlayonlineCode.GDBackObjects2.length = 0;
gdjs.PlayonlineCode.GDBackObjects3.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects1.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects2.length = 0;
gdjs.PlayonlineCode.GDJoin2Objects3.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects1.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects2.length = 0;
gdjs.PlayonlineCode.GDStatisticsObjects3.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects1.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects2.length = 0;
gdjs.PlayonlineCode.GDComboNumbersObjects3.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects1.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects2.length = 0;
gdjs.PlayonlineCode.GDNotesSplashObjects3.length = 0;
gdjs.PlayonlineCode.GDfpsObjects1.length = 0;
gdjs.PlayonlineCode.GDfpsObjects2.length = 0;
gdjs.PlayonlineCode.GDfpsObjects3.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects1.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects2.length = 0;
gdjs.PlayonlineCode.GDEngineTextObjects3.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects1.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects2.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollBFObjects3.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects1.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects2.length = 0;
gdjs.PlayonlineCode.GDLongUpscrollOPPObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxLeftObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxDownObjects3.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects1.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects2.length = 0;
gdjs.PlayonlineCode.GDHitboxUpObjects3.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects1.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects2.length = 0;
gdjs.PlayonlineCode.GDhitrightObjects3.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects1.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects2.length = 0;
gdjs.PlayonlineCode.GDBFIconObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects1.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects2.length = 0;
gdjs.PlayonlineCode.GDPauseButtonObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects1.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects2.length = 0;
gdjs.PlayonlineCode.GDPauseButton2Objects3.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects1.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects2.length = 0;
gdjs.PlayonlineCode.GDBlackScreenObjects3.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects1.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects2.length = 0;
gdjs.PlayonlineCode.GDPauseTextObjects3.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects1.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects2.length = 0;
gdjs.PlayonlineCode.GDExitTextObjects3.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects1.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects2.length = 0;
gdjs.PlayonlineCode.GDRestartTextObjects3.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects1.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects2.length = 0;
gdjs.PlayonlineCode.GDmisses_9595challenge_9595textObjects3.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfUpNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfDownNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfLeftNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDBfRightNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects1.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects2.length = 0;
gdjs.PlayonlineCode.GDOppIconObjects3.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects1.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects2.length = 0;
gdjs.PlayonlineCode.GDtimerBarObjects3.length = 0;
gdjs.PlayonlineCode.GDtimeObjects1.length = 0;
gdjs.PlayonlineCode.GDtimeObjects2.length = 0;
gdjs.PlayonlineCode.GDtimeObjects3.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects1.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects2.length = 0;
gdjs.PlayonlineCode.GDtimerBar2Objects3.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects1.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects2.length = 0;
gdjs.PlayonlineCode.GDRatinsPopUpObjects3.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDLongNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDnotesObjects1.length = 0;
gdjs.PlayonlineCode.GDnotesObjects2.length = 0;
gdjs.PlayonlineCode.GDnotesObjects3.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppLeftNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppDownNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppUpNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects1.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects2.length = 0;
gdjs.PlayonlineCode.GDOppRightNoteObjects3.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects1.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects2.length = 0;
gdjs.PlayonlineCode.GDLongNoteOppObjects3.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects1.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects2.length = 0;
gdjs.PlayonlineCode.GDStatistics2Objects3.length = 0;


return;

}

gdjs['PlayonlineCode'] = gdjs.PlayonlineCode;
